const fontPath=chrome.runtime.getURL("fonts/SchibstedGrotesk.ttf"),schibsted_grotesk=new FontFace("schibsted-grotesk",`url(${fontPath})`);let excelData=!1,retractionWatchDB=!1,profileScraped=!1,isDesktop=!1,isPermitted=!1,isInitialized=!1,tsvContent="Index	Title	Authors	Total_Authors	Year	Citations	Adjusted_Citations	Adjusment_Weight	Journal	Q*	ImpactFactor_5years	Publication_Considered	First_Author	Second_Author	Co_Author	Corresponding_Author\n";async function loadScript(t,e,o){var r=document.head,i=document.createElement("script");return i.type="text/javascript",i.src=t,i.id=o,i.onreadystatechange=e,i.onload=e,r.appendChild(i),!0}async function openPopupWindow(t){let e={url:t,type:"popup",width:400,height:600,left:100,top:100,focused:!0};return"undefined"!=typeof browser&&browser.windows?await browser.windows.create(e):"undefined"!=typeof chrome&&chrome.windows?chrome.windows.create(e):console.error("No windows API available"),!0}async function releaseSemaphoreAndReload(){chrome.runtime.sendMessage({type:"release_semaphore"},t=>(console.log(t.status),window.location.reload(),!0))}async function releaseSemaphore(){chrome.runtime.sendMessage({type:"release_semaphore"},t=>(console.log(t.status),!0))}function checkInitialization(){chrome.runtime.sendMessage({type:"initialization_check"},t=>{isInitialized=t.isInitialized})}function checkPermissions(){chrome.runtime.sendMessage({type:"permissions_check"},t=>{if(!(isPermitted=t.isPermitted)){window.confirm("GScholarLENS requires your permissions. Please click the extension icon to allow a permission request.")&&window.location.reload();return}})}function checkDevice(){chrome.runtime.sendMessage({type:"device_check"},t=>{isDesktop=t.isDesktop})}function enableButton(){let t=document.getElementById("inject-content-button");t.textContent="Run GScholarLENS",t.disabled=!1,t.textContent.color="white",t.style.width="fit-content",t.style.display="flex",t.style.alignItems="center",t.style.gap="5px",t.style.fontSize="16px",t.style.color="white",t.style.marginTop="20px",t.style.marginBottom="10px",t.style.zIndex="1000",t.style.borderRadius="7px",t.style.cursor="pointer",t.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",t.style.fontFamily="schibsted-grotesk, sans-serif",t.style.backgroundColor="rgba(0,0,0,0.8)";let e=document.createElement("img");e.src=chrome.runtime.getURL("icons/icon128.png"),e.alt="GScholarLENS",e.style.height="20px",e.style.width="20px",e.style.objectFit="contain",t.prepend(e)}schibsted_grotesk.load().then(t=>{document.fonts.add(t),document.body.style.fontFamily="schibsted-grotesk, sans-serif"}).catch(t=>{console.error("Font failed to load:",t)}),window.location.href.includes("user=")&&window.location.href.includes("scholar.google")&&(checkPermissions(),checkDevice(),createButton(),chrome.runtime.sendMessage({type:"wait_for_initialization"},t=>{console.log(t.status),async function(){let t=window.location.href.toString(),e=await fetchWithSessionCache(t,t,refetch=!0);e&&200==e.status||releaseSemaphoreAndReload(),excelData=await getJCRExcel(),retractionWatchDB=await getRetractionWatchDB(),enableButton()}()})),window.addEventListener("beforeunload",async()=>{await releaseSemaphore()},!0);const cyrb53=(t,e=0)=>{let o=3735928559^e,r=1103547991^e;for(let i=0,a;i<t.length;i++)o=Math.imul(o^(a=t.charCodeAt(i)),2654435761),r=Math.imul(r^a,1597334677);return o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),4294967296*(2097151&(r^=Math.imul(o^o>>>13,3266489909)))+(o>>>0)};async function fetchWithSessionCache(t,e,o=!1){if(!t||0===t.length)return null;let r=cyrb53(t),i=await sessionStorage.getItem(r);if(i&&!o)return i;try{let a=await fetch(e);return a&&200==a.status&&await sessionStorage.setItem(r,a),a}catch(n){return console.error("Error fetching data:",n),null}return!0}function getRandomArbitrary(t,e){return Math.random()*(e-t)+t}function getRandomInt(t,e){return t=Math.ceil(t),Math.floor(Math.random()*((e=Math.floor(e))-t+1))+t}async function createInlineWorker(t){let e=await fetch(t),o=await e.text(),r=new Blob([o],{type:"application/javascript"}),i=URL.createObjectURL(r),a=new Worker(i);return a.addEventListener("online",()=>URL.revokeObjectURL(i)),a.addEventListener("offline",()=>{URL.revokeObjectURL(i),r.dispose()}),a}async function getJCRExcel(){try{return new Promise(t=>{chrome.storage.local.get("jcrJSON",e=>{t(e.jcrJSON||!1)})})}catch(t){console.error("Error: Could not fetch JCR excel data. "+t),await releaseSemaphore()}}async function getRetractionWatchDB(){try{return new Promise(t=>{chrome.storage.local.get("retractionwatchdb",e=>{t(e.retractionwatchdb||!1)})})}catch(t){console.error("Error: Could not RetractionWatchDB blob data. "+t),await releaseSemaphore()}}function createButton(){if(!document.getElementById("gsc_prf_w"))return;let t=document.querySelector("#gsc_prf");if(!t)return;if(document.getElementById("inject-content-button")){let e=document.getElementById("inject-content-button");e.style.display="none";return}let o=document.createElement("button");o.id="inject-content-button",o.textContent="Initializing GScholarLENS...",o.disabled=!0,o.style.width="fit-content",o.style.display="flex",o.style.alignItems="center",o.style.gap="5px",o.style.fontSize="16px",o.style.marginTop="20px",o.style.marginBottom="10px",o.style.zIndex="1000",o.style.borderRadius="7px",o.style.cursor="not-allowed",o.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",o.style.fontFamily="schibsted-grotesk, sans-serif";let r=document.createElement("img");r.src=chrome.runtime.getURL("icons/icon128.png"),r.alt="GScholarLENS",r.style.height="20px",r.style.width="20px",r.style.objectFit="contain",o.prepend(r),t.append(o),o.addEventListener("click",()=>{try{startScraping(),o.style.display="none"}catch(t){console.error("Error at startScraping() event: "+t),o.style.display="none",(async()=>{await releaseSemaphore()})()}},{passive:!0})}function rebuildYearwiseData(t){let e=new Map;for(let[o,r]of t){let i=new Map;for(let[a,n]of r){let s;s=Array.isArray(n)&&n.every(([t,e])=>Array.isArray(e)&&e.every(t=>Array.isArray(t)&&2===t.length))?new Map(n.map(([t,e])=>[t,new Map(e)])):Array.isArray(n)&&n.every(t=>Array.isArray(t)&&2===t.length)?new Map(n):n,i.set(a,s)}e.set(o,i)}return e}async function mergeYearwiseData(t,e){for(let[o,r]of e.entries())for(let[i,a]of(t.has(o)||t.set(o,new Map),r.entries())){t.get(o).has(i)||t.get(o).set(i,new Map);let n=t.get(o).get(i),s=a;for(let[l,c]of s.entries())if(n.has(l)){let d=n.get(l);if("number"==typeof d&&"number"==typeof c)n.set(l,d+c);else if(d instanceof Map&&c instanceof Map)for(let[g,u]of c.entries())d.has(g)?d.set(g,d.get(g)+u):d.set(g,u);else Array.isArray(d)&&Array.isArray(c)?n.set(l,[...new Set([...d,...c])]):console.warn(`Incompatible types for key ${l} in year ${o}`)}else n.set(l,c)}}function startScraping(){try{let t=performance.now();document.addEventListener("visibilitychange",async()=>{"visible"===document.visibilityState&&!0===profileScraped&&tL()}),window.addEventListener("focus",async()=>{!0===profileScraped&&tL()}),document.getElementsByTagName("body")[0].style.overflow="hidden";let e=0,o=0,r=Math.max(1,navigator.hardwareConcurrency-1),i=navigator.hardwareConcurrency+1,a=!1,n=!1,s=!1,l=0,c=0,d=0,g=0,u=0,$=0,p=0,h=0,b=0,y=0,f=0,_=0,m=0,x=0,C=0,w=0,v=0,k=0,S=0,q=["First_Author","Second_Author","Co_Author","Corresponding_Author"],A=[.9,.5,.1,1],E=[0,0,0,0],P=[0,0,0,0],Q=new Map,z=/^(.*?)(?=\s+\d|,|\s\()/,j=["rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)","rgba(54, 162, 235, 0.2)"],B=["rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(54, 162, 235, 1)"],I=[["rgba(166, 54, 3, 0.4)","rgba(84, 39, 143, 0.4)","rgba(0, 109, 44, 0.4)","rgba(8, 81, 156, 0.4)"],["rgba(230, 85, 13, 0.4)","rgba(117, 107, 177, 0.4)","rgba(49, 163, 84, 0.4)","rgba(49, 130, 189,0.4)"],["rgba(253, 141, 60, 0.4)","rgba(158, 154, 200, 0.4)","rgba(116, 196, 118, 0.4)","rgba(107, 174, 214, 0.4)"],["rgba(253, 190, 133, 0.4)","rgba(203, 201, 226, 0.4)","rgba(186, 228, 179, 0.4)","rgba(189, 215, 231, 0.4)"],["rgba(254, 237, 222, 0.4)","rgba(242, 240, 247, 0.4)","rgba(237, 248, 233, 0.4)","rgba(239, 243, 255, 0.4)"]],R=[["rgb(127, 44, 2)","rgb(58, 27, 107)","rgb(0, 75, 28)","rgb(5, 52, 105)"],["rgb(179, 63, 11)","rgb(89, 79, 137)","rgb(38, 122, 62)","rgb(35, 97, 138)"],["rgb(184, 94, 42)","rgb(108, 106, 148)","rgb(78, 139, 82)","rgb(73, 115, 155)"],["rgb(194, 151, 99)","rgb(157, 156, 186)","rgb(145, 161, 135)","rgb(148, 173, 197)"],["rgb(205, 141, 108)","rgb(180, 168, 207)","rgb(157, 208, 150)","rgb(150, 180, 230)"]],T=chrome.runtime.getURL("libs/chart.umd.js"),L=[],N=[],D=[],W=new Map,F=[],M=["≽^•⩊•^≼","ฅ^•ﻌ•^ฅ","ᓚ₍ ^. ̫ .^₎","ᓚ₍ ^. .^₎","—ฅ/ᐠ. ̫ .ᐟ\\ฅ —","₍^. .^₎⟆","ฅᨐฅ","ㅤ/ᐠ - ˕ -マ","*ฅ^•ﻌ•^ฅ*","₍^. .^₎⟆","ᓚᘏᗢ","ᓚ₍ ^. ༝ .^₎","₍^.  ̫.^₎","₍^. ̫.^₎","ᓚᘏᗢ ᗢᘏᓗ","/ᐠ. ｡.ᐟ\\ᵐᵉᵒʷˎˊ˗","/ᐠ. .ᐟ\\ Ⳋ","ᓚᘏᗢ ᵐᵉᵒʷ","/ᐠ. .ᐟ\\","/ᐠ - ˕ -マ Ⳋ","=^..^=","₍⑅ᐢ..ᐢ₎","૮₍ ˶ᵔ ᵕ ᵔ˶ ₎ა"],J=document.createElement("div");J.style.marginTop="50px",J.style.width="100%",J.style.backgroundColor="#ddd",J.style.borderRadius="8px",J.style.overflow="hidden",J.style.position="relative";let G=new Map;function U(t,e,o,r="#4caf50"){let i=document.createElement("div");i.id=t;let a=document.createElement("span");a.id=t+"_text",a.style.position="absolute",a.style.width="100%",a.style.textAlign="center",a.style.alignSelf="center",a.style.justifySelf="center",a.style.fontSize="calc(0.3em + 0.55vw)",a.style.color="#000",a.style.whiteSpace="nowrap",a.style.fontFamily="schibsted-grotesk, sans-serif";let n=document.createElement("div");return n.id=t+"_bar",n.style.width="0%",n.style.height="20px",n.style.borderRadius="8px",n.style.display="flex",n.style.margin="3px 3px 3px 3px",n.style.backgroundColor=r,n.style.transition="width 0.3s ease",n.appendChild(a),J.appendChild(n),i}async function Y(t="main",e,o="Progress: ",r=!1,i=20,a=5){(e<=0||e>=100||e%a||r)&&(setTimeout(Z,i,t,e,o),await Promise.resolve())}async function H(t){let e=document.getElementById(t+"_text"),o=document.getElementById(t+"_bar");o.style.display="none",e.style.display="none",e&&e.remove(),o&&o.remove()}G.set("main",U("main",G.size+1,"","#4caf50"));let O="";async function Z(t="main",e,o="Progress: "){let r=O;(Math.floor(e)%10==0||Math.floor(e)%10==5)&&(r=M[Math.floor(Math.random()*M.length)]);let i=G.get(t);if(i){let a=document.getElementById(t+"_text"),n=document.getElementById(t+"_bar"),s=parseFloat(n.style.marginLeft)||0,l=parseFloat(n.style.marginRight)||0;e>=0?(n.style.width=n.style.width=`calc(${e.toFixed(2)}% - ${s+l}px)`,a.textContent=o+`${e.toFixed(2)}% `+r):a.textContent=o,O=r}}let X=document.querySelector("#gsc_prf_w"),V=document.createElement("div");function K(t=-1){let r=document.querySelectorAll(".double_range_slider_box input"),i=document.getElementById("double_range_track"),a=document.querySelector(".minvalue"),n=document.querySelector(".maxvalue"),s=t>0?t:parseInt(r[0].value),c=parseInt(r[1].value);c-s<1&&(r[0].value=c-1);let d=parseInt(r[0].value),g=parseInt(r[1].value);i.style.left=(d-e)/(o-e)*100+"%",i.style.right=100-(g-e)/(o-e)*100+"%",a.textContent=d,n.textContent=g,a.style.left=(d-e)/(o-e)*100+"%",n.style.left=(g-e)/(o-e)*100+"%",l=parseInt(r[0].value)}function tt(t=-1){let r=document.querySelectorAll(".double_range_slider_box input"),i=document.getElementById("double_range_track"),a=document.querySelector(".minvalue"),n=document.querySelector(".maxvalue"),s=parseInt(r[0].value),l=t>0?t:parseInt(r[1].value);l-s<1&&(r[1].value=s+1);let d=parseInt(r[0].value),g=parseInt(r[1].value);i.style.left=(d-e)/(o-e)*100+"%",i.style.right=100-(g-e)/(o-e)*100+"%",a.textContent=d,n.textContent=g,a.style.left=(d-e)/(o-e)*100+"%",n.style.left=(g-e)/(o-e)*100+"%",c=parseInt(r[1].value)}function te(t=-1){let r=document.getElementById("single_range_track"),i=document.getElementById("single_range"),a=document.querySelector(".singlevalue"),n=t>0?t:parseInt(i.value);r.style.right=100-(n-e)/(o-e)*100+"%",r.style.left="0%",a.textContent=n,a.style.left=(n-e)/(o-e)*100+"%",d=n}function to(){let t=document.getElementById("cumulative_checkbox"),e=document.getElementById("single_range_track"),o=document.getElementById("peryear_checkbox");t.checked?(e.style.display="flex",s=!0):(e.style.display="none",s=!1),a=o.checked,n=t.checked}function tr(){let t=document.getElementById("cumulative_checkbox"),e=document.querySelector('label[for="cumulative_checkbox"]'),o=document.getElementById("peryear_checkbox"),r=document.getElementById("double_range_slider"),i=document.getElementById("single_range_slider");o.checked?(r.style.display="none",i.style.display="flex",t.style.display="inline-block",e.style.display="inline-block",s?(t.checked=!0,to()):t.checked=!1):(r.style.display="flex",i.style.display="none",t.style.display="none",e.style.display="none"),a=o.checked,n=t.checked}V.setAttribute("id","chart-viz"),V.style.display="none",X.appendChild(V),X.appendChild(J),!function t(){let r=document.createElement("style");r.textContent=`
            .range_slider_wrapper {
    display: flex;
    justify-content: center;  /* Center the content */
    align-items: center;
    width: 100%;
    padding: 20px;
    box-sizing: border-box;
    background-color: #f5f5f5;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);  /* Shadow effect */
    border-radius: 15px;  /* Rounded border */
}

.range_slider_container {
    width: 400px; /* Decrease the overall width of the container */
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
}

.toggle_container {
    margin-bottom: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
    transform: translate(0, 20%);
}

#peryear_checkbox {
    display: inline-block;
    width: 15px; /* Adjust size as needed */
    height: 15px;
    position: relative;
    margin: 15px 0 0 0;
    padding: 0;
    pointer-events: auto;
    cursor: pointer;
    background-color: white; /* Default background */
    border: 2px solid black;
    border-radius: 4px; /* For rounded corners */
}

#peryear_checkbox:checked {
    background-color: black;
    border-color: black;
}

#peryear_checkbox:checked::after {
    content: '✓';
    color: white;
    font-size: 16px; /* Adjust size as needed */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

#cumulative_checkbox {
    display: inline-block;
    width: 15px; /* Adjust size as needed */
    height: 15px;
    position: relative;
    margin: 15px 15px 0 0;
    padding: 0;
    pointer-events: auto;
    cursor: pointer;
    background-color: white; /* Default background */
    border: 2px solid black;
    border-radius: 4px; /* For rounded corners */
}

#cumulative_checkbox:checked {
    background-color: black;
    border-color: black;
}

#cumulative_checkbox:checked::after {
    content: '✓';
    color: white;
    font-size: 16px; /* Adjust size as needed */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.double_range_slider_box, .single_range_slider_box {
    position: relative;
    width: 100%; /* Adjust width */
    max-width: 250px; /* Decrease max-width */
    height: 80px; /* Decrease height */
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 20px;
    overflow: visible;
}

.range_slider {
    width: 100%;
    height: 8px; /* Decrease slider height */
    position: relative;
    background-color: #dddddd;
    border-radius: 20px;
}

.range_track {
    height: 100%;
    position: absolute;
    border-radius: 20px;
    background-color: #000000; /* Light grey */
    z-index: 1;
    transition: width 0.3s ease-in-out;  /* Smooth transition */
    left: 0;  /* Ensure it starts from the left */
    top: 0;
}

.minvalue, .maxvalue, .singlevalue {
    position: absolute;
    padding: 3px 8px; /* Decrease padding */
    background: #0e5f59;
    border-radius: 1rem;
    color: white;
    font-size: 0.8rem; /* Reduce font size */
    z-index: 10;
    white-space: nowrap;
    max-width: fit-content;
}

/* Position adjustments */
.minvalue {
    left: 0;
    width: fit-content;
    transform: translate(-50%, 80%);
    transition: left 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.maxvalue {
    right: 0;
    width: fit-content;
    transform: translate(-50%, -120%);
    transition: right 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.singlevalue {
    width: fit-content;
    transform: translate(-50%, -120%);
    transition: right 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

/* General range slider input settings */
input {
    position: absolute;
    width: 100%;
    height: 5px;
    background: none;
    pointer-events: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    top: 50%;
    transform: translate(-0.75%,-75%);
    z-index: 3;
}

/* Thumb style for Webkit (Chrome, Safari) */
input::-webkit-slider-thumb {
    height: 20px; /* Decrease thumb size */
    width: 20px;
    border-radius: 50%;
    border: 3px solid #696969; /* Light grey for border */
    background-color: #d3d3d3; /* Dark grey for thumb */
    pointer-events: auto;
    -webkit-appearance: none;
    cursor: pointer;
    margin-bottom: 0;
    z-index: 4;
}

/* Thumb style for Mozilla (Firefox) */
input::-moz-range-thumb {
    height: 20px; /* Decrease thumb size */
    width: 20px;
    border-radius: 50%;
    border: 3px solid #696969; /* Light grey for border */
    background-color: #d3d3d3; /* Dark grey for thumb */
    pointer-events: auto;
    -moz-appearance: none;
    cursor: pointer;
    margin-top: 0;
    z-index: 4;
}
/* CSS styles for sharma_index_container and sh_table */
.sharma_index_container {
    font-size: 1.0rem;
    font-weight: 500;
    margin-bottom: 10px;
    justify-content: center;
    display: inline-block;
}

/* .sh_table_container {
    width: 80%;
    border: black;
    border-style: solid;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
    border-bottom-left-radius: 10px;
    display: block;
    margin: 0 auto;
}

.sh_table_container table td, 
.sh_table_container table th {
  border: 1px solid black;
} */

  .sh_table_container-outer {
  border: 2px solid #2c3e50;
  border-radius: 12px;
  overflow: hidden;
  width: 100%;
  max-width: 600px;
  margin: 1rem 0;
  margin-left: auto;
  margin-right: auto;
}

.sh_table_container-inner {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

.sh_table_container-inner th,
.sh_table_container-inner td {
  padding: 14px;
  text-align: left;
  border-bottom: 1px solid #ecf0f1;
  border-right: 1px solid #ecf0f1;
}

.sh_table_container-inner th {
  background-color: #34495e;
  color: white;
  border-right: 1px solid #2c3e50;
}

.sh_table_container-inner tr:last-child td {
  border-bottom: none;
}

.sh_table_container-inner td:last-child,
.sh_table_container-inner th:last-child {
  border-right: none;
}

/* Thanks DeepSeek R1 */
.journalTableStyle {
  border: 2px solid #333;
  border-radius: 10px;
  overflow: hidden;
  border-collapse: separate;
  border-spacing: 0px;
  /*border-collapse: collapse;*/
  width: 100%;
  max-width: 600px;
  margin: 1rem 0;
}

.journalTableStyle th,
.journalTableStyle td {
  padding: 12px;
  text-align: left;
  border: none;
}

.journalTableStyle thead {
  background-color: #f8f8f8;
}

.plotmetrics_table {
    table-layout: fixed;
    width: auto;
}

.plotmetrics_table_container {
    display: flex;
    justify-content: center;
}

.yearplot_table_container {
  width: 70%;
  height: 100%;
  position: relative;
}

#tenyearPubCountChart {
  width: 80% !important; /*ONLY CHANGE THIS to modify width of decade plot*/
  height: 100% !important;
} 

.position-circles {
    transition: all 0.2s ease-in-out;
    position: relative;
}

.circles-container {
    transition: all 0.2s ease-in-out;
    position: relative;
}

.position-circles:hover .circles-container{
    transform: scale(1.10);
    z-index: 1000;
    opacity: 1;
}

.position-circles:hover .q-badge {
    opacity: 1;
    transform: scale(1.10) ;/*translateX(50%);  Combine transforms */;
    z-index: 1000;
}

.position-circles:hover .if-badge {
    opacity: 1;
    transform: scale(1.10) ;/*translateX(55%);  Combine transforms */;
    z-index: 1000;
}

/* Optional: Add tooltip for circle meanings */
.position-circles span {
    position: relative;
    /*cursor: help;*/
}

.position-circles span[data-role]:hover::after {
    content: attr(data-role);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%); 
    background: #333;
    color: white;
    padding: 4px 8px;
    margin-bottom: 5px;
    z-index: 10;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    transform: translateX(-50%) scale(1/1.15); /* Counteract parent scale */
}
            `,document.head.appendChild(r);let i=document.querySelector("#chart-viz");i.style.marginTop="50px",i.innerHTML=DOMPurify.sanitize(`
                    <div id="GScholarLENS">
                        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
                        <div style="font-family = 'schibsted-grotesk, sans-serif'; padding: 20px; marginTop: 10px; margin: 35px; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.05); background-color: #fff;">
                            <div style="text-align: center;">
                                <div class="sharma_index_container">
                                    <h2 id="sh_index">Sh-Index : ${m}</h2>
                                </div>
                            </div>
                            <br>
                            <div class="sh_table_container-outer">
                                <table class="sh_table_container-inner" /*style="width: 100%;"*/>
                                    <tr>
                                        <th style="text-align: center; padding: 8px 0;">H<sub>First</sub> - First Author</th>
                                        
                                        <th style="text-align: center; padding: 8px 0;">H<sub>Second</sub>- Second Author</th>
                                        
                                        <th style="text-align: center;">H<sub>Other</sub> - Co Author</th>
                                        
                                        <th style="text-align: center; padding: 8px 0;">H<sub>Co</sub> - Corresponding Author</th>
                                        
                                    </tr>
                                    <tr>
                                        <td id="h_first" style="text-align: center;">${b}</td>
                                        <td id="h_second" style="text-align: center;">${y}</td>
                                        <td id="h_other" style="text-align: center;">${f}</td>
                                        <td id="h_co" style="text-align: center;">${_}</td>
                                    </tr>
                                </table>
                            </div>
                            <br>
                            <div class="plotmetrics_table_container">
                                <table class="plotmetrics_table" >
                                    <tbody class="plotmetrics_table_container">
                                    <tr>
                                        <td id="table_metrics" style="border-right: 1px solid black; padding-right: 15px; text-align: center; padding-left: 15px;">
                                        <div class="metrics_table_container">
                                        <table >
                                            <tr>
                                                <th style="text-align: left;"><b>Total Publications:</b></th>
                                                <td id="total_pubs" style="text-align: center;">${$}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Publications Considered:</b></th>
                                                <td id="considered_pubs" style="text-align: center;">${$-(p+k)}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Publications Not Counted:</b></th>
                                                <td id="ignored_pubs" style="text-align: center;">${p}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Median - Raw Citations:</b></th>
                                                <td id="medianCitationsRaw" style="text-align: center;">${C}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Median - Adjusted Citations:</b></th>
                                                <td id="medianCitationsAdj" style="text-align: center;">${w}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Zero Citations:</b></th>
                                                <td id="zeroCitationPubs" style="text-align: center;">${v}</td>
                                            </tr>
                                            <tr>
                                                <th class="blink_text" style="color: red; text-align: left;"><b>Total Retractions:</b></th>
                                                <td id="retractedPubsCount" style="text-align: center;">${k}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Total Preprints:</b></th>
                                                <td id="preprintCount" style="text-align: center;">${S}</td>
                                            </tr>
                                        </table>
                                        </div>
                                        </td>
                                        <td id="year_plot" style="width: 100%;">
                                            <div class="plotmetrics_table_container"><canvas id="tenyearPubCountChart" class="yearplot_table_container"></canvas></div>
                                        </td>                                        
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <center><span id="pubmachine_banner" style="color: blue; font-weight: bold;"></span></center>
                            <br>
                            <div id="rangeSliderDiv" class="range_slider_container">
                                <div class="toggle_container">
                                    <label for="peryear_checkbox" style="transform: translateY(-3px);">Per-Year</label>
                                    <input type="checkbox" id="peryear_checkbox"/>
                                    <label for="cumulative_checkbox" style="transform: translateY(-3px);">Cumulative</label>
                                    <input type="checkbox" id="cumulative_checkbox"/>
                                </div>

                                <!-- Double Range Slider -->
                                <div class="double_range_slider_box" id="double_range_slider">
                                    <div class="range_slider">
                                        <span class="range_track" id="double_range_track"></span>
                                        <input class="double_range" type="range" class="min" min="${e}" max="${o}" value="${l}" step="1" />
                                        <input class="double_range" type="range" class="max" min="${e}" max="${o}" value="${c}" step="1" />
                                        <div class="minvalue"></div>
                                        <div class="maxvalue"></div>
                                    </div>
                                </div>

                                <!-- Single Range Slider -->
                                <div class="single_range_slider_box" id="single_range_slider">
                                    <div class="range_slider">
                                        <span class="range_track" id="single_range_track"></span>
                                        <input id="single_range" type="range" class="single" min="${e}" max="${o}" value="${c}" step="1" />
                                        <div class="singlevalue"></div>
                                    </div>
                                </div>
                            </div>
                            <canvas id="qScorePosStackedChart"></canvas>
                            <canvas id="authorCitationsChart"></canvas>
                            <canvas id="authorCitationsDistChart"></canvas>                            
                            <div id="authorStackedChartDiv" style="width: 100%; height: 10%;">
                                <canvas id="authorStackedChart"></canvas>
                            </div>
                            <div id="citationsStackedChartDiv" style="width: 100%; height: 10%;">
                                <canvas id="citationsStackedChart"></canvas>
                            </div>

                                <br>
                                <b>Author Names Considered: </b><span id="using_author_names">${D.toString()}</span>
                                <br>
                            <b>Top 3 Journals: </b>
                            <div id="journalTable" style="display: flex; justify-content: center;"></div>
                        </div>
                    </div>
                    `);let a=document.getElementById("cumulative_checkbox"),n=document.getElementById("peryear_checkbox");n.addEventListener("change",tr),a.addEventListener("change",to);let s=document.querySelectorAll(".double_range_slider_box input"),d=document.getElementById("single_range");s[0].addEventListener("input",K),s[1].addEventListener("input",tt),d.addEventListener("input",te),n.addEventListener("change",tL),a.addEventListener("change",tL),d.addEventListener("change",tL),s.forEach(t=>{t.addEventListener("change",tL)}),n.addEventListener("change",tN),a.addEventListener("change",tN),d.addEventListener("change",tN),s.forEach(t=>{t.addEventListener("change",tN)})}();let ti=document.createElement("button");ti.id="helpButton",ti.style.fontFamily="schibsted-grotesk, sans-serif",ti.style.marginTop="10px",ti.style.marginRight="10px",ti.textContent="GScholarLENS Help",ti.addEventListener("click",function(){window.open("https://project.iith.ac.in/sharmaglab/gscholarlens/","_blank")}),X.appendChild(ti);let ta=document.createElement("button");ta.id="downloadDetailsButton",ta.disabled=!0,ta.style.fontFamily="schibsted-grotesk, sans-serif",ta.style.marginTop="10px",ta.style.marginRight="10px",ta.textContent="Download Details",X.appendChild(ta),ta.addEventListener("click",function(){let t=new Blob([tsvContent],{type:"text/tab-separated-values"}),e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download=`${tl.replace(/\s+/g,"_")}_publications.tsv`,o.click()});let tn=document.createElement("button");tn.id="downloadPlotsButton",tn.disabled=!0,tn.style.fontFamily="schibsted-grotesk, sans-serif",tn.style.marginTop="10px",tn.style.marginRight="10px",tn.textContent="Download Plots",X.appendChild(tn),tn.addEventListener("click",function(){let t=chrome.runtime.getURL("libs/dom-to-image-more.min.js");loadScript(t,function t(){var e=document.getElementById("GScholarLENS");domtoimage.toJpeg(e).then(function(t){var e=document.createElement("a");e.download=`${tl.replace(/\s+/g,"_")}_plots.jpeg`,e.href=t,e.click()}).catch(function(t){console.error("Error: Could not capture the plots!",t)})},"captureplots_script")});let ts=document.querySelector("#gsc_prf_in"),tl=ts?ts.textContent.trim():"Not found";function tc(t){let e=/\b(dr|mr|mrs|ms|miss|prof|phd|ph\.?d|md|m\.?d|jr|sr)\b/gi,o=t.replace(e,"");return o=(o=(o=o.replace(/[.,\/#!$%\^&\*;:}=\_`~)]/g,"")).replace(/\s+/g," ").trim()).split(/[,\.\(\;\:\[\{\*)]/)[0].trim()}function td(t){return t.replace("/[.*+?^${}()|[]\\]/g","\\$&")}let tg=document.querySelector("#gsc_prf_in").textContent.trim(),tu=document.querySelector("#gs_prf_ion_txt"),t$="";void 0!=tu&&(t$=tu.textContent.trim());let tp=[],th=[];if(t$.length>0){let tb=t$.split(/;|,|:/).map(t=>t.trim()).filter(Boolean),ty=0;for(;ty<tb.length;)ty+1<tb.length&&1===tb[ty].split(" ").length?(tb[ty]=`${tb[ty]}, ${tb[ty+1]}`,tb.splice(ty+1,1)):ty++;th=(th=(th=tb.filter(t=>2===t.split(" ").length)).map(t=>{let e=t.replace(/[^\w\s-]|_/g,"").replace(/\s+/g," ").trim();return e=e.replace(/[–—]/g,"-"),tc(replaceSpecialChars(normalizeString(e)))})).filter(t=>""!==t.trim());let tf=th.map(t=>{let e=t.split(" ").map(t=>t.trim());return e.reverse().join(" ")});th=(th=[...th,...tf]).map(t=>t.replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").trim()),th=Array.from(new Set(th))}let t8=tc(replaceSpecialChars(normalizeString(tg))),t_=function t(e){let o=e.split(" "),r=o[o.length-1];return r}(t8),tm=function t(e){let o=e.split(" ");if(1===o.length)return[e];{let r=o[0].charAt(0),i=o[o.length-1],a=`${r} ${i}`,n=`${o[0]} ${o[1].charAt(0)}`,s=`${i} ${o[0]}`,l=`${i} ${r}`,c=`${i.charAt(0)} ${o[0]}`;return[a,n,s,l,c]}}(t8);tp.push(t8),tp=[...tp=[...tp,...tm],...th],tp=Array.from(new Set(tp));let tx=[],tC=[];function tw(t,e){return W.get(e).size<=0||!W.get(e).has("author_pos_cite_qscore")?[0,0,0,0]:[W.get(e).get("author_pos_cite_qscore").get("first_author").get(t),W.get(e).get("author_pos_cite_qscore").get("second_author").get(t),W.get(e).get("author_pos_cite_qscore").get("co_author").get(t),W.get(e).get("author_pos_cite_qscore").get("corresponding_author").get(t)]}function tv(t,e){return W.get(e).size<=0||!W.get(e).has("author_pos_cite_qscore")?[0,0,0,0,0]:[W.get(e).get("author_pos_cite_qscore").get(t).get("Q1"),W.get(e).get("author_pos_cite_qscore").get(t).get("Q2"),W.get(e).get("author_pos_cite_qscore").get(t).get("Q3"),W.get(e).get("author_pos_cite_qscore").get(t).get("Q4"),W.get(e).get("author_pos_cite_qscore").get(t).get("NA"),]}function tk(t,e){return W.get(e).size<=0||!W.get(e).has("author_pos_cite_qscore")?0:W.get(e).get("author_pos_cite_qscore").get(t).get("Q1")+W.get(e).get("author_pos_cite_qscore").get(t).get("Q2")+W.get(e).get("author_pos_cite_qscore").get(t).get("Q3")+W.get(e).get("author_pos_cite_qscore").get(t).get("Q4")+W.get(e).get("author_pos_cite_qscore").get(t).get("NA")}function t0(t,e){return W.get(e).size<=0||!W.get(e).has("qPosCount")?[0,0,0,0]:[W.get(e).get("qPosCount").get("first_author").get(t),W.get(e).get("qPosCount").get("second_author").get(t),W.get(e).get("qPosCount").get("co_author").get(t),W.get(e).get("qPosCount").get("corresponding_author").get(t)]}function tS(t,e){return W.get(e).size<=0||!W.get(e).has("qPosCount")?[0,0,0,0]:[W.get(e).get("qPosCount").get("first_author").get(t)/t3("first_author",e).reduce((t,e)=>t+e,0)*100,W.get(e).get("qPosCount").get("second_author").get(t)/t3("second_author",e).reduce((t,e)=>t+e,0)*100,W.get(e).get("qPosCount").get("co_author").get(t)/t3("co_author",e).reduce((t,e)=>t+e,0)*100,W.get(e).get("qPosCount").get("corresponding_author").get(t)/t3("corresponding_author",e).reduce((t,e)=>t+e,0)*100]}function t3(t,e){return W.get(e).size<=0||!W.get(e).has("qPosCount")?[0,0,0,0,0]:[W.get(e).get("qPosCount").get(t).get("Q1"),W.get(e).get("qPosCount").get(t).get("Q2"),W.get(e).get("qPosCount").get(t).get("Q3"),W.get(e).get("qPosCount").get(t).get("Q4"),W.get(e).get("qPosCount").get(t).get("NA")]}function tq(t,e){return W.get(e).size<=0||!W.get(e).has("qPosCount")?0:W.get(e).get("qPosCount").get(t).get("Q1")+W.get(e).get("qPosCount").get(t).get("Q2")+W.get(e).get("qPosCount").get(t).get("Q3")+W.get(e).get("qPosCount").get(t).get("Q4")+W.get(e).get("qPosCount").get(t).get("NA")}function tA(t,e){return W.get(e).size<=0||!W.get(e).has("qPosCount")?[0,0,0,0,0]:[W.get(e).get("qPosCount").get(t).get("Q1")/W.get(e).get("qTotal").get("Q1")*100,W.get(e).get("qPosCount").get(t).get("Q2")/W.get(e).get("qTotal").get("Q2")*100,W.get(e).get("qPosCount").get(t).get("Q3")/W.get(e).get("qTotal").get("Q3")*100,W.get(e).get("qPosCount").get(t).get("Q4")/W.get(e).get("qTotal").get("Q4")*100,W.get(e).get("qPosCount").get(t).get("NA")/W.get(e).get("qTotal").get("NA")*100]}function tE(t){return W.get(t).size<=0||!W.get(t).has("total_publications")?0:W.get(t).get("total_publications")}function t1(t){return W.get(t).size<=0||!W.get(t).has("author_pos_contrib")?[0,0,0,0]:[W.get(t).get("author_pos_contrib").get("first_author"),W.get(t).get("author_pos_contrib").get("second_author"),W.get(t).get("author_pos_contrib").get("co_author"),W.get(t).get("author_pos_contrib").get("corresponding_author")]}function t2(t){return W.get(t).size<=0||!W.get(t).has("author_pos_cite_contrib")?[0,0,0,0]:[W.get(t).get("author_pos_cite_contrib").get("first_author"),W.get(t).get("author_pos_cite_contrib").get("second_author"),W.get(t).get("author_pos_cite_contrib").get("co_author"),W.get(t).get("author_pos_cite_contrib").get("corresponding_author")]}function tP(t){return W.get(t).size<=0||!W.get(t).has("author_pos_cite_map")?[0,0,0,0]:[W.get(t).get("author_pos_cite_map").get("first_author"),W.get(t).get("author_pos_cite_map").get("second_author"),W.get(t).get("author_pos_cite_map").get("co_author"),W.get(t).get("author_pos_cite_map").get("corresponding_author")]}function t9(t,e,o){let r=[0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=tw(t,i.toString());for(let n=0;n<4;n++)r[n]+=a[n]}return r}function tQ(t,e,o){let r=[0,0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=tv(t,i.toString());for(let n=0;n<5;n++)r[n]+=a[n]}return r}function tz(t,e,o){let r=0;for(let i=e;i<=o;i++)F.includes(i.toString())&&(r+=tk(t,i.toString()));return r}function tj(t,e,o){let r=[0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=t0(t,i.toString());for(let n=0;n<4;n++)r[n]+=a[n]}return r}function t6(t,e,o){let r=[0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=tS(t,i.toString());for(let n=0;n<4;n++)r[n]+=a[n]}let s=Math.abs(o-e);for(let l=0;l<4;l++)r[l]=r[l]/s*100;return r}function tB(t,e,o){let r=[0,0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=t3(t,i.toString());for(let n=0;n<5;n++)r[n]+=a[n]}return r}function tI(t,e,o){let r=0;for(let i=e;i<=o;i++)F.includes(i.toString())&&(r+=tq(t,i.toString()));return r}function tR(t,e,o){let r=[0,0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=tA(t,i.toString());for(let n=0;n<5;n++)r[n]+=a[n]}let s=Math.abs(o-e);for(let l=0;l<5;l++)r[l]=r[l]/s*100;return r}function tT(t,e){let o=0;for(let r=t;r<=e;r++)F.includes(r.toString())&&(o+=tE(r.toString()));return o}function tL(){let t=a?n?e:d:l,o=a?d:c,r=function t(e,o){let r=[0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=t1(i.toString());for(let n=0;n<4;n++)r[n]+=a[n]}return r}(t,o),i=r[0]+r[1]+r[2]+r[3],s=(r[0]/i*100).toFixed(2),g=(r[1]/i*100).toFixed(2),u=(r[3]/i*100).toFixed(2),h=(r[2]/i*100).toFixed(2),b={labels:[""],datasets:[{label:"First Author Contribution %",data:[s],backgroundColor:j[0],borderColor:B[0],borderWidth:1},{label:"Second Author Contribution %",data:[g],backgroundColor:j[1],borderColor:B[1],borderWidth:1},{label:"Co-Author Contribution %",data:[h],backgroundColor:j[2],borderColor:B[2],borderWidth:1},{label:"Corresponding Author Contribution %",data:[u],backgroundColor:j[3],borderColor:B[3],borderWidth:1}]};if(void 0!=(chartStatus=Chart.getChart("authorStackedChart"))){let y=document.getElementById("authorStackedChartDiv");y.style.height="150px",chartStatus.data=b,chartStatus.update()}else{let f=document.getElementById("authorStackedChartDiv");f.style.height="150px";let _=document.getElementById("authorStackedChart").getContext("2d");new Chart(_,{type:"bar",data:b,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Author Contribution in % based on Authorship"}},scales:{x:{stacked:!0,beginAtZero:!0,max:100,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let m=function t(e,o){let r=[0,0,0,0];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=t2(i.toString());for(let n=0;n<4;n++)r[n]+=a[n]}return r}(t,o),x=m[0]+m[1]+m[2]+m[3],C=(m[0]/x*100).toFixed(2),w=(m[1]/x*100).toFixed(2),v=(m[3]/x*100).toFixed(2),S=(m[2]/x*100).toFixed(2),q={labels:[""],datasets:[{label:"First Author Citations %",data:[C],backgroundColor:j[0],borderColor:B[0],borderWidth:1},{label:"Second Author Citations %",data:[w],backgroundColor:j[1],borderColor:B[1],borderWidth:1},{label:"Co-Author Citations %",data:[S],backgroundColor:j[2],borderColor:B[2],borderWidth:1},{label:"Corresponding Author Citations %",data:[v],backgroundColor:j[3],borderColor:B[3],borderWidth:1}]};if(void 0!=(chartStatus=Chart.getChart("citationsStackedChart"))){let A=document.getElementById("citationsStackedChartDiv");A.style.height="150px",chartStatus.data=q,chartStatus.update()}else{let E=document.getElementById("citationsStackedChartDiv");E.style.height="150px";let P=document.getElementById("citationsStackedChart").getContext("2d");new Chart(P,{type:"bar",data:q,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Contribution in % based on Authorship"}},scales:{x:{stacked:!0,beginAtZero:!0,max:100,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}if(isDesktop){let Q=[tz("first_author",t,o),tz("second_author",t,o),tz("co_author",t,o),tz("corresponding_author",t,o)],z=[t9("Q1",t,o),t9("Q2",t,o),t9("Q3",t,o),t9("Q4",t,o),t9("NA",t,o)],T={labels:["First Author Citations\nTotal:"+Q[0],"Second Author Citations\nTotal:"+Q[1],"Co-Author Citations\nTotal:"+Q[2],"Corresponding Author Citations\nTotal:"+Q[3]],datasets:[{label:"Q1 Citations",data:z[0],backgroundColor:I[0],borderColor:R[0],borderWidth:1},{label:"Q2 Citations",data:z[1],backgroundColor:I[1],borderColor:R[1],borderWidth:1},{label:"Q3 Citations",data:z[2],backgroundColor:I[2],borderColor:R[2],borderWidth:1},{label:"Q4 Citations",data:z[3],backgroundColor:I[3],borderColor:R[3],borderWidth:1},{label:"NA Citations",data:z[4],backgroundColor:I[4],borderColor:R[4],borderWidth:1}]},L=Chart.getChart("authorCitationsChart");if(void 0!=L)L.data=T,L.update();else{let N=document.getElementById("authorCitationsChart").getContext("2d");new Chart(N,{type:"bar",data:T,options:{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Count based on Authorship with Journal Rank Categorization"}},scales:{x:{stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let W=function t(e,o){let r=[[],[],[],[]];for(let i=e;i<=o;i++){if(!F.includes(i.toString()))continue;let a=tP(i.toString());for(let n=0;n<4;n++)r[n].push(a[n]),r[n]=r[n].toString().split(",").filter(t=>""!==t).map(Number)}return r}(t,o),M={labels:["First Author Citations","Second Author Citations","Co-Author Citations","Corresponding Author Citations"],datasets:[{label:"Citation Distribution",data:[W[0],W[1],W[2],W[3]],backgroundColor:j,borderColor:B,borderWidth:1}]};if(void 0!=(L=Chart.getChart("authorCitationsDistChart")))L.data=M,L.update();else{let J=document.getElementById("authorCitationsDistChart").getContext("2d");new Chart(J,{type:"violin",data:M,options:{responsive:!0,whiskersMode:"exact",coef:0,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Distribution based on Authorship (Log Scale)"}},scales:{x:{grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{type:"logarithmic",beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let G=[tI("first_author",t,o),tI("second_author",t,o),tI("co_author",t,o),tI("corresponding_author",t,o)],U=[tj("Q1",t,o),tj("Q2",t,o),tj("Q3",t,o),tj("Q4",t,o),tj("NA",t,o)],Y={labels:["First Author Q*\nTotal:"+G[0],"Second Author Q*\nTotal:"+G[1],"Co-Author Q*\nTotal:"+G[2],"Corresponding Author Q*\nTotal:"+G[3]],datasets:[{label:"Q1",data:U[0],backgroundColor:I[0],borderColor:R[0],borderWidth:1},{label:"Q2",data:U[1],backgroundColor:I[1],borderColor:R[1],borderWidth:1},{label:"Q3",data:U[2],backgroundColor:I[2],borderColor:R[2],borderWidth:1},{label:"Q4",data:U[3],backgroundColor:I[3],borderColor:R[3],borderWidth:1},{label:"NA",data:U[4],backgroundColor:I[4],borderColor:R[4],borderWidth:1}]};if(void 0!=(L=Chart.getChart("qScorePosStackedChart")))L.data=Y,L.update();else{let H=document.getElementById("qScorePosStackedChart").getContext("2d");new Chart(H,{type:"bar",data:Y,options:{indexAxis:"x",plugins:{legend:{display:!1},title:{display:!0,text:"Publication Count based on Authorship with Journal Rank Categorization"}},scales:{x:{stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{beginAtZero:!0,stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let O=document.querySelectorAll(".double_range_slider_box input"),Z=document.getElementById("single_range");Z.value=d.toString(),O[0].value=l.toString(),O[1].value=c.toString(),te(d),K(l),tt(c),tr(),to(),l=parseInt(O[0].value),c=parseInt(O[1].value),d=parseInt(Z.value)}else document.getElementById("year_plot").style.display="none",document.getElementById("rangeSliderDiv").style.display="none",document.getElementById("authorCitationsDistChart").style.display="none",document.getElementById("authorCitationsChart").style.display="none",document.getElementById("qScorePosStackedChart").style.display="none";let X=document.getElementById("total_pubs"),ti=document.getElementById("ignored_pubs"),ts=document.getElementById("considered_pubs"),tl=document.getElementById("using_author_names");X.textContent=DOMPurify.sanitize(`${$.toString()}`),ts.textContent=DOMPurify.sanitize(`${$-(p+k)}`),ti.textContent=DOMPurify.sanitize(`${p}`),tl.textContent=DOMPurify.sanitize(`${D.toString()}`),ta.disabled=!1,tn.disabled=!1,V.style.display="block"}function t4(){let t=[],e=[],r=[],i=!1,a=o-10;for(;a<=o;){if(e.push(a),W.has(a.toString())){let n=W.get(a.toString()).get("total_publications");t.push(n),n>48&&(i=!0,r.push(a))}else t.push(0);a+=1}i&&(document.getElementById("pubmachine_banner").textContent=`>48 Papers/Year (${r.join(", ")})`);let s={labels:e,datasets:[{label:["Publication Count"],data:t,backgroundColor:I[0][0],borderColor:R[0][0],borderWidth:1}]};Chart.register({id:"dropOffLine",afterDraw(t,e,o){let{ctx:r,scales:i}=t,a=i.y,n=i.x,s=o.value,l=a.getPixelForValue(s);r.save(),r.beginPath(),r.strokeStyle=o.borderColor,r.lineWidth=o.borderWidth,r.moveTo(n.left,l),r.lineTo(n.right,l),r.stroke(),o.label&&o.label.enabled&&(r.fillStyle=o.label.color||o.borderColor,r.textAlign="start"===o.label.position?"left":"center",r.textBaseline="bottom",r.fillText(o.label.content,(n.left+n.right)/2,l-4)),r.restore()}});let l=Chart.getChart("tenyearPubCountChart");if(void 0!=l)l.data=s,l.update();else{let c=document.getElementById("tenyearPubCountChart").getContext("2d");new Chart(c,{type:"bar",data:s,options:{responsive:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Publication Counts of last 10 years"},dropOffLine:{value:48,borderColor:"rgba(6, 40, 233, 0.7)",borderWidth:2,z:-1,label:{enabled:!0,content:"Publication Machine",position:"start",color:"rgba(6, 40, 233, 0.7)",z:-2}}},scales:{x:{stacked:!1,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!1,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}}async function tN(){J.style.display="block";let t=document.querySelectorAll(".gsc_a_tr"),o=a?n?e:d:l,r=a?d:c;for(let[i,s]of t.entries()){let g=s.querySelector(".gsc_a_y span"),u=g?g.textContent.trim():"",$=u.length>0?parseInt(u):0;0===$||$>=o&&$<=r?s.style.display="table-row":s.style.display="none";let p="Selecting Publications ("+i+"): ";Y("publication_cards",i/t.length*100,p),await new Promise(t=>setTimeout(t,0))}J.style.display="none"}tp.forEach(t=>{tx.push(function t(e){let o=e.trim().split(/\s+/),r=td(o[o.length-1]),i=td(o[0].charAt(0));return o[0].length>1&&r.length>1?RegExp(`^${i}.*\\s${r}[\\*^]?$`,"i"):RegExp(`^${o[0]}.*\\s${r}[\\*^]?$`,"i")}(t)),tC.push(function t(e){let o=e.trim().split(/\s+/),r=td(o[0]),i=td(o[o.length-1]);return RegExp(`^${r}.*\\s${i}[\\*^]?$`,"i")}(t))});let tD=async()=>{document.getElementsByTagName("body")[0].style.overflow="visible";let t=document.querySelectorAll(".gsc_a_tr"),a=new Map;t.forEach(async(t,r)=>{let i=t.querySelector(".gsc_a_t a"),n=i?i.textContent.trim():"No title",s=i?i.href:null,g=t.querySelector(".gsc_a_c a"),u=g?g.textContent.trim():"0",$=parseInt(u,0);isNaN($)&&($=0);let p=t.querySelectorAll(".gsc_a_t .gs_gray"),h=t.querySelector(".gs_oph"),b=h&&h.previousSibling?h.previousSibling.textContent.trim():"Unknown Journal";if(null!=b.toLowerCase().match(/rxiv/))S++;else{let y=b.match(z),f=y?y[1].trim():b;Q.has(f)||Q.set(f,0),Q.set(f,Q.get(f)+1)}let _=t.querySelector(".gsc_a_y span"),m=_?_.textContent.trim():"No year";t.year="No year"!=m||void 0!=m?parseInt(m):0;let x=t.querySelector(".gs_ibl");x&&x.hasAttribute("href")&&x.getAttribute("href"),(parseInt(m)<e||0===e)&&(l=e=parseInt(m)),parseInt(m)>o&&(c=o=parseInt(m),d=o),"No year"==m||void 0==m||(W.has(m)||W.set(m,new Map),F.includes(m)||F.push(m));let C=p[0],w=C?C.textContent.trim():"No authors",v=function t(e,o,r=[5,7]){let i=e.toLowerCase().split(/,\s*(.+)/)[0].replace(/\d+/g,"").replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").trim();if(a.has(i))return a.get(i);for(let n of o)if(n.Name&&i.includes(n.Name.toLowerCase())&&n.Name.toLowerCase().includes(i)){let s=Array.from(Object.values(n));if(!(s.length>=Math.max(...r)))return a.set(i,["NA","NA"]),["NA","NA"];{let l=[n.JIF5Years,n.Qscore];return a.set(i,l),l}}return a.set(i,["NA","NA"]),["NA","NA"]}(b,excelData,[5,7]);L.push({title:n,citations:$,year:m,authors:w,total_authors:0,author_pos:"NA",journalRanking:v[1],journalTitle:b,impact_factor:v[0],index:r,publicationURL:s})});let n=[...Q.entries()].sort((t,e)=>e[1]-t[1]).slice(0,3),s=`
            <table class="journalTableStyle">
                <thead>
                <tr>
                    <th>Journal Name</th>
                    <th>Count</th>
                </tr>
                </thead>
                <tbody>
                ${n.map(([t,e])=>`
                    <tr>
                    <td>${t}</td>
                    <td>${e}</td>
                    </tr>
                `).join("")}
                </tbody>
            </table>
            `;document.getElementById("journalTable").innerHTML=DOMPurify.sanitize(s);let b=document.querySelectorAll(".double_range_slider_box input"),y=document.getElementById("single_range");async function f(t,e,o=5,r=0){let i=[];try{let a=0;e.length>=100&&(r=r>1e4?r:1e4);let n=async()=>{if(a>=e.length)return;let s=e.slice(a,a+o);a+=o,await new Promise(t=>setTimeout(t,r));let l=s.map(async(e,o)=>{try{let r,i=new DOMParser;try{r=await fetchWithSessionCache(t[o],e);let a=0;for(;!r||200!=r.status;){if(r=await fetchWithSessionCache(t[o],e,refetch=!0),++a>5)throw Error("Request limit exceeded. Refresh the page and rerun GScholarLENS.");await new Promise(t=>setTimeout(t,0))}let n=await r.text(),s=i.parseFromString(DOMPurify.sanitize(n),"text/html"),l=s.querySelector(".gsc_oci_value");return await new Promise(t=>setTimeout(t,0)),l?l.textContent.trim():"Authors not found"}catch(c){console.error("Error fetching authors:",c),chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status),window.alert("Large Profile : Rate limit reached. Please re-run GScholarLENS."),window.location.reload()})}return"Authors not found"}catch(d){return console.error("Error fetching authors (batch.map):",d),"Error loading authors"}});i.push(...await Promise.all(l)),Y("main",a/e.length*100,"Fetching URLs("+a+"): "),await new Promise(t=>setTimeout(t,0)),await n()};await n(),await new Promise(t=>setTimeout(t,0))}catch(s){console.log("Error Fetching Authors:",s),await releaseSemaphoreAndReload()}return i}function _(t,e){let o=e;for(;o>0&&(t[o].includes("^")||t[o].includes("*"));)o--;return o}y.min=e,y.max=o,y.value=d.toString(),b[0].min=e,b[0].max=o,b[0].value=l.toString(),b[1].min=e,b[1].max=o,b[1].value=c.toString(),K(l),tt(c),te(d);async function m(){let t=!1,e=new Set;new TextEncoder;let o=[];G.set("publication_progress",U("publication_progress",G.size+1,"Processing Publications...","rgb(103, 0, 172)")),Y("publication_progress",-1,"Processing Publications...");for(let a=0;a<r/2;a++){let n=await createInlineWorker(chrome.runtime.getURL("workers/publicationWorker.min.js"));n.idle=!0,o.push(n)}for(let s=0;s<L.length;s+=i){let l=L.slice(s,s+i).filter(t=>!N.includes(t.index)),c=l.map(t=>t.index);for(;c.some(t=>t>g);)await new Promise(t=>setTimeout(t,50));for(;!o.find(t=>t.idle);)await new Promise(t=>setTimeout(t,100));let d=o.find(t=>t.idle);d.idle=!1,d.onmessage=async({data:o})=>{let r=new TextDecoder("utf-8"),i=r.decode(new Uint8Array(o)),a=JSON.parse(i);if("initialScrape"===a.task&&"working"===a.type){if(L[a.publication.index]=a.publication,a.publication.authors.includes("...")&&a.publication.total_authors>1&&a.publication.total_authors<7||!a.authorFound&&a.extended_scrape){t=!0,L[a.publication.index].extended_scrape=!0;return}switch(u+=1,Y("publication_progress",u/$*100,"Processing Publications ("+u+"): "),await new Promise(t=>setTimeout(t,150)),e.add(a.publication.index),0===a.publication.year.toString().trim().length&&(h+=1),W.get(a.publication.year).has("total_publications")||W.get(a.publication.year).set("total_publications",0),W.get(a.publication.year).set("total_publications",W.get(a.publication.year).get("total_publications")+1),a.publication.author_pos){case"first_author":L[a.publication.index].author_pos_string="1	0	0	0",L[a.publication.index].adjustedCitationCount=a.publication.citations*A[0],L[a.publication.index].citationWeight=A[0];break;case"second_author":L[a.publication.index].author_pos_string="0	1	0	0",L[a.publication.index].adjustedCitationCount=a.publication.citations*A[1],L[a.publication.index].citationWeight=A[1];break;case"co_author":L[a.publication.index].author_pos_string="0	0	1	0",a.publication.total_authors>6?(L[a.publication.index].adjustedCitationCount=.1*a.publication.citations,L[a.publication.index].citationWeight=.1):(L[a.publication.index].adjustedCitationCount=.25*a.publication.citations,L[a.publication.index].citationWeight=.25);break;case"corresponding_author":L[a.publication.index].author_pos_string="0	0	0	1",L[a.publication.index].adjustedCitationCount=a.publication.citations*A[3],L[a.publication.index].citationWeight=A[3]}L[a.publication.index].extended_scrape=!1,tsvContent+=`${a.publication.index}	${a.publication.title}	${a.publication.authors}	${a.publication.authors.includes("...")?`${a.publication.total_authors-1}+`:a.publication.total_authors}	${a.publication.year}	${a.publication.citations}	${L[a.publication.index].adjustedCitationCount}	${L[a.publication.index].citationWeight}	${a.publication.journalTitle}	${a.publication.journalRanking}	${a.publication.impact_factor}	${a.publication.considered}	0	0	0	0
`}if("done"===a.type){D=[...D,...a.authorNamesConsidered],D=Array(...new Set(D));let n=rebuildYearwiseData(a.yearwiseData);a.yearwiseData.length>0&&n.size>0&&await mergeYearwiseData(W,n),d.idle=!0,d.onmessage=null}"error"===a.type&&console.error(`Worker error on ${a.task}:`,a.error)},d.postMessage({task:"initialScrape",batch:l,authorRegexes:tx,authorRegexesEx:tC,nameComboList:tm,otherNamesList:th,authorNameShort:t_,authorName:tl,authorNameLong:t8})}if(t){for(;o.some(t=>!t.idle);)await new Promise(t=>setTimeout(t,100));let b=L.filter(t=>!0===t.extended_scrape).map(t=>t.publicationURL),y=L.filter(t=>!0===t.extended_scrape).map(t=>t.title),_=await f(y,b,b.length,0);(b=[]).length=0,(y=[]).length=0;let m=0;L.forEach(async(t,e)=>{t.extended_scrape&&(t.authors=_[m]||"Authors not found",m++)});for(let x=0;x<L.length;x+=i){let C=L.slice(x,x+i).filter(t=>!N.includes(t.index)).filter(t=>!e.has(t.index)),w=C.map(t=>t.index);for(;w.some(t=>t>g);)await new Promise(t=>setTimeout(t,50));for(;!o.find(t=>t.idle);)await new Promise(t=>setTimeout(t,100));let v=o.find(t=>t.idle);v.idle=!1,v.onmessage=async({data:t})=>{let e=new TextDecoder("utf-8"),o=e.decode(new Uint8Array(t)),r=JSON.parse(o);if("extendedScrape"===r.task&&"working"===r.type){switch(L[r.publication.index]=r.publication,r.authorFound||(p+=1),u+=1,Y("publication_progress",u/$*100,"Processing Publications ("+u+"): "),await new Promise(t=>setTimeout(t,150)),0===r.publication.year.toString().trim().length&&(h+=1),W.get(r.publication.year).has("total_publications")||W.get(r.publication.year).set("total_publications",0),W.get(r.publication.year).set("total_publications",W.get(r.publication.year).get("total_publications")+1),r.publication.author_pos){case"first_author":L[r.publication.index].author_pos_string="1	0	0	0",L[r.publication.index].adjustedCitationCount=r.publication.citations*A[0],L[r.publication.index].citationWeight=A[0];break;case"second_author":L[r.publication.index].author_pos_string="0	1	0	0",L[r.publication.index].adjustedCitationCount=r.publication.citations*A[1],L[r.publication.index].citationWeight=A[1];break;case"co_author":L[r.publication.index].author_pos_string="0	0	1	0",r.publication.total_authors>6?(L[r.publication.index].adjustedCitationCount=.1*r.publication.citations,L[r.publication.index].citationWeight=.1):(L[r.publication.index].adjustedCitationCount=.25*r.publication.citations,L[r.publication.index].citationWeight=.25);break;case"corresponding_author":L[r.publication.index].author_pos_string="0	0	0	1",L[r.publication.index].adjustedCitationCount=r.publication.citations*A[3],L[r.publication.index].citationWeight=A[3];break;default:L[r.publication.index].adjustedCitationCount=0,L[r.publication.index].citationWeight=0}tsvContent+=`${r.publication.index}	${r.publication.title}	${r.publication.authors}	${r.publication.authors.includes("...")?`${r.publication.total_authors-1}+`:r.publication.total_authors}	${r.publication.year}	${r.publication.citations}	${L[r.publication.index].adjustedCitationCount}	${L[r.publication.index].citationWeight}	${r.publication.journalTitle}	${r.publication.journalRanking}	${r.publication.impact_factor}	${r.publication.considered}	0	0	0	0
`}if("done"===r.type){D=[...D,...r.authorNamesConsidered],D=Array(...new Set(D));let i=rebuildYearwiseData(r.yearwiseData);r.yearwiseData.length>0&&i.size>0&&await mergeYearwiseData(W,i),v.idle=!0,v.onmessage=null}"error"===r.type&&console.error(`Worker error on ${r.task}:`,r.error)},v.postMessage({task:"extendedScrape",batch:C,authorRegexes:tx,authorRegexesEx:tC,nameComboList:tm,otherNamesList:th,authorNameShort:t_,authorName:tl,authorNameLong:t8})}}for(;o.some(t=>!t.idle);)await new Promise(t=>setTimeout(t,100));return o.forEach(t=>t.terminate()),Y("publication_progress",100,"Processing Publications :",!0),D=[...D,...tp],D=Array(...new Set(D)),G.set("journal_progress",U("journal_progress",G.size+1,"Processing Journal Rankings...","rgb(0, 97, 207)")),Y("journal_progress",-1,"Processing Journal Rankings..."),u=0,L.forEach(async(t,e)=>{L[e].journalRanking||(L[e].journalRanking="NA"),L[e].impact_factor||(L[e].impact_factor="NA"),function t(e,o,r){if("NA"!==e){if(W.get(o).has("qPosCount")||(W.get(o).set("qPosCount",new Map),W.get(o).get("qPosCount").set("first_author",new Map),W.get(o).get("qPosCount").get("first_author").set("Q1",0),W.get(o).get("qPosCount").get("first_author").set("Q2",0),W.get(o).get("qPosCount").get("first_author").set("Q3",0),W.get(o).get("qPosCount").get("first_author").set("Q4",0),W.get(o).get("qPosCount").get("first_author").set("NA",0),W.get(o).get("qPosCount").set("second_author",new Map),W.get(o).get("qPosCount").get("second_author").set("Q1",0),W.get(o).get("qPosCount").get("second_author").set("Q2",0),W.get(o).get("qPosCount").get("second_author").set("Q3",0),W.get(o).get("qPosCount").get("second_author").set("Q4",0),W.get(o).get("qPosCount").get("second_author").set("NA",0),W.get(o).get("qPosCount").set("co_author",new Map),W.get(o).get("qPosCount").get("co_author").set("Q1",0),W.get(o).get("qPosCount").get("co_author").set("Q2",0),W.get(o).get("qPosCount").get("co_author").set("Q3",0),W.get(o).get("qPosCount").get("co_author").set("Q4",0),W.get(o).get("qPosCount").get("co_author").set("NA",0),W.get(o).get("qPosCount").set("corresponding_author",new Map),W.get(o).get("qPosCount").get("corresponding_author").set("Q1",0),W.get(o).get("qPosCount").get("corresponding_author").set("Q2",0),W.get(o).get("qPosCount").get("corresponding_author").set("Q3",0),W.get(o).get("qPosCount").get("corresponding_author").set("Q4",0),W.get(o).get("qPosCount").get("corresponding_author").set("NA",0)),W.get(o).has("qTotal")||(W.get(o).set("qTotal",new Map),W.get(o).get("qTotal").set("Q1",0),W.get(o).get("qTotal").set("Q2",0),W.get(o).get("qTotal").set("Q3",0),W.get(o).get("qTotal").set("Q4",0),W.get(o).get("qTotal").set("NA",0)),"Q"===r.charAt(0))switch(r.charAt(1)){case"1":let i=W.get(o).get("qPosCount").get(e).get("Q1")+1;W.get(o).get("qPosCount").get(e).set("Q1",i);let a=W.get(o).get("qTotal").get("Q1")+1;W.get(o).get("qTotal").set("Q1",a);break;case"2":let n=W.get(o).get("qPosCount").get(e).get("Q2")+1;W.get(o).get("qPosCount").get(e).set("Q2",n);let s=W.get(o).get("qTotal").get("Q2")+1;W.get(o).get("qTotal").set("Q2",s);break;case"3":let l=W.get(o).get("qPosCount").get(e).get("Q3")+1;W.get(o).get("qPosCount").get(e).set("Q3",l);let c=W.get(o).get("qTotal").get("Q3")+1;W.get(o).get("qTotal").set("Q3",c);break;case"4":let d=W.get(o).get("qPosCount").get(e).get("Q4")+1;W.get(o).get("qPosCount").get(e).set("Q4",d);let g=W.get(o).get("qTotal").get("Q4")+1;W.get(o).get("qTotal").set("Q4",g)}else{let u=W.get(o).get("qPosCount").get(e).get("NA")+1;W.get(o).get("qPosCount").get(e).set("NA",u);let $=W.get(o).get("qTotal").get("NA")+1;W.get(o).get("qTotal").set("NA",$)}}}(L[e].author_pos,L[e].year,L[e].journalRanking),u+=1,Y("journal_progress",u/$*100,"Processing Journal Rankings ("+u+"): "),await new Promise(t=>setTimeout(t,0))}),Y("journal_progress",100,"Processing Journal Rankings :",!0),!0}async function x(){G.set("retract_progress",U("retract_progress",G.size+1,"Processing Retractions...","rgb(255, 251, 0)")),Y("retract_progress",-1,"Processing Retractions..."),await new Promise(t=>setTimeout(t,150)),retractionWatchDB=await getRetractionWatchDB();let t=[];for(let e=0;e<r/2;e++){let o=await createInlineWorker(chrome.runtime.getURL("workers/retractionWorker.min.js"));o.idle=!0,t.push(o)}for(let a=0;a<L.length;a+=i){let n=L.slice(a,a+i);for(;!t.find(t=>t.idle);)await new Promise(t=>setTimeout(t,100));let s=t.find(t=>t.idle);s.idle=!1,s.onmessage=async({data:t})=>{let e=new TextDecoder("utf-8"),o=e.decode(new Uint8Array(t)),r=JSON.parse(o);"checkRetraction"===r.task&&"working"===r.type&&(g+=1,Y("retract_progress",g/$*100,"Processing Retractions ("+g+"): "),await new Promise(t=>setTimeout(t,150)),r.publication.retracted?(L[r.publication.index].retracted=!0,N.push(r.publication.index),k++):L[r.publication.index].retracted=!1),"done"===r.type&&(s.idle=!0,s.onmessage=null),"error"===r.type&&console.error(`Worker error on ${r.task}:`,r.error)},s.postMessage({task:"checkRetraction",batch:n,retractionWatchDB})}for(;t.some(t=>!t.idle);)await new Promise(t=>setTimeout(t,100));return t.forEach(t=>t.terminate()),Y("retract_progress",100,"Processing Retractions : "),!0}Y("main",-1,"Please Wait...",!0);let[C,w]=await Promise.all([m(),x()]);function v(t,e){for(let[o,r]of e.entries())if(r instanceof Map)t.has(o)||t.set(o,new Map),v(t.get(o),r);else if(Array.isArray(r)){let i=t.get(o)||[];t.set(o,[...i,...r])}else"number"==typeof r?t.set(o,(t.get(o)||0)+r):t.set(o,r)}L.sort((t,e)=>t.index-e.index),t.forEach(async(t,e)=>{let o=L[e].author_pos;t.author_pos=o;let r=t.querySelector(".gs_gray");if(r){var i,a;let n="#ddd";if(!N.includes(e))switch(o){case"first_author":n="#3b8888";break;case"second_author":n="#5d33b8";break;case"co_author":n="#e68a41";break;case"corresponding_author":n="#3a83b2";break;default:n="#ddd"}let s=DOMPurify.sanitize(`
                        <div class="position-circles" style="display: flex; gap: 5px; margin-top: 2px; margin-left: 2px; align-items: center; position: relative;">
                            <div class="circles-container" style="display: flex; gap: 5px; margin-right: 0.30%; margin-left: 0.15%;">
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"first_author"===o?n:"#ddd"};"
            ${"first_author"===o?'data-role="First Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"second_author"===o?n:"#ddd"};"
            ${"second_author"===o?'data-role="Second Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"co_author"===o?n:"#ddd"};"
            ${"co_author"===o?'data-role="Co-Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"corresponding_author"===o?n:"#ddd"};"
            ${"corresponding_author"===o?'data-role="Corresponding Author"':""}
        ></span>
                            </div>
                            <div class="q-badge" style="
                                /*opacity: 0;*/
                                transition: all 0.2s ease-in-out;
                                background: ${{Q1:"#2e7d32",Q2:"#689f38",Q3:"#f9a825",Q4:"#ef6c00"}[i=L[e].journalRanking]||"#607d8b"};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.8em;
                                margin-right: 0.25%;
                                margin-left: 0.25%;
                                /*position: absolute;
                                left: 100%;*/
                                white-space: nowrap;
                                pointer-events: none;
                            ">
                                ${L[e].journalRanking}
                            </div>
                            <div class="if-badge" style="
                                /*opacity: 0;*/
                                transition: all 0.2s ease-in-out;
                                background: ${{Q1:"#2e7d32",Q2:"#689f38",Q3:"#f9a825",Q4:"#ef6c00"}[a=L[e].impact_factor]||"#607d8b"};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.8em;
                                margin-right: 0.25%;
                                margin-left: 0.25%;
                                /*position: absolute;
                                left: 100%;*/
                                white-space: nowrap;
                                pointer-events: none;
                            ">
                                IF5: ${L[e].impact_factor}
                            </div>
                        </div>
                    `),l=t.querySelector(".position-circles");l?l.outerHTML=s:r.insertAdjacentHTML("afterend",s)}await new Promise(t=>setTimeout(t,0))}),await new Promise(t=>setTimeout(t,0)),t.forEach(async(t,e)=>{if(!N.includes(e)){t.retracted=!1;return}t.retracted=!0;let o=t.querySelector(".gs_gray"),r=DOMPurify.sanitize(`
                <div class="blink_text"><div class="retraction-notice" style="margin-top: 5px; color: #ff0000; font-weight: bold;">
                RETRACTED</div></div>
            `);o.insertAdjacentHTML("afterend",r),await new Promise(t=>setTimeout(t,0))});W.get("")&&W.delete(""),profileScraped=!0,(async()=>{await releaseSemaphore()})()};async function tW(){G.forEach((t,e)=>{H(e)}),G.clear(),G.set("publication_cards",U("publication_cards",G.size+1,"Selecting Publications...","rgb(255, 255, 255)")),isDesktop&&loadScript(T,t4,"plot_script_decade"),loadScript(T,tL,"plot_script_author"),J.style.display="none",k>0&&function t(e,o=500){let r=document.querySelectorAll(`.${e}`);r.forEach(async t=>{let e=!0;setInterval(()=>{t.style.visibility=e?"hidden":"visible",e=!e},o)})}("blink_text",1250)}async function t5(){for(;!profileScraped;)await new Promise(t=>setTimeout(t,100));let t=[];x=L.length,L.sort((t,e)=>e.citations-t.citations),q.forEach((e,o)=>{L.filter(t=>t.author_pos===e.toLowerCase()).sort((t,e)=>e.adjustedCitationCount-t.adjustedCitationCount).filter(t=>!1===t.retracted).forEach(e=>{let r=-1;switch(e.author_pos){case"first_author":case"second_author":case"co_author":case"corresponding_author":r=o;break;default:r=-1}if(r>=0){P[r]++;let i=e.adjustedCitationCount;t.push(i),i>=P[r]&&E[r]++}})}),b=E[0],y=E[1],f=E[2],_=E[3],t.sort((t,e)=>e-t),t.forEach((t,e)=>{t>=e+1&&(m=e+1)}),v=L.filter(t=>t.citations<=0&&!t.retracted).length,w=t[Math.floor(t.length/2)],C=L[Math.floor(L.length/2)].citations,document.getElementById("sh_index").textContent=DOMPurify.sanitize(`Sh-Index : ${m.toFixed(0)}`),document.getElementById("h_first").textContent=DOMPurify.sanitize(`${b.toString()}`),document.getElementById("h_second").textContent=DOMPurify.sanitize(`${y.toString()}`),document.getElementById("h_other").textContent=DOMPurify.sanitize(`${f.toString()}`),document.getElementById("h_co").textContent=DOMPurify.sanitize(`${_.toString()}`),document.getElementById("medianCitationsAdj").textContent=DOMPurify.sanitize(`${w.toString()}`),document.getElementById("medianCitationsRaw").textContent=DOMPurify.sanitize(`${C.toString()}`),document.getElementById("zeroCitationPubs").textContent=DOMPurify.sanitize(`${v.toString()}`),document.getElementById("retractedPubsCount").textContent=DOMPurify.sanitize(`${k.toString()}`),document.getElementById("preprintCount").textContent=DOMPurify.sanitize(`${S.toString()}`)}let t7=async()=>{let e=document.querySelector("#gsc_bpf_more");if(await new Promise(t=>setTimeout(t,1e3)),!e)return await new Promise(t=>setTimeout(t,2e3)),t7();if(!e.hasAttribute("disabled"))return e.click(),await new Promise(t=>setTimeout(t,1500)),t7();{$=document.querySelectorAll(".gsc_a_at").length;let o=parseInt(document.querySelector("#gsc_a_nn").textContent.split(/[-–]/)[1].trim());if($>o)return await new Promise(t=>setTimeout(t,2e3)),t7();{await tD(),t5(),tW();let r=performance.now(),i=r-t,a=Math.floor(i/36e5),n=Math.floor(i%36e5/6e4),s=(i%6e4/1e3).toFixed(2),l=[];a>0&&l.push(`${a}h`),n>0&&l.push(`${n}m`),l.push(`${s}s`),console.info(`Time taken by GScholarLENS: ${l.join(" ")}`)}}};Y("main",-1,"Waiting for other GScholarLENS processes to complete...",!0),chrome.runtime.sendMessage({type:"get_semaphore"},t=>{try{console.log(t.status),Y("main",-1,"Expanding Publications List...",!0);let e=window.location.href.toString();fetch(e).then(t=>{200!=t.status&&(async()=>{await releaseSemaphoreAndReload()})()}),async function(){excelData=await getJCRExcel(),retractionWatchDB=await getRetractionWatchDB()}(),t7()}catch(o){console.error("Error scraping profile:",o),document.getElementsByTagName("body")[0].style.overflow="visible",(async()=>{await releaseSemaphore()})()}})}catch(tF){console.error("Error scraping:",tF),document.getElementsByTagName("body")[0].style.overflow="visible",(async()=>{await releaseSemaphore()})()}return!0}