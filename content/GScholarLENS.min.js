const fontPath=chrome.runtime.getURL("fonts/SchibstedGrotesk.ttf"),schibsted_grotesk=new FontFace("schibsted-grotesk",`url(${fontPath})`);let excelData=!1,retractionWatchDB=!1,profileScraped=!1,tsvContent="Index	Title	Authors	Total_Authors	Year	Citations	Adjusted_Citations	Adjusment_Weight	Journal	Q*	ImpactFactor_5years	Publication_Considered	First_Author	Second_Author	Co_Author	Corresponding_Author\n";async function loadScript(t,e,r){var o=document.head,a=document.createElement("script");return a.type="text/javascript",a.src=t,a.id=r,a.onreadystatechange=e,a.onload=e,o.appendChild(a),!0}function releaseSemaphoreAndReload(){chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status),window.location.reload()})}function releaseSemaphore(){chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})}function enableButton(){let t=document.getElementById("inject-content-button");t.textContent="Run GScholarLENS",t.disabled=!1,t.textContent.color="white",t.style.width="fit-content",t.style.display="flex",t.style.alignItems="center",t.style.gap="5px",t.style.fontSize="16px",t.style.color="white",t.style.marginTop="20px",t.style.marginBottom="10px",t.style.zIndex="1000",t.style.borderRadius="7px",t.style.cursor="pointer",t.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",t.style.fontFamily="schibsted-grotesk, sans-serif",t.style.backgroundColor="rgba(0,0,0,0.8)";let e=document.createElement("img");e.src=chrome.runtime.getURL("icons/icon128.png"),e.alt="GScholarLENS",e.style.height="20px",e.style.width="20px",e.style.objectFit="contain",t.prepend(e)}schibsted_grotesk.load().then(t=>{document.fonts.add(t),document.body.style.fontFamily="schibsted-grotesk, sans-serif"}).catch(t=>{console.error("Font failed to load:",t)}),window.addEventListener("error",t=>{console.error("Uncaught error:",t),releaseSemaphore()},!0),window.addEventListener("unhandledrejection",t=>{console.error("Unhandled rejection:",t),releaseSemaphore()},!0),window.addEventListener("beforeunload",()=>{releaseSemaphore()},!0),createButton(),chrome.runtime.sendMessage({type:"wait_for_initialization"},t=>{console.log(t.status),async function(){let t=window.location.href.toString(),e=await fetchWithSessionCache(t,t,refetch=!0);200!=e.status&&releaseSemaphoreAndReload(),excelData=await getJCRExcel(),retractionWatchDB=await getRetractionWatchDB(),enableButton()}()});const cyrb53=(t,e=0)=>{let r=3735928559^e,o=1103547991^e;for(let a=0,n;a<t.length;a++)r=Math.imul(r^(n=t.charCodeAt(a)),2654435761),o=Math.imul(o^n,1597334677);return r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(o^o>>>13,3266489909),o=Math.imul(o^o>>>16,2246822507),4294967296*(2097151&(o^=Math.imul(r^r>>>13,3266489909)))+(r>>>0)};async function fetchWithSessionCache(t,e,r=!1){if(!t||0===t.length)return null;let o=cyrb53(t),a=await sessionStorage.getItem(o);if(a&&!r)return a;try{let n=await fetch(e);return n&&200==n.status&&await sessionStorage.setItem(o,n),n}catch(i){return console.error("Error fetching data:",i),null}return!0}function getRandomArbitrary(t,e){return Math.random()*(e-t)+t}function getRandomInt(t,e){return t=Math.ceil(t),Math.floor(Math.random()*((e=Math.floor(e))-t+1))+t}async function createInlineWorker(t){let e=await fetch(t),r=await e.text(),o=new Blob([r],{type:"application/javascript"}),a=URL.createObjectURL(o),n=new Worker(a);return n.addEventListener("online",()=>URL.revokeObjectURL(a)),n.addEventListener("offline",()=>{URL.revokeObjectURL(a),o.dispose()}),n}async function getJCRExcel(){try{return new Promise(t=>{chrome.storage.local.get("jcrJSON",e=>{t(e.jcrJSON||!1)})})}catch(t){console.error("Error: Could not fetch JCR excel data. "+t),releaseSemaphore()}}async function getRetractionWatchDB(){try{return new Promise(t=>{chrome.storage.local.get("retractionwatchdb",e=>{t(e.retractionwatchdb||!1)})})}catch(t){console.error("Error: Could not RetractionWatchDB blob data. "+t),releaseSemaphore()}}function createButton(){if(document.getElementById("inject-content-button")){let t=document.getElementById("inject-content-button");t.style.display="none";return}let e=document.createElement("button");e.id="inject-content-button",e.textContent="Initializing GScholarLENS...",e.disabled=!0,e.style.width="fit-content",e.style.display="flex",e.style.alignItems="center",e.style.gap="5px",e.style.fontSize="16px",e.style.marginTop="20px",e.style.marginBottom="10px",e.style.zIndex="1000",e.style.borderRadius="7px",e.style.cursor="not-allowed",e.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",e.style.fontFamily="schibsted-grotesk, sans-serif";let r=document.createElement("img");r.src=chrome.runtime.getURL("icons/icon128.png"),r.alt="GScholarLENS",r.style.height="20px",r.style.width="20px",r.style.objectFit="contain",e.prepend(r);let o=document.querySelector("#gsc_prf");o.append(e),e.addEventListener("click",()=>{try{startScraping(),e.style.display="none"}catch(t){console.error("Error at startScraping() event: "+t),e.style.display="none",releaseSemaphore()}},{passive:!0})}function rebuildYearwiseData(t){let e=new Map;for(let[r,o]of t){let a=new Map;for(let[n,i]of o){let s;s=Array.isArray(i)&&i.every(([t,e])=>Array.isArray(e)&&e.every(t=>Array.isArray(t)&&2===t.length))?new Map(i.map(([t,e])=>[t,new Map(e)])):Array.isArray(i)&&i.every(t=>Array.isArray(t)&&2===t.length)?new Map(i):i,a.set(n,s)}e.set(r,a)}return e}async function mergeYearwiseData(t,e){for(let[r,o]of e.entries())for(let[a,n]of(t.has(r)||t.set(r,new Map),o.entries())){t.get(r).has(a)||t.get(r).set(a,new Map);let i=t.get(r).get(a),s=n;for(let[l,c]of s.entries())if(i.has(l)){let d=i.get(l);if("number"==typeof d&&"number"==typeof c)i.set(l,d+c);else if(d instanceof Map&&c instanceof Map)for(let[g,u]of c.entries())d.has(g)?d.set(g,d.get(g)+u):d.set(g,u);else Array.isArray(d)&&Array.isArray(c)?i.set(l,[...new Set([...d,...c])]):console.warn(`Incompatible types for key ${l} in year ${r}`)}else i.set(l,c)}}function startScraping(){try{let t=performance.now();document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&!0===profileScraped&&t6()}),window.addEventListener("focus",()=>{!0===profileScraped&&t6()}),document.getElementsByTagName("body")[0].style.overflow="hidden";let e=0,r=0,o=Math.max(1,navigator.hardwareConcurrency-1),a=!1,n=!1,i=!1,s=0,l=0,c=0,d=0,g=0,u=0,$=0,h=0,p=0,b=0,f=0,_=0,y=0,m=0,x=0,C=0,w=0,v=0,k=[.9,.5,.1,1],S=[0,0,0,0],A=[0,0,0,0],q=new Map,E=/^(.*?)(?=\s+\d|,|\s\()/,P=["rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)","rgba(54, 162, 235, 0.2)"],Q=["rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(54, 162, 235, 1)"],z=[["rgba(166, 54, 3, 0.4)","rgba(84, 39, 143, 0.4)","rgba(0, 109, 44, 0.4)","rgba(8, 81, 156, 0.4)"],["rgba(230, 85, 13, 0.4)","rgba(117, 107, 177, 0.4)","rgba(49, 163, 84, 0.4)","rgba(49, 130, 189,0.4)"],["rgba(253, 141, 60, 0.4)","rgba(158, 154, 200, 0.4)","rgba(116, 196, 118, 0.4)","rgba(107, 174, 214, 0.4)"],["rgba(253, 190, 133, 0.4)","rgba(203, 201, 226, 0.4)","rgba(186, 228, 179, 0.4)","rgba(189, 215, 231, 0.4)"],["rgba(254, 237, 222, 0.4)","rgba(242, 240, 247, 0.4)","rgba(237, 248, 233, 0.4)","rgba(239, 243, 255, 0.4)"]],j=[["rgb(127, 44, 2)","rgb(58, 27, 107)","rgb(0, 75, 28)","rgb(5, 52, 105)"],["rgb(179, 63, 11)","rgb(89, 79, 137)","rgb(38, 122, 62)","rgb(35, 97, 138)"],["rgb(184, 94, 42)","rgb(108, 106, 148)","rgb(78, 139, 82)","rgb(73, 115, 155)"],["rgb(194, 151, 99)","rgb(157, 156, 186)","rgb(145, 161, 135)","rgb(148, 173, 197)"],["rgb(205, 141, 108)","rgb(180, 168, 207)","rgb(157, 208, 150)","rgb(150, 180, 230)"]],R=chrome.runtime.getURL("libs/chart.umd.js"),T=chrome.runtime.getURL("libs/papaparse.min.js"),B=[],I=[],L=new Map,N=[],D=document.createElement("div");D.style.marginTop="50px",D.style.width="100%",D.style.backgroundColor="#ddd",D.style.borderRadius="8px",D.style.overflow="hidden",D.style.position="relative";let W=new Map;function F(t,e,r,o="#4caf50"){let a=document.createElement("div");a.id=t;let n=document.createElement("span");n.id=t+"_text",n.style.position="absolute",n.style.width="100%",n.style.textAlign="center",n.style.alignSelf="center",n.style.justifySelf="center",n.style.fontSize="calc(0.3em + 0.55vw)",n.style.color="#000",n.style.whiteSpace="nowrap",n.style.fontFamily="schibsted-grotesk, sans-serif";let i=document.createElement("div");return i.id=t+"_bar",i.style.width="0%",i.style.height="20px",i.style.borderRadius="8px",i.style.display="flex",i.style.margin="3px 3px 3px 3px",i.style.backgroundColor=o,i.style.transition="width 0.3s ease",i.appendChild(n),D.appendChild(i),a}async function J(t="main",e,r="Progress: ",o=!1,a=20,n=5){(e<=0||e>=100||e%n||o)&&(setTimeout(M,a,t,e,r),await Promise.resolve())}async function M(t="main",e,r="Progress: "){let o=W.get(t);if(o){let a=document.getElementById(t+"_text"),n=document.getElementById(t+"_bar"),i=parseFloat(n.style.marginLeft)||0,s=parseFloat(n.style.marginRight)||0;e>=0?(n.style.width=n.style.width=`calc(${e.toFixed(2)}% - ${i+s}px)`,a.textContent=r+`${e.toFixed(2)}%`):a.textContent=r,e>=100&&await new Promise(t=>setTimeout(t,1e3))}}W.set("main",F("main",W.size+1,"","#4caf50"));let U=document.querySelector("#gsc_prf_w");U.appendChild(D);let G=document.createElement("div");function Y(t=-1){let o=document.querySelectorAll(".double_range_slider_box input"),a=document.getElementById("double_range_track"),n=document.querySelector(".minvalue"),i=document.querySelector(".maxvalue"),l=t>0?t:parseInt(o[0].value),c=parseInt(o[1].value);c-l<1&&(o[0].value=c-1);let d=parseInt(o[0].value),g=parseInt(o[1].value);a.style.left=(d-e)/(r-e)*100+"%",a.style.right=100-(g-e)/(r-e)*100+"%",n.textContent=d,i.textContent=g,n.style.left=(d-e)/(r-e)*100+"%",i.style.left=(g-e)/(r-e)*100+"%",s=parseInt(o[0].value)}function H(t=-1){let o=document.querySelectorAll(".double_range_slider_box input"),a=document.getElementById("double_range_track"),n=document.querySelector(".minvalue"),i=document.querySelector(".maxvalue"),s=parseInt(o[0].value),c=t>0?t:parseInt(o[1].value);c-s<1&&(o[1].value=s+1);let d=parseInt(o[0].value),g=parseInt(o[1].value);a.style.left=(d-e)/(r-e)*100+"%",a.style.right=100-(g-e)/(r-e)*100+"%",n.textContent=d,i.textContent=g,n.style.left=(d-e)/(r-e)*100+"%",i.style.left=(g-e)/(r-e)*100+"%",l=parseInt(o[1].value)}function O(t=-1){let o=document.getElementById("single_range_track"),a=document.getElementById("single_range"),n=document.querySelector(".singlevalue"),i=t>0?t:parseInt(a.value);o.style.right=100-(i-e)/(r-e)*100+"%",o.style.left="0%",n.textContent=i,n.style.left=(i-e)/(r-e)*100+"%",c=i}function Z(){let t=document.getElementById("cumulative_checkbox"),e=document.getElementById("single_range_track"),r=document.getElementById("peryear_checkbox");t.checked?(e.style.display="flex",i=!0):(e.style.display="none",i=!1),a=r.checked,n=t.checked}function X(){let t=document.getElementById("cumulative_checkbox"),e=document.querySelector('label[for="cumulative_checkbox"]'),r=document.getElementById("peryear_checkbox"),o=document.getElementById("double_range_slider"),s=document.getElementById("single_range_slider");r.checked?(o.style.display="none",s.style.display="flex",t.style.display="inline-block",e.style.display="inline-block",i?(t.checked=!0,Z()):t.checked=!1):(o.style.display="flex",s.style.display="none",t.style.display="none",e.style.display="none"),a=r.checked,n=t.checked}G.setAttribute("id","chart-viz"),G.style.display="none",U.appendChild(G),!function t(){let o=document.createElement("style");o.textContent=`
            .range_slider_wrapper {
    display: flex;
    justify-content: center;  /* Center the content */
    align-items: center;
    width: 100%;
    padding: 20px;
    box-sizing: border-box;
    background-color: #f5f5f5;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);  /* Shadow effect */
    border-radius: 15px;  /* Rounded border */
}

.range_slider_container {
    width: 400px; /* Decrease the overall width of the container */
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
}

.toggle_container {
    margin-bottom: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
    transform: translate(0, 20%);
}

#peryear_checkbox {
    display: inline-block;
    width: 15px; /* Adjust size as needed */
    height: 15px;
    position: relative;
    margin: 15px 0 0 0;
    padding: 0;
    pointer-events: auto;
    cursor: pointer;
    background-color: white; /* Default background */
    border: 2px solid black;
    border-radius: 4px; /* For rounded corners */
}

#peryear_checkbox:checked {
    background-color: black;
    border-color: black;
}

#peryear_checkbox:checked::after {
    content: '✓';
    color: white;
    font-size: 16px; /* Adjust size as needed */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

#cumulative_checkbox {
    display: inline-block;
    width: 15px; /* Adjust size as needed */
    height: 15px;
    position: relative;
    margin: 15px 15px 0 0;
    padding: 0;
    pointer-events: auto;
    cursor: pointer;
    background-color: white; /* Default background */
    border: 2px solid black;
    border-radius: 4px; /* For rounded corners */
}

#cumulative_checkbox:checked {
    background-color: black;
    border-color: black;
}

#cumulative_checkbox:checked::after {
    content: '✓';
    color: white;
    font-size: 16px; /* Adjust size as needed */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.double_range_slider_box, .single_range_slider_box {
    position: relative;
    width: 100%; /* Adjust width */
    max-width: 250px; /* Decrease max-width */
    height: 80px; /* Decrease height */
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 20px;
    overflow: visible;
}

.range_slider {
    width: 100%;
    height: 8px; /* Decrease slider height */
    position: relative;
    background-color: #dddddd;
    border-radius: 20px;
}

.range_track {
    height: 100%;
    position: absolute;
    border-radius: 20px;
    background-color: #000000; /* Light grey */
    z-index: 1;
    transition: width 0.3s ease-in-out;  /* Smooth transition */
    left: 0;  /* Ensure it starts from the left */
    top: 0;
}

.minvalue, .maxvalue, .singlevalue {
    position: absolute;
    padding: 3px 8px; /* Decrease padding */
    background: #0e5f59;
    border-radius: 1rem;
    color: white;
    font-size: 0.8rem; /* Reduce font size */
    z-index: 10;
    white-space: nowrap;
    max-width: fit-content;
}

/* Position adjustments */
.minvalue {
    left: 0;
    width: fit-content;
    transform: translate(-50%, 80%);
    transition: left 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.maxvalue {
    right: 0;
    width: fit-content;
    transform: translate(-50%, -120%);
    transition: right 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.singlevalue {
    width: fit-content;
    transform: translate(-50%, -120%);
    transition: right 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

/* General range slider input settings */
input {
    position: absolute;
    width: 100%;
    height: 5px;
    background: none;
    pointer-events: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    top: 50%;
    transform: translate(-0.75%,-75%);
    z-index: 3;
}

/* Thumb style for Webkit (Chrome, Safari) */
input::-webkit-slider-thumb {
    height: 20px; /* Decrease thumb size */
    width: 20px;
    border-radius: 50%;
    border: 3px solid #696969; /* Light grey for border */
    background-color: #d3d3d3; /* Dark grey for thumb */
    pointer-events: auto;
    -webkit-appearance: none;
    cursor: pointer;
    margin-bottom: 0;
    z-index: 4;
}

/* Thumb style for Mozilla (Firefox) */
input::-moz-range-thumb {
    height: 20px; /* Decrease thumb size */
    width: 20px;
    border-radius: 50%;
    border: 3px solid #696969; /* Light grey for border */
    background-color: #d3d3d3; /* Dark grey for thumb */
    pointer-events: auto;
    -moz-appearance: none;
    cursor: pointer;
    margin-top: 0;
    z-index: 4;
}
/* CSS styles for sharma_index_container and sh_table */
.sharma_index_container {
    font-size: 1.0rem;
    font-weight: 500;
    margin-bottom: 10px;
    justify-content: center;
    display: inline-block;
}

/* .sh_table_container {
    width: 80%;
    border: black;
    border-style: solid;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
    border-bottom-left-radius: 10px;
    display: block;
    margin: 0 auto;
}

.sh_table_container table td, 
.sh_table_container table th {
  border: 1px solid black;
} */

  .sh_table_container-outer {
  border: 2px solid #2c3e50;
  border-radius: 12px;
  overflow: hidden;
  width: 100%;
  max-width: 600px;
  margin: 1rem 0;
  margin-left: auto;
  margin-right: auto;
}

.sh_table_container-inner {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

.sh_table_container-inner th,
.sh_table_container-inner td {
  padding: 14px;
  text-align: left;
  border-bottom: 1px solid #ecf0f1;
  border-right: 1px solid #ecf0f1;
}

.sh_table_container-inner th {
  background-color: #34495e;
  color: white;
  border-right: 1px solid #2c3e50;
}

.sh_table_container-inner tr:last-child td {
  border-bottom: none;
}

.sh_table_container-inner td:last-child,
.sh_table_container-inner th:last-child {
  border-right: none;
}

/* Thanks DeepSeek R1 */
.journalTableStyle {
  border: 2px solid #333;
  border-radius: 10px;
  overflow: hidden;
  border-collapse: separate;
  border-spacing: 0px;
  /*border-collapse: collapse;*/
  width: 100%;
  max-width: 600px;
  margin: 1rem 0;
}

.journalTableStyle th,
.journalTableStyle td {
  padding: 12px;
  text-align: left;
  border: none;
}

.journalTableStyle thead {
  background-color: #f8f8f8;
}

.plotmetrics_table {
    table-layout: fixed;
    width: auto;
}

.plotmetrics_table_container {
    display: flex;
    justify-content: center;
}

.yearplot_table_container {
  width: 70%;
  height: 100%;
  position: relative;
}

#tenyearPubCountChart {
  width: 80% !important; /*ONLY CHANGE THIS to modify width of decade plot*/
  height: 100% !important;
} 

.position-circles {
    transition: all 0.2s ease-in-out;
    position: relative;
}

.circles-container {
    transition: all 0.2s ease-in-out;
    position: relative;
}

.position-circles:hover .circles-container{
    transform: scale(1.10);
    z-index: 1000;
    opacity: 1;
}

.position-circles:hover .q-badge {
    opacity: 1;
    transform: scale(1.10) ;/*translateX(50%);  Combine transforms */;
    z-index: 1000;
}

.position-circles:hover .if-badge {
    opacity: 1;
    transform: scale(1.10) ;/*translateX(55%);  Combine transforms */;
    z-index: 1000;
}

/* Optional: Add tooltip for circle meanings */
.position-circles span {
    position: relative;
    /*cursor: help;*/
}

.position-circles span[data-role]:hover::after {
    content: attr(data-role);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%); 
    background: #333;
    color: white;
    padding: 4px 8px;
    margin-bottom: 5px;
    z-index: 10;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    transform: translateX(-50%) scale(1/1.15); /* Counteract parent scale */
}
            `,document.head.appendChild(o);let a=document.querySelector("#chart-viz");a.style.marginTop="50px",a.innerHTML=DOMPurify.sanitize(`
                    <div id="GScholarLENS">
                        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
                        <div style="font-family = 'schibsted-grotesk, sans-serif'; padding: 20px; marginTop: 10px; margin: 35px; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.05); background-color: #fff;">
                            <div style="text-align: center;">
                                <div class="sharma_index_container">
                                    <h2 id="sh_index">Sh-Index : ${_}</h2>
                                </div>
                            </div>
                            <br>
                            <div class="sh_table_container-outer">
                                <table class="sh_table_container-inner" /*style="width: 100%;"*/>
                                    <tr>
                                        <th style="text-align: center; padding: 8px 0;">H<sub>First</sub> - First Author</th>
                                        
                                        <th style="text-align: center; padding: 8px 0;">H<sub>Second</sub>- Second Author</th>
                                        
                                        <th style="text-align: center;">H<sub>Other</sub> - Co Author</th>
                                        
                                        <th style="text-align: center; padding: 8px 0;">H<sub>Co</sub> - Corresponding Author</th>
                                        
                                    </tr>
                                    <tr>
                                        <td id="h_first" style="text-align: center;">${h}</td>
                                        <td id="h_second" style="text-align: center;">${p}</td>
                                        <td id="h_other" style="text-align: center;">${b}</td>
                                        <td id="h_co" style="text-align: center;">${f}</td>
                                    </tr>
                                </table>
                            </div>
                            <br>
                            <div class="plotmetrics_table_container">
                                <table class="plotmetrics_table" >
                                    <tbody class="plotmetrics_table_container">
                                    <tr>
                                        <td id="table_metrics" style="border-right: 1px solid black; padding-right: 15px; text-align: center; padding-left: 15px;">
                                        <div class="metrics_table_container">
                                        <table >
                                            <tr>
                                                <th style="text-align: left;"><b>Total Publications:</b></th>
                                                <td id="total_pubs" style="text-align: center;">${g}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Publications Considered:</b></th>
                                                <td id="considered_pubs" style="text-align: center;">${g-u}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Publications Not Counted:</b></th>
                                                <td id="ignored_pubs" style="text-align: center;">${u}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Median - Raw Citations:</b></th>
                                                <td id="medianCitationsRaw" style="text-align: center;">${m}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Median - Adjusted Citations:</b></th>
                                                <td id="medianCitationsAdj" style="text-align: center;">${x}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Zero Citations:</b></th>
                                                <td id="zeroCitationPubs" style="text-align: center;">${C}</td>
                                            </tr>
                                            <tr>
                                                <th class="blink_text" style="color: red; text-align: left;"><b>Total Retractions:</b></th>
                                                <td id="retractedPubsCount" style="text-align: center;">${w}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Total Preprints:</b></th>
                                                <td id="preprintCount" style="text-align: center;">${v}</td>
                                            </tr>
                                        </table>
                                        </div>
                                        </td>
                                        <td id="year_plot" style="width: 100%;">
                                            <div class="plotmetrics_table_container"><canvas id="tenyearPubCountChart" class="yearplot_table_container"></canvas></div>
                                        </td>                                        
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <center><span id="pubmachine_banner" style="color: blue; font-weight: bold;"></span></center>
                            <br>
                            <div class="range_slider_container">
                                <div class="toggle_container">
                                    <label for="peryear_checkbox" style="transform: translateY(-3px);">Per-Year</label>
                                    <input type="checkbox" id="peryear_checkbox"/>
                                    <label for="cumulative_checkbox" style="transform: translateY(-3px);">Cumulative</label>
                                    <input type="checkbox" id="cumulative_checkbox"/>
                                </div>

                                <!-- Double Range Slider -->
                                <div class="double_range_slider_box" id="double_range_slider">
                                    <div class="range_slider">
                                        <span class="range_track" id="double_range_track"></span>
                                        <input class="double_range" type="range" class="min" min="${e}" max="${r}" value="${s}" step="1" />
                                        <input class="double_range" type="range" class="max" min="${e}" max="${r}" value="${l}" step="1" />
                                        <div class="minvalue"></div>
                                        <div class="maxvalue"></div>
                                    </div>
                                </div>

                                <!-- Single Range Slider -->
                                <div class="single_range_slider_box" id="single_range_slider">
                                    <div class="range_slider">
                                        <span class="range_track" id="single_range_track"></span>
                                        <input id="single_range" type="range" class="single" min="${e}" max="${r}" value="${l}" step="1" />
                                        <div class="singlevalue"></div>
                                    </div>
                                </div>
                            </div>
                            <canvas id="qScorePosStackedChart"></canvas>
                            <canvas id="authorCitationsChart"></canvas>
                            <canvas id="authorCitationsDistChart"></canvas>                            
                            <div id="authorStackedChartDiv" style="width: 100%; height: 10%;">
                                <canvas id="authorStackedChart"></canvas>
                            </div>
                            <div id="citationsStackedChartDiv" style="width: 100%; height: 10%;">
                                <canvas id="citationsStackedChart"></canvas>
                            </div>

                                <br>
                                <b>Author Names Considered: </b><span id="using_author_names">${I.toString()}</span>
                                <br>
                            <b>Top 3 Journals: </b>
                            <div id="journalTable" style="display: flex; justify-content: center;"></div>
                        </div>
                    </div>
                    `);let n=document.getElementById("cumulative_checkbox"),i=document.getElementById("peryear_checkbox");i.addEventListener("change",X),n.addEventListener("change",Z);let c=document.querySelectorAll(".double_range_slider_box input"),d=document.getElementById("single_range");c[0].addEventListener("input",Y),c[1].addEventListener("input",H),d.addEventListener("input",O),i.addEventListener("change",t6),n.addEventListener("change",t6),d.addEventListener("change",t6),c.forEach(t=>{t.addEventListener("change",t6)})}();let V=document.createElement("button");V.id="helpButton",V.style.fontFamily="schibsted-grotesk, sans-serif",V.style.marginTop="10px",V.style.marginRight="10px",V.textContent="GScholarLENS Help",V.addEventListener("click",function(){window.open("https://project.iith.ac.in/sharmaglab/gscholarlens/","_blank")}),U.appendChild(V);let K=document.createElement("button");K.id="downloadDetailsButton",K.disabled=!0,K.style.fontFamily="schibsted-grotesk, sans-serif",K.style.marginTop="10px",K.style.marginRight="10px",K.textContent="Download Details",U.appendChild(K),K.addEventListener("click",function(){let t=new Blob([tsvContent],{type:"text/tab-separated-values"}),e=URL.createObjectURL(t),r=document.createElement("a");r.href=e,r.download=`${tr.replace(/\s+/g,"_")}_publications.tsv`,r.click()});let tt=document.createElement("button");tt.id="downloadPlotsButton",tt.disabled=!0,tt.style.fontFamily="schibsted-grotesk, sans-serif",tt.style.marginTop="10px",tt.style.marginRight="10px",tt.textContent="Download Plots",U.appendChild(tt),tt.addEventListener("click",function(){let t=chrome.runtime.getURL("libs/dom-to-image-more.min.js");loadScript(t,function t(){var e=document.getElementById("GScholarLENS");domtoimage.toJpeg(e).then(function(t){var e=document.createElement("a");e.download=`${tr.replace(/\s+/g,"_")}_plots.jpeg`,e.href=t,e.click()}).catch(function(t){console.error("Error: Could not capture the plots!",t)})},"dom2image_script")});let te=document.querySelector("#gsc_prf_in"),tr=te?te.textContent.trim():"Not found";function to(t){let e=/\b(dr|mr|mrs|ms|miss|prof|phd|ph\.?d|md|m\.?d|jr|sr)\b/gi,r=t.replace(e,"");return r=(r=(r=r.replace(/[.,\/#!$%\^&\*;:}=\_`~)]/g,"")).replace(/\s+/g," ").trim()).split(/[,\.\(\;\:\[\{\*)]/)[0].trim()}function ta(t){return t.replace("/[.*+?^${}()|[]\\]/g","\\$&")}let tn=document.querySelector("#gsc_prf_in").textContent.trim(),ti=document.querySelector("#gs_prf_ion_txt"),ts="";void 0!=ti&&(ts=ti.textContent.trim());let tl=[],tc=[];if(ts.length>0){let td=ts.split(/;|,|:/).map(t=>t.trim()).filter(Boolean),tg=0;for(;tg<td.length;)tg+1<td.length&&1===td[tg].split(" ").length?(td[tg]=`${td[tg]}, ${td[tg+1]}`,td.splice(tg+1,1)):tg++;tc=(tc=(tc=td.filter(t=>2===t.split(" ").length)).map(t=>{let e=t.replace(/[^\w\s-]|_/g,"").replace(/\s+/g," ").trim();return e=e.replace(/[–—]/g,"-"),to(replaceSpecialChars(normalizeString(e)))})).filter(t=>""!==t.trim());let tu=tc.map(t=>{let e=t.split(" ").map(t=>t.trim());return e.reverse().join(" ")});tc=(tc=[...tc,...tu]).map(t=>t.replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").trim()),tc=Array.from(new Set(tc))}let t$=to(replaceSpecialChars(normalizeString(tn))),th=function t(e){let r=e.split(" "),o=r[r.length-1];return o}(t$),tp=function t(e){let r=e.split(" ");if(1===r.length)return[e];{let o=r[0].charAt(0),a=r[r.length-1],n=`${o} ${a}`,i=`${r[0]} ${r[1].charAt(0)}`,s=`${a} ${r[0]}`,l=`${a} ${o}`,c=`${a.charAt(0)} ${r[0]}`;return[n,i,s,l,c]}}(t$);tl.push(t$),tl=[...tl=[...tl,...tp],...tc],tl=Array.from(new Set(tl));let tb=[],tf=[];function t_(t,e){return L.get(e).size<=0||!L.get(e).has("author_pos_cite_qscore")?[0,0,0,0]:[L.get(e).get("author_pos_cite_qscore").get("first_author").get(t),L.get(e).get("author_pos_cite_qscore").get("second_author").get(t),L.get(e).get("author_pos_cite_qscore").get("co_author").get(t),L.get(e).get("author_pos_cite_qscore").get("corresponding_author").get(t)]}function ty(t,e){return L.get(e).size<=0||!L.get(e).has("author_pos_cite_qscore")?[0,0,0,0,0]:[L.get(e).get("author_pos_cite_qscore").get(t).get("Q1"),L.get(e).get("author_pos_cite_qscore").get(t).get("Q2"),L.get(e).get("author_pos_cite_qscore").get(t).get("Q3"),L.get(e).get("author_pos_cite_qscore").get(t).get("Q4"),L.get(e).get("author_pos_cite_qscore").get(t).get("NA"),]}function t8(t,e){return L.get(e).size<=0||!L.get(e).has("author_pos_cite_qscore")?0:L.get(e).get("author_pos_cite_qscore").get(t).get("Q1")+L.get(e).get("author_pos_cite_qscore").get(t).get("Q2")+L.get(e).get("author_pos_cite_qscore").get(t).get("Q3")+L.get(e).get("author_pos_cite_qscore").get(t).get("Q4")+L.get(e).get("author_pos_cite_qscore").get(t).get("NA")}function tm(t,e){return L.get(e).size<=0||!L.get(e).has("qPosCount")?[0,0,0,0]:[L.get(e).get("qPosCount").get("first_author").get(t),L.get(e).get("qPosCount").get("second_author").get(t),L.get(e).get("qPosCount").get("co_author").get(t),L.get(e).get("qPosCount").get("corresponding_author").get(t)]}function tx(t,e){return L.get(e).size<=0||!L.get(e).has("qPosCount")?[0,0,0,0]:[L.get(e).get("qPosCount").get("first_author").get(t)/tC("first_author",e).reduce((t,e)=>t+e,0)*100,L.get(e).get("qPosCount").get("second_author").get(t)/tC("second_author",e).reduce((t,e)=>t+e,0)*100,L.get(e).get("qPosCount").get("co_author").get(t)/tC("co_author",e).reduce((t,e)=>t+e,0)*100,L.get(e).get("qPosCount").get("corresponding_author").get(t)/tC("corresponding_author",e).reduce((t,e)=>t+e,0)*100]}function tC(t,e){return L.get(e).size<=0||!L.get(e).has("qPosCount")?[0,0,0,0,0]:[L.get(e).get("qPosCount").get(t).get("Q1"),L.get(e).get("qPosCount").get(t).get("Q2"),L.get(e).get("qPosCount").get(t).get("Q3"),L.get(e).get("qPosCount").get(t).get("Q4"),L.get(e).get("qPosCount").get(t).get("NA")]}function tw(t,e){return L.get(e).size<=0||!L.get(e).has("qPosCount")?0:L.get(e).get("qPosCount").get(t).get("Q1")+L.get(e).get("qPosCount").get(t).get("Q2")+L.get(e).get("qPosCount").get(t).get("Q3")+L.get(e).get("qPosCount").get(t).get("Q4")+L.get(e).get("qPosCount").get(t).get("NA")}function tv(t,e){return L.get(e).size<=0||!L.get(e).has("qPosCount")?[0,0,0,0,0]:[L.get(e).get("qPosCount").get(t).get("Q1")/L.get(e).get("qTotal").get("Q1")*100,L.get(e).get("qPosCount").get(t).get("Q2")/L.get(e).get("qTotal").get("Q2")*100,L.get(e).get("qPosCount").get(t).get("Q3")/L.get(e).get("qTotal").get("Q3")*100,L.get(e).get("qPosCount").get(t).get("Q4")/L.get(e).get("qTotal").get("Q4")*100,L.get(e).get("qPosCount").get(t).get("NA")/L.get(e).get("qTotal").get("NA")*100]}function tk(t){return L.get(t).size<=0||!L.get(t).has("total_publications")?0:L.get(t).get("total_publications")}function t0(t){return L.get(t).size<=0||!L.get(t).has("author_pos_contrib")?[0,0,0,0]:[L.get(t).get("author_pos_contrib").get("first_author"),L.get(t).get("author_pos_contrib").get("second_author"),L.get(t).get("author_pos_contrib").get("co_author"),L.get(t).get("author_pos_contrib").get("corresponding_author")]}function tS(t){return L.get(t).size<=0||!L.get(t).has("author_pos_cite_contrib")?[0,0,0,0]:[L.get(t).get("author_pos_cite_contrib").get("first_author"),L.get(t).get("author_pos_cite_contrib").get("second_author"),L.get(t).get("author_pos_cite_contrib").get("co_author"),L.get(t).get("author_pos_cite_contrib").get("corresponding_author")]}function t3(t){return L.get(t).size<=0||!L.get(t).has("author_pos_cite_map")?[0,0,0,0]:[L.get(t).get("author_pos_cite_map").get("first_author"),L.get(t).get("author_pos_cite_map").get("second_author"),L.get(t).get("author_pos_cite_map").get("co_author"),L.get(t).get("author_pos_cite_map").get("corresponding_author")]}function tA(t,e,r){let o=[0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=t_(t,a.toString());for(let i=0;i<4;i++)o[i]+=n[i]}return o}function tq(t,e,r){let o=[0,0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=ty(t,a.toString());for(let i=0;i<5;i++)o[i]+=n[i]}return o}function t1(t,e,r){let o=0;for(let a=e;a<=r;a++)N.includes(a.toString())&&(o+=t8(t,a.toString()));return o}function tE(t,e,r){let o=[0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=tm(t,a.toString());for(let i=0;i<4;i++)o[i]+=n[i]}return o}function t2(t,e,r){let o=[0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=tx(t,a.toString());for(let i=0;i<4;i++)o[i]+=n[i]}let s=Math.abs(r-e);for(let l=0;l<4;l++)o[l]=o[l]/s*100;return o}function tP(t,e,r){let o=[0,0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=tC(t,a.toString());for(let i=0;i<5;i++)o[i]+=n[i]}return o}function t9(t,e,r){let o=0;for(let a=e;a<=r;a++)N.includes(a.toString())&&(o+=tw(t,a.toString()));return o}function tQ(t,e,r){let o=[0,0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=tv(t,a.toString());for(let i=0;i<5;i++)o[i]+=n[i]}let s=Math.abs(r-e);for(let l=0;l<5;l++)o[l]=o[l]/s*100;return o}function tz(t,e){let r=0;for(let o=t;o<=e;o++)N.includes(o.toString())&&(r+=tk(o.toString()));return r}function t6(){let t=a?n?e:c:s,r=a?c:l,o=[t1("first_author",t,r),t1("second_author",t,r),t1("co_author",t,r),t1("corresponding_author",t,r)],i=[tA("Q1",t,r),tA("Q2",t,r),tA("Q3",t,r),tA("Q4",t,r),tA("NA",t,r)],d={labels:["First Author Citations\nTotal:"+o[0],"Second Author Citations\nTotal:"+o[1],"Co-Author Citations\nTotal:"+o[2],"Corresponding Author Citations\nTotal:"+o[3]],datasets:[{label:"Q1 Citations",data:i[0],backgroundColor:z[0],borderColor:j[0],borderWidth:1},{label:"Q2 Citations",data:i[1],backgroundColor:z[1],borderColor:j[1],borderWidth:1},{label:"Q3 Citations",data:i[2],backgroundColor:z[2],borderColor:j[2],borderWidth:1},{label:"Q4 Citations",data:i[3],backgroundColor:z[3],borderColor:j[3],borderWidth:1},{label:"NA Citations",data:i[4],backgroundColor:z[4],borderColor:j[4],borderWidth:1}]},$=Chart.getChart("authorCitationsChart");if(void 0!=$)$.data=d,$.update();else{let h=document.getElementById("authorCitationsChart").getContext("2d");new Chart(h,{type:"bar",data:d,options:{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Count based on Authorship with Journal Rank Categorization"}},scales:{x:{stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let p=function t(e,r){let o=[[],[],[],[]];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=t3(a.toString());for(let i=0;i<4;i++)o[i].push(n[i]),o[i]=o[i].toString().split(",").filter(t=>""!==t).map(Number)}return o}(t,r),b={labels:["First Author Citations","Second Author Citations","Co-Author Citations","Corresponding Author Citations"],datasets:[{label:"Citation Distribution",data:[p[0],p[1],p[2],p[3]],backgroundColor:P,borderColor:Q,borderWidth:1}]};if(void 0!=($=Chart.getChart("authorCitationsDistChart")))$.data=b,$.update();else{let f=document.getElementById("authorCitationsDistChart").getContext("2d");new Chart(f,{type:"violin",data:b,options:{responsive:!0,whiskersMode:"exact",coef:0,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Distribution based on Authorship (Log Scale)"}},scales:{x:{grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{type:"logarithmic",beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let _=function t(e,r){let o=[0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=t0(a.toString());for(let i=0;i<4;i++)o[i]+=n[i]}return o}(t,r),y=_[0]+_[1]+_[2]+_[3],m=(_[0]/y*100).toFixed(2),x=(_[1]/y*100).toFixed(2),C=(_[3]/y*100).toFixed(2),w=(_[2]/y*100).toFixed(2),v={labels:[""],datasets:[{label:"First Author Contribution %",data:[m],backgroundColor:P[0],borderColor:Q[0],borderWidth:1},{label:"Second Author Contribution %",data:[x],backgroundColor:P[1],borderColor:Q[1],borderWidth:1},{label:"Co-Author Contribution %",data:[w],backgroundColor:P[2],borderColor:Q[2],borderWidth:1},{label:"Corresponding Author Contribution %",data:[C],backgroundColor:P[3],borderColor:Q[3],borderWidth:1}]};if(void 0!=($=Chart.getChart("authorStackedChart"))){let k=document.getElementById("authorStackedChartDiv");k.style.height="150px",$.data=v,$.update()}else{let S=document.getElementById("authorStackedChartDiv");S.style.height="150px";let A=document.getElementById("authorStackedChart").getContext("2d");new Chart(A,{type:"bar",data:v,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Author Contribution in % based on Authorship"}},scales:{x:{stacked:!0,beginAtZero:!0,max:100,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let q=function t(e,r){let o=[0,0,0,0];for(let a=e;a<=r;a++){if(!N.includes(a.toString()))continue;let n=tS(a.toString());for(let i=0;i<4;i++)o[i]+=n[i]}return o}(t,r),E=q[0]+q[1]+q[2]+q[3],R=(q[0]/E*100).toFixed(2),T=(q[1]/E*100).toFixed(2),B=(q[3]/E*100).toFixed(2),L=(q[2]/E*100).toFixed(2),D={labels:[""],datasets:[{label:"First Author Citations %",data:[R],backgroundColor:P[0],borderColor:Q[0],borderWidth:1},{label:"Second Author Citations %",data:[T],backgroundColor:P[1],borderColor:Q[1],borderWidth:1},{label:"Co-Author Citations %",data:[L],backgroundColor:P[2],borderColor:Q[2],borderWidth:1},{label:"Corresponding Author Citations %",data:[B],backgroundColor:P[3],borderColor:Q[3],borderWidth:1}]};if(void 0!=($=Chart.getChart("citationsStackedChart"))){let W=document.getElementById("citationsStackedChartDiv");W.style.height="150px",$.data=D,$.update()}else{let F=document.getElementById("citationsStackedChartDiv");F.style.height="150px";let J=document.getElementById("citationsStackedChart").getContext("2d");new Chart(J,{type:"bar",data:D,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Contribution in % based on Authorship"}},scales:{x:{stacked:!0,beginAtZero:!0,max:100,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let M=[t9("first_author",t,r),t9("second_author",t,r),t9("co_author",t,r),t9("corresponding_author",t,r)],U=[tE("Q1",t,r),tE("Q2",t,r),tE("Q3",t,r),tE("Q4",t,r),tE("NA",t,r)],V={labels:["First Author Q*\nTotal:"+M[0],"Second Author Q*\nTotal:"+M[1],"Co-Author Q*\nTotal:"+M[2],"Corresponding Author Q*\nTotal:"+M[3]],datasets:[{label:"Q1",data:U[0],backgroundColor:z[0],borderColor:j[0],borderWidth:1},{label:"Q2",data:U[1],backgroundColor:z[1],borderColor:j[1],borderWidth:1},{label:"Q3",data:U[2],backgroundColor:z[2],borderColor:j[2],borderWidth:1},{label:"Q4",data:U[3],backgroundColor:z[3],borderColor:j[3],borderWidth:1},{label:"NA",data:U[4],backgroundColor:z[4],borderColor:j[4],borderWidth:1}]};if(void 0!=($=Chart.getChart("qScorePosStackedChart")))$.data=V,$.update();else{let te=document.getElementById("qScorePosStackedChart").getContext("2d");new Chart(te,{type:"bar",data:V,options:{indexAxis:"x",plugins:{legend:{display:!1},title:{display:!0,text:"Publication Count based on Authorship with Journal Rank Categorization"}},scales:{x:{stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{beginAtZero:!0,stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let tr=document.querySelectorAll(".double_range_slider_box input"),to=document.getElementById("single_range");to.value=c.toString(),tr[0].value=s.toString(),tr[1].value=l.toString(),O(c),Y(s),H(l),X(),Z(),s=parseInt(tr[0].value),l=parseInt(tr[1].value),c=parseInt(to.value);let ta=document.getElementById("total_pubs"),tn=document.getElementById("ignored_pubs"),ti=document.getElementById("considered_pubs"),ts=document.getElementById("using_author_names");ta.textContent=DOMPurify.sanitize(`${g.toString()}`),ti.textContent=DOMPurify.sanitize(`${g-u}`),tn.textContent=DOMPurify.sanitize(`${u}`),ts.textContent=DOMPurify.sanitize(`${I.toString()}`),K.disabled=!1,tt.disabled=!1,G.style.display="block"}function tj(){let t=[],e=[],o=[],a=!1,n=r-10;for(;n<=r;){if(e.push(n),L.has(n.toString())){let i=L.get(n.toString()).get("total_publications");t.push(i),i>48&&(a=!0,o.push(n))}else t.push(0);n+=1}a&&(document.getElementById("pubmachine_banner").textContent=`>48 Papers/Year (${o.join(", ")})`);let s={labels:e,datasets:[{label:["Publication Count"],data:t,backgroundColor:z[0][0],borderColor:j[0][0],borderWidth:1}]};Chart.register({id:"dropOffLine",afterDraw(t,e,r){let{ctx:o,scales:a}=t,n=a.y,i=a.x,s=r.value,l=n.getPixelForValue(s);o.save(),o.beginPath(),o.strokeStyle=r.borderColor,o.lineWidth=r.borderWidth,o.moveTo(i.left,l),o.lineTo(i.right,l),o.stroke(),r.label&&r.label.enabled&&(o.fillStyle=r.label.color||r.borderColor,o.textAlign="start"===r.label.position?"left":"center",o.textBaseline="bottom",o.fillText(r.label.content,(i.left+i.right)/2,l-4)),o.restore()}});let l=Chart.getChart("tenyearPubCountChart");if(void 0!=l)l.data=s,l.update();else{let c=document.getElementById("tenyearPubCountChart").getContext("2d");new Chart(c,{type:"bar",data:s,options:{responsive:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Publication Counts of last 10 years"},dropOffLine:{value:48,borderColor:"rgba(6, 40, 233, 0.7)",borderWidth:2,z:-1,label:{enabled:!0,content:"Publication Machine",position:"start",color:"rgba(6, 40, 233, 0.7)",z:-2}}},scales:{x:{stacked:!1,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!1,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}}tl.forEach(t=>{tb.push(function t(e){let r=e.trim().split(/\s+/),o=ta(r[r.length-1]),a=ta(r[0].charAt(0));return r[0].length>1&&o.length>1?RegExp(`^${a}.*\\s${o}[\\*^]?$`,"i"):RegExp(`^${r[0]}.*\\s${o}[\\*^]?$`,"i")}(t)),tf.push(function t(e){let r=e.trim().split(/\s+/),o=ta(r[0]),a=ta(r[r.length-1]);return RegExp(`^${o}.*\\s${a}[\\*^]?$`,"i")}(t))});let tR=async()=>{document.getElementsByTagName("body")[0].style.overflow="visible";let a=document.querySelectorAll(".gsc_a_tr"),n=new Map;a.forEach(async(t,o)=>{let a=t.querySelector(".gsc_a_t a"),i=a?a.textContent.trim():"No title",d=a?a.href:null,g=t.querySelector(".gsc_a_c a");g=g?g.textContent.trim():"0";let u=parseInt(g);isNaN(u)&&(u=0);let $=t.querySelectorAll(".gsc_a_t .gs_gray"),h=t.querySelector(".gs_oph"),p=h&&h.previousSibling?h.previousSibling.textContent.trim():"Unknown Journal";if(null!=p.toLowerCase().match(/rxiv/))v++;else{let b=p.match(E),f=b?b[1].trim():p;q.has(f)||q.set(f,0),q.set(f,q.get(f)+1)}let _=t.querySelector(".gsc_a_y span"),y=_?_.textContent.trim():"No year",m=t.querySelector(".gs_ibl");m&&m.hasAttribute("href")&&m.getAttribute("href"),(parseInt(y)<e||0===e)&&(s=e=parseInt(y)),parseInt(y)>r&&(l=r=parseInt(y),c=r),"No year"==y||void 0==y||(L.has(y)||L.set(y,new Map),N.includes(y)||N.push(y));let x=$[0],C=x?x.textContent.trim():"No authors",w=function t(e,r,o=[5,7]){let a=e.toLowerCase().split(/,\s*(.+)/)[0].replace(/\d+/g,"").replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").trim();if(n.has(a))return n.get(a);for(let i of r)if(i.Name&&a.includes(i.Name.toLowerCase())&&i.Name.toLowerCase().includes(a)){let s=Array.from(Object.values(i));if(!(s.length>=Math.max(...o)))return n.set(a,["NA","NA"]),["NA","NA"];{let l=[i.JIF5Years,i.Qscore];return n.set(a,l),l}}return n.set(a,["NA","NA"]),["NA","NA"]}(p,excelData,[5,7]);B.push({title:i,citations:u,year:y,authors:C,total_authors:0,author_pos:"NA",journalRanking:w[1],journalTitle:p,impact_factor:w[0],index:o,publicationURL:d})});let i=[...q.entries()].sort((t,e)=>e[1]-t[1]).slice(0,3),P=`
            <table class="journalTableStyle">
                <thead>
                <tr>
                    <th>Journal Name</th>
                    <th>Count</th>
                </tr>
                </thead>
                <tbody>
                ${i.map(([t,e])=>`
                    <tr>
                    <td>${t}</td>
                    <td>${e}</td>
                    </tr>
                `).join("")}
                </tbody>
            </table>
            `;document.getElementById("journalTable").innerHTML=DOMPurify.sanitize(P);let Q=document.querySelectorAll(".double_range_slider_box input"),z=document.getElementById("single_range");async function j(t,e,r=5,o=0){let a=[];try{let n=0;e.length>=100&&(o=o>1e4?o:1e4);let i=async()=>{if(n>=e.length)return;let s=e.slice(n,n+r);n+=r,await new Promise(t=>setTimeout(t,o));let l=s.map(async(e,r)=>{try{let o,a=new DOMParser;try{o=await fetchWithSessionCache(t[r],e);let n=0;for(;!o||200!=o.status;){if(o=await fetchWithSessionCache(t[r],e,refetch=!0),++n>5)throw Error("Request limit exceeded. Refresh the page and rerun GScholarLENS.");await new Promise(t=>setTimeout(t,0))}let i=await o.text(),s=a.parseFromString(DOMPurify.sanitize(i),"text/html"),l=s.querySelector(".gsc_oci_value");return await new Promise(t=>setTimeout(t,0)),l?l.textContent.trim():"Authors not found"}catch(c){console.error("Error fetching authors:",c),chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status),window.alert("Large Profile : Rate limit reached. Please re-run GScholarLENS."),window.location.reload()})}return"Authors not found"}catch(d){return console.error("Error fetching authors (batch.map):",d),"Error loading authors"}});a.push(...await Promise.all(l)),J("main",n/e.length*100,"Fetching URLs("+n+"): "),await new Promise(t=>setTimeout(t,0)),await i()};await i(),await new Promise(t=>setTimeout(t,0))}catch(s){console.log("Error Fetching Authors:",s),releaseSemaphoreAndReload()}return a}function M(t,e){let r=e;for(;r>0&&(t[r].includes("^")||t[r].includes("*"));)r--;return r}z.min=e,z.max=r,z.value=c.toString(),Q[0].min=e,Q[0].max=r,Q[0].value=s.toString(),Q[1].min=e,Q[1].max=r,Q[1].value=l.toString(),Y(s),H(l),O(c);let U=[],G=0;async function Z(){let t=!1,e=new Set;new TextEncoder;let r=[];W.set("publication_progress",F("publication_progress",W.size+1,"Processing Publications...","rgb(103, 0, 172)")),J("publication_progress",-1,"Processing Publications...");for(let a=0;a<o/2;a++){let n=await createInlineWorker(chrome.runtime.getURL("workers/publicationWorker.min.js"));n.idle=!0,r.push(n)}for(let[i,s]of B.entries()){for(;i>G;)await new Promise(t=>setTimeout(t,100));if(U.includes(i))continue;for(;!r.find(t=>t.idle);)await new Promise(t=>setTimeout(t,100));let l=r.find(t=>t.idle);l.idle=!1,l.onmessage=async({data:r})=>{let o=new TextDecoder("utf-8"),a=o.decode(new Uint8Array(r)),n=JSON.parse(a);if("initialScrape"===n.task&&"working"===n.type){if(B[n.publication.index]=n.publication,!n.authorFound&&n.extended_scrape){t=!0;return}d+=1,J("publication_progress",d/g*100,"Processing Publications ("+d+"): "),await new Promise(t=>setTimeout(t,150)),e.add(n.publication.index),0===n.publication.year.toString().trim().length&&($+=1),L.get(n.publication.year).has("total_publications")||L.get(n.publication.year).set("total_publications",0),L.get(n.publication.year).set("total_publications",L.get(n.publication.year).get("total_publications")+1);let i=0,s=0,c="0	0	0	0";switch(n.publication.author_pos){case"first_author":c="1	0	0	0",i=n.publication.citations*k[0],s=k[0];break;case"second_author":c="0	1	0	0",i=n.publication.citations*k[1],s=k[1];break;case"co_author":c="0	0	1	0",n.publication.total_authors>6?(i=.1*n.publication.citations,s=.1):(i=.25*n.publication.citations,s=.25);break;case"corresponding_author":c="0	0	0	1",i=n.publication.citations*k[3],s=k[3];break;default:console.warn(n.publication.pub_idx,n.publication.author_pos)}tsvContent+=`${n.publication.index}	${n.publication.title}	${n.publication.authors}	${n.publication.authors.includes("...")?`${n.publication.total_authors-1}+`:n.publication.total_authors}	${n.publication.year}	${n.publication.citations}	${i}	${s}	${n.publication.journalTitle}	${n.publication.journalRanking}	${n.publication.impact_factor}	${n.publication.considered}	${c}
`}if("done"===n.type){I=[...I,...n.authorNamesConsidered],I=Array(...new Set(I));let u=rebuildYearwiseData(n.yearwiseData);n.yearwiseData.length>0&&u.size>0&&await mergeYearwiseData(L,u),l.idle=!0,l.onmessage=null}"error"===n.type&&console.error(`Worker error on ${n.task}:`,n.error)},l.postMessage({task:"initialScrape",batch:[s],authorRegexes:tb,authorRegexesEx:tf,nameComboList:tp,otherNamesList:tc,authorNameShort:th,authorName:tr,authorNameLong:t$})}if(t){for(;r.some(t=>!t.idle);)await new Promise(t=>setTimeout(t,100));let c=B.filter(t=>"Pending"===t.authors).map(t=>t.publicationURL),h=B.filter(t=>"Pending"===t.authors).map(t=>t.title),p=await j(h,c,c.length,0);(c=[]).length=0,(h=[]).length=0;let b=0;for(let[f,_]of B.entries()){for(;f>G;)await new Promise(t=>setTimeout(t,100));if(U.includes(f)||"Pending"!==_.authors)continue;if(_.authors=p[b]||"Authors not found",b++,e.has(f))continue;for(;!r.find(t=>t.idle);)await new Promise(t=>setTimeout(t,100));let y=r.find(t=>t.idle);y.idle=!1,y.onmessage=async({data:t})=>{let e=new TextDecoder("utf-8"),r=e.decode(new Uint8Array(t)),o=JSON.parse(r);if("extendedScrape"===o.task&&"working"===o.type){B[o.publication.index]=o.publication,o.authorFound||(u+=1),d+=1,J("publication_progress",d/g*100,"Processing Publications ("+d+"): "),await new Promise(t=>setTimeout(t,150)),0===o.publication.year.toString().trim().length&&($+=1),L.get(o.publication.year).has("total_publications")||L.get(o.publication.year).set("total_publications",0),L.get(o.publication.year).set("total_publications",L.get(o.publication.year).get("total_publications")+1);let a=0,n=0,i="0	0	0	0";switch(o.publication.author_pos){case"first_author":i="1	0	0	0",a=o.publication.citations*k[0],n=k[0];break;case"second_author":i="0	1	0	0",a=o.publication.citations*k[1],n=k[1];break;case"co_author":i="0	0	1	0",o.publication.total_authors>6?(a=.1*o.publication.citations,n=.1):(a=.25*o.publication.citations,n=.25);break;case"corresponding_author":i="0	0	0	1",a=o.publication.citations*k[3],n=k[3]}tsvContent+=`${o.publication.index}	${o.publication.title}	${o.publication.authors}	${o.publication.authors.includes("...")?`${o.publication.total_authors-1}+`:o.publication.total_authors}	${o.publication.year}	${o.publication.citations}	${a}	${n}	${o.publication.journalTitle}	${o.publication.journalRanking}	${o.publication.impact_factor}	${o.publication.considered}	${i}
`}if("done"===o.type){I=[...I,...o.authorNamesConsidered],I=Array(...new Set(I));let s=rebuildYearwiseData(o.yearwiseData);o.yearwiseData.length>0&&s.size>0&&await mergeYearwiseData(L,s),y.idle=!0,y.onmessage=null}"error"===o.type&&console.error(`Worker error on ${o.task}:`,o.error)},y.postMessage({task:"extendedScrape",batch:[_],authorRegexes:tb,authorRegexesEx:tf,nameComboList:tp,otherNamesList:tc,authorNameShort:th,authorName:tr,authorNameLong:t$})}}for(;r.some(t=>!t.idle);)await new Promise(t=>setTimeout(t,100));return r.forEach(t=>t.terminate()),J("publication_progress",100,"Processing Publications :",!0),I=[...I,...tl],I=Array(...new Set(I)),W.set("journal_progress",F("journal_progress",W.size+1,"Processing Journal Rankings...","rgb(0, 97, 207)")),J("journal_progress",-1,"Processing Journal Rankings..."),d=0,B.forEach(async(t,e)=>{B[e].journalRanking||console.log(e,t.title,t.authors),function t(e,r,o){if("NA"!==e){if(L.get(r).has("qPosCount")||(L.get(r).set("qPosCount",new Map),L.get(r).get("qPosCount").set("first_author",new Map),L.get(r).get("qPosCount").get("first_author").set("Q1",0),L.get(r).get("qPosCount").get("first_author").set("Q2",0),L.get(r).get("qPosCount").get("first_author").set("Q3",0),L.get(r).get("qPosCount").get("first_author").set("Q4",0),L.get(r).get("qPosCount").get("first_author").set("NA",0),L.get(r).get("qPosCount").set("second_author",new Map),L.get(r).get("qPosCount").get("second_author").set("Q1",0),L.get(r).get("qPosCount").get("second_author").set("Q2",0),L.get(r).get("qPosCount").get("second_author").set("Q3",0),L.get(r).get("qPosCount").get("second_author").set("Q4",0),L.get(r).get("qPosCount").get("second_author").set("NA",0),L.get(r).get("qPosCount").set("co_author",new Map),L.get(r).get("qPosCount").get("co_author").set("Q1",0),L.get(r).get("qPosCount").get("co_author").set("Q2",0),L.get(r).get("qPosCount").get("co_author").set("Q3",0),L.get(r).get("qPosCount").get("co_author").set("Q4",0),L.get(r).get("qPosCount").get("co_author").set("NA",0),L.get(r).get("qPosCount").set("corresponding_author",new Map),L.get(r).get("qPosCount").get("corresponding_author").set("Q1",0),L.get(r).get("qPosCount").get("corresponding_author").set("Q2",0),L.get(r).get("qPosCount").get("corresponding_author").set("Q3",0),L.get(r).get("qPosCount").get("corresponding_author").set("Q4",0),L.get(r).get("qPosCount").get("corresponding_author").set("NA",0)),L.get(r).has("qTotal")||(L.get(r).set("qTotal",new Map),L.get(r).get("qTotal").set("Q1",0),L.get(r).get("qTotal").set("Q2",0),L.get(r).get("qTotal").set("Q3",0),L.get(r).get("qTotal").set("Q4",0),L.get(r).get("qTotal").set("NA",0)),"Q"===o.charAt(0))switch(o.charAt(1)){case"1":let a=L.get(r).get("qPosCount").get(e).get("Q1")+1;L.get(r).get("qPosCount").get(e).set("Q1",a);let n=L.get(r).get("qTotal").get("Q1")+1;L.get(r).get("qTotal").set("Q1",n);break;case"2":let i=L.get(r).get("qPosCount").get(e).get("Q2")+1;L.get(r).get("qPosCount").get(e).set("Q2",i);let s=L.get(r).get("qTotal").get("Q2")+1;L.get(r).get("qTotal").set("Q2",s);break;case"3":let l=L.get(r).get("qPosCount").get(e).get("Q3")+1;L.get(r).get("qPosCount").get(e).set("Q3",l);let c=L.get(r).get("qTotal").get("Q3")+1;L.get(r).get("qTotal").set("Q3",c);break;case"4":let d=L.get(r).get("qPosCount").get(e).get("Q4")+1;L.get(r).get("qPosCount").get(e).set("Q4",d);let g=L.get(r).get("qTotal").get("Q4")+1;L.get(r).get("qTotal").set("Q4",g)}else{let u=L.get(r).get("qPosCount").get(e).get("NA")+1;L.get(r).get("qPosCount").get(e).set("NA",u);let $=L.get(r).get("qTotal").get("NA")+1;L.get(r).get("qTotal").set("NA",$)}}}(B[e].author_pos,B[e].year,B[e].journalRanking),d+=1,J("journal_progress",d/g*100,"Processing Journal Rankings ("+d+"): "),await new Promise(t=>setTimeout(t,0))}),J("journal_progress",100,"Processing Journal Rankings :",!0),!0}async function X(){W.set("retract_progress",F("retract_progress",W.size+1,"Processing Retractions...","rgb(255, 251, 0)")),J("retract_progress",-1,"Processing Retractions..."),await new Promise(t=>setTimeout(t,150)),retractionWatchDB=await getRetractionWatchDB();let t=[];for(let e=0;e<o/2;e++){let r=await createInlineWorker(chrome.runtime.getURL("workers/retractionWorker.min.js"));r.idle=!0,t.push(r)}for(let[a,n]of B.entries()){for(;!t.find(t=>t.idle);)await new Promise(t=>setTimeout(t,100));let i=t.find(t=>t.idle);i.idle=!1,i.onmessage=async({data:t})=>{"checkRetraction"===t.task&&"working"===t.type&&(G+=1,J("retract_progress",G/g*100,"Processing Retractions ("+G+"): "),await new Promise(t=>setTimeout(t,150)),t.isPubRetracted&&(U.push(t.publication.index),w++)),"done"===t.type&&(i.idle=!0,i.onmessage=null),"error"===t.type&&console.error(`Worker error on ${t.task}:`,t.error)},i.postMessage({task:"checkRetraction",batch:[n],retractionWatchDB})}for(;t.some(t=>!t.idle);)await new Promise(t=>setTimeout(t,100));return t.forEach(t=>t.terminate()),J("retract_progress",100,"Processing Retractions : "),!0}J("main",-1,"Please Wait...",!0);let[V,K]=await Promise.all([Z(),X()]);function tt(t,e){for(let[r,o]of e.entries())if(o instanceof Map)t.has(r)||t.set(r,new Map),tt(t.get(r),o);else if(Array.isArray(o)){let a=t.get(r)||[];t.set(r,[...a,...o])}else"number"==typeof o?t.set(r,(t.get(r)||0)+o):t.set(r,o)}B.sort((t,e)=>t.index-e.index),a.forEach(async(t,e)=>{let r=B[e].author_pos,o=t.querySelector(".gs_gray");if(o){var a,n;let i=DOMPurify.sanitize(`
                        <div class="position-circles" style="display: flex; gap: 5px; margin-top: 2px; margin-left: 2px; align-items: center; position: relative;">
                            <div class="circles-container" style="display: flex; gap: 5px; margin-right: 0.30%; margin-left: 0.15%;">
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"first_author"===r?"#3b8888":"#ddd"};"
            ${"first_author"===r?'data-role="First Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"second_author"===r?"#5d33b8":"#ddd"};"
            ${"second_author"===r?'data-role="Second Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"co_author"===r?"#e68a41":"#ddd"};"
            ${"co_author"===r?'data-role="Co-Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"corresponding_author"===r?"#3a83b2":"#ddd"};"
            ${"corresponding_author"===r?'data-role="Corresponding Author"':""}
        ></span>
                            </div>
                            <div class="q-badge" style="
                                /*opacity: 0;*/
                                transition: all 0.2s ease-in-out;
                                background: ${{Q1:"#2e7d32",Q2:"#689f38",Q3:"#f9a825",Q4:"#ef6c00"}[a=B[e].journalRanking]||"#607d8b"};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.8em;
                                margin-right: 0.25%;
                                margin-left: 0.25%;
                                /*position: absolute;
                                left: 100%;*/
                                white-space: nowrap;
                                pointer-events: none;
                            ">
                                ${B[e].journalRanking}
                            </div>
                            <div class="if-badge" style="
                                /*opacity: 0;*/
                                transition: all 0.2s ease-in-out;
                                background: ${{Q1:"#2e7d32",Q2:"#689f38",Q3:"#f9a825",Q4:"#ef6c00"}[n=B[e].impact_factor]||"#607d8b"};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.8em;
                                margin-right: 0.25%;
                                margin-left: 0.25%;
                                /*position: absolute;
                                left: 100%;*/
                                white-space: nowrap;
                                pointer-events: none;
                            ">
                                IF5: ${B[e].impact_factor}
                            </div>
                        </div>
                    `),s=t.querySelector(".position-circles");s?s.outerHTML=i:o.insertAdjacentHTML("afterend",i)}await new Promise(t=>setTimeout(t,0))}),await new Promise(t=>setTimeout(t,0)),a.forEach(async(t,e)=>{if(!U.includes(e))return;let r=t.querySelector(".gs_gray"),o=DOMPurify.sanitize(`
                <div class="blink_text"><div class="retraction-notice" style="margin-top: 5px; color: #ff0000; font-weight: bold;">
                RETRACTED</div></div>
            `);r.insertAdjacentHTML("afterend",o),await new Promise(t=>setTimeout(t,0))});L.get("")&&L.delete("");let te;async function to(){te=Papa.parse(tsvContent,{delimiter:"	",header:!0}),ta()}async function ta(){let t=[],e=[],r=["First_Author","Second_Author","Co_Author","Corresponding_Author"];y=te.data.length-1;let o=new Map;r.forEach(t=>{var e,r;o.set(t,(e=te.data,r=t,e.filter(t=>1===parseInt(t[r]))))}),o.forEach((o,a)=>{o.sort((t,e)=>parseInt(e.Adjusted_Citations)-parseInt(t.Adjusted_Citations)),o.forEach((o,a)=>{if(U.includes(parseInt(o.Index)))return;let n=r.map((t,e)=>1===parseInt(o[t])?e:-1).filter(t=>-1!==t);if(n&&n>=0){A[n]++;let i=parseInt(o.Adjusted_Citations);t.push(i),e.push(parseInt(o.Citations)),i>=A[n]&&S[n]++}})}),h=S[0],p=S[1],b=S[2],f=S[3],t.sort((t,e)=>e-t),e.sort((t,e)=>e-t),t.forEach((t,e)=>{t>=e+1&&(_=e+1)}),e.forEach((t,e)=>{t<=0&&C++}),x=t[Math.floor(t.length/2)],m=e[Math.floor(e.length/2)],document.getElementById("sh_index").textContent=DOMPurify.sanitize(`Sh-Index : ${_.toFixed(0)}`),document.getElementById("h_first").textContent=DOMPurify.sanitize(`${h.toString()}`),document.getElementById("h_second").textContent=DOMPurify.sanitize(`${p.toString()}`),document.getElementById("h_other").textContent=DOMPurify.sanitize(`${b.toString()}`),document.getElementById("h_co").textContent=DOMPurify.sanitize(`${f.toString()}`),document.getElementById("medianCitationsAdj").textContent=DOMPurify.sanitize(`${x.toString()}`),document.getElementById("medianCitationsRaw").textContent=DOMPurify.sanitize(`${m.toString()}`),document.getElementById("zeroCitationPubs").textContent=DOMPurify.sanitize(`${C.toString()}`),document.getElementById("retractedPubsCount").textContent=DOMPurify.sanitize(`${w.toString()}`),document.getElementById("preprintCount").textContent=DOMPurify.sanitize(`${v.toString()}`)}loadScript(T,to,"papaparse_script"),loadScript(R,tj,"chartjs_script_decade"),loadScript(R,t6,"chartjs_script_author"),D.style.display="none",w>0&&function t(e,r=500){let o=document.querySelectorAll(`.${e}`);o.forEach(async t=>{let e=!0;setInterval(()=>{t.style.visibility=e?"hidden":"visible",e=!e},r)})}("blink_text",1250),profileScraped=!0,releaseSemaphore();let tn=performance.now(),ti=tn-t,ts=Math.floor(ti/36e5),td=Math.floor(ti%36e5/6e4),tg=(ti%6e4/1e3).toFixed(2),tu=[];ts>0&&tu.push(`${ts}h`),td>0&&tu.push(`${td}m`),tu.push(`${tg}s`),console.info(`Time taken by GScholarLENS: ${tu.join(" ")}`)},tT=async()=>{let t=document.querySelector("#gsc_bpf_more");if(!t)return await new Promise(t=>setTimeout(t,1500)),tT();if(!t.hasAttribute("disabled"))return t.click(),await new Promise(t=>setTimeout(t,1500)),tT();{g=document.querySelectorAll(".gsc_a_at").length;let e=parseInt(document.querySelector("#gsc_a_nn").textContent.split(/[-–]/)[1].trim());if(g>e)return await new Promise(t=>setTimeout(t,2e3)),tT();tR()}};J("main",-1,"Waiting for other GScholarLENS processes to complete...",!0),chrome.runtime.sendMessage({type:"get_semaphore"},t=>{try{console.log(t.status),J("main",-1,"Expanding Publications List...",!0);let e=window.location.href.toString();fetch(e).then(t=>{200!=t.status&&releaseSemaphoreAndReload()}),async function(){excelData=await getJCRExcel(),retractionWatchDB=await getRetractionWatchDB()}(),tT()}catch(r){console.error("Error scraping profile:",r),document.getElementsByTagName("body")[0].style.overflow="visible",releaseSemaphore()}})}catch(tB){console.error("Error scraping:",tB),document.getElementsByTagName("body")[0].style.overflow="visible",releaseSemaphore()}return!0}