(()=>{const t=chrome.runtime.getURL("fonts/SchibstedGrotesk.ttf"),e=new FontFace("schibsted-grotesk",`url(${t})`);let o=!1,r=!1;e.load().then((t=>{document.fonts.add(t),document.body.style.fontFamily="schibsted-grotesk, sans-serif"})).catch((t=>{console.error("Font failed to load:",t)})),window.addEventListener("error",(t=>{console.error("Uncaught error:",t),chrome.runtime.sendMessage({type:"release_semaphore"},(t=>{console.log(t.status)}))}),!0),window.addEventListener("unhandledrejection",(t=>{console.error("Unhandled rejection:",t),chrome.runtime.sendMessage({type:"release_semaphore"},(t=>{console.log(t.status)}))}),!0),window.addEventListener("onbeforeunload",(()=>{chrome.runtime.sendMessage({type:"release_semaphore"},(t=>{console.log(t.status)}))}),!0),async function(t,e){var o=document.head,r=document.createElement("script");r.type="text/javascript",r.src=t,r.id="gscholarlens_script",r.onreadystatechange=e,r.onload=e,o.appendChild(r)}(chrome.runtime.getURL("content/GScholarLENS.js"),(()=>{try{!function(){if(document.getElementById("inject-content-button"))return void(document.getElementById("inject-content-button").style.display="none");const t=document.createElement("button");t.id="inject-content-button",t.textContent="Initializing GScholarLENS...",t.disabled=!0,t.style.width="fit-content",t.style.display="flex",t.style.alignItems="center",t.style.gap="5px",t.style.fontSize="16px",t.style.marginTop="20px",t.style.marginBottom="10px",t.style.zIndex="1000",t.style.borderRadius="7px",t.style.cursor="not-allowed",t.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",t.style.fontFamily="schibsted-grotesk, sans-serif";const e=document.createElement("img");e.src=chrome.runtime.getURL("icons/icon128.png"),e.alt="GScholarLENS",e.style.height="20px",e.style.width="20px",e.style.objectFit="contain",t.prepend(e),document.querySelector("#gsc_prf").append(t),t.addEventListener("click",(()=>{try{startScraping(chrome),t.style.display="none"}catch(e){console.error("Error at startScraping() event: "+e),t.style.display="none",chrome.runtime.sendMessage({type:"release_semaphore"},(t=>{console.log(t.status)}))}}),{passive:!0})}(),chrome.runtime.sendMessage({type:"wait_for_initialization"},(t=>{console.log(t.status),async function(){const t=window.location.href.toString();200!=(await async function(t,e,o=!1){if(!t||0===t.length)return null;const r=((t,e=0)=>{let o=3735928559^e,r=1103547991^e;for(let e,s=0;s<t.length;s++)e=t.charCodeAt(s),o=Math.imul(o^e,2654435761),r=Math.imul(r^e,1597334677);return o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(o^o>>>13,3266489909),4294967296*(2097151&r)+(o>>>0)})(t),s=await sessionStorage.getItem(r);if(s&&!o)return s;try{const t=await fetch(e);return t&&200==t.status&&await sessionStorage.setItem(r,t),t}catch(t){return console.error("Error fetching data:",t),null}return!0}(t,t,refetch=!0)).status&&chrome.runtime.sendMessage({type:"release_semaphore"},(t=>{console.log(t.status),window.location.reload()})),o=await async function(){try{return new Promise((t=>{chrome.storage.local.get("jcrJSON",(e=>{t(e.jcrJSON||!1)}))}))}catch(t){console.error("Error: Could not fetch JCR excel data. "+t),chrome.runtime.sendMessage({type:"release_semaphore"},(t=>{console.log(t.status)}))}}(),r=await async function(){try{return new Promise((t=>{chrome.storage.local.get("retractionwatchdb",(e=>{t(e.retractionwatchdb||!1)}))}))}catch(t){console.error("Error: Could not RetractionWatchDB blob data. "+t),chrome.runtime.sendMessage({type:"release_semaphore"},(t=>{console.log(t.status)}))}}(),function(){const t=document.getElementById("inject-content-button");t.textContent="Run GScholarLENS",t.disabled=!1,t.textContent.color="white",t.style.width="fit-content",t.style.display="flex",t.style.alignItems="center",t.style.gap="5px",t.style.fontSize="16px",t.style.color="white",t.style.marginTop="20px",t.style.marginBottom="10px",t.style.zIndex="1000",t.style.borderRadius="7px",t.style.cursor="pointer",t.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",t.style.fontFamily="schibsted-grotesk, sans-serif",t.style.backgroundColor="rgba(0,0,0,0.8)";const e=document.createElement("img");e.src=chrome.runtime.getURL("icons/icon128.png"),e.alt="GScholarLENS",e.style.height="20px",e.style.width="20px",e.style.objectFit="contain",t.prepend(e)}()}()})),console.log("GScholarLENS script loaded")}catch(t){console.error("Error loading GScholarLENS script:",t)}}))})(),(()=>{const t=t=>{const e={à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",æ:"ae",ā:"a",ç:"c",ć:"c",ĉ:"c",č:"c",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ē:"e",ė:"e",ę:"e",ì:"i",í:"i",î:"i",ï:"i",ī:"i",į:"i",ı:"i",ñ:"n",ń:"n",ň:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ō:"o",ó:"o",œ:"oe",ù:"u",ú:"u",û:"u",ü:"u",ū:"u",ý:"y",ÿ:"y",ž:"z",ź:"z",ż:"z",À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Æ:"AE",Ā:"A",Ç:"C",Ć:"C",Ĉ:"C",Č:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ē:"E",Ė:"E",Ę:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ī:"I",Į:"I",İ:"I",Ñ:"N",Ń:"N",Ň:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ō:"O",Œ:"OE",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ū:"U",Ý:"Y",Ÿ:"Y",Ž:"Z",Ź:"Z",Ż:"Z",œ:"oe",ř:"r",š:"s",ţ:"t",ū:"u",ý:"y"};return t.split("").map((t=>e[t]||t)).join("").replace(/[\u2010-\u2015\u2212\uFE58\u2043]/g,"-")},e=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),o=e=>t(e).normalize("NFC").replace(/\s+/g," ").trim().toLowerCase(),r=(t,e)=>0===o(t).localeCompare(o(e),void 0,{sensitivity:"base"});function s(t,e,o,r,s,a,n,c){const i=function(t,e){let o=e;for(;o>0&&(t[o].includes("^")||t[o].includes("*"));)o--;return o}(o,s);let u="NA";return t.get(n).has("author_pos_contrib")||(t.get(n).set("author_pos_contrib",new Map),t.get(n).get("author_pos_contrib").set("first_author",0),t.get(n).get("author_pos_contrib").set("second_author",0),t.get(n).get("author_pos_contrib").set("co_author",0),t.get(n).get("author_pos_contrib").set("corresponding_author",0)),t.get(n).has("author_pos_cite_contrib")||(t.get(n).set("author_pos_cite_contrib",new Map),t.get(n).get("author_pos_cite_contrib").set("first_author",0),t.get(n).get("author_pos_cite_contrib").set("second_author",0),t.get(n).get("author_pos_cite_contrib").set("co_author",0),t.get(n).get("author_pos_cite_contrib").set("corresponding_author",0)),t.get(n).has("author_pos_cite_map")||(t.get(n).set("author_pos_cite_map",new Map),t.get(n).get("author_pos_cite_map").set("first_author",[]),t.get(n).get("author_pos_cite_map").set("second_author",[]),t.get(n).get("author_pos_cite_map").set("co_author",[]),t.get(n).get("author_pos_cite_map").set("corresponding_author",[])),t.get(n).has("author_pos_cite_qscore")||(t.get(n).set("author_pos_cite_qscore",new Map),t.get(n).get("author_pos_cite_qscore").set("first_author",new Map),t.get(n).get("author_pos_cite_qscore").set("second_author",new Map),t.get(n).get("author_pos_cite_qscore").set("co_author",new Map),t.get(n).get("author_pos_cite_qscore").set("corresponding_author",new Map),t.get(n).get("author_pos_cite_qscore").get("first_author").set("Q1",0),t.get(n).get("author_pos_cite_qscore").get("first_author").set("Q2",0),t.get(n).get("author_pos_cite_qscore").get("first_author").set("Q3",0),t.get(n).get("author_pos_cite_qscore").get("first_author").set("Q4",0),t.get(n).get("author_pos_cite_qscore").get("first_author").set("NA",0),t.get(n).get("author_pos_cite_qscore").get("second_author").set("Q1",0),t.get(n).get("author_pos_cite_qscore").get("second_author").set("Q2",0),t.get(n).get("author_pos_cite_qscore").get("second_author").set("Q3",0),t.get(n).get("author_pos_cite_qscore").get("second_author").set("Q4",0),t.get(n).get("author_pos_cite_qscore").get("second_author").set("NA",0),t.get(n).get("author_pos_cite_qscore").get("co_author").set("Q1",0),t.get(n).get("author_pos_cite_qscore").get("co_author").set("Q2",0),t.get(n).get("author_pos_cite_qscore").get("co_author").set("Q3",0),t.get(n).get("author_pos_cite_qscore").get("co_author").set("Q4",0),t.get(n).get("author_pos_cite_qscore").get("co_author").set("NA",0),t.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q1",0),t.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q2",0),t.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q3",0),t.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q4",0),t.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("NA",0)),e.includes("*")||i+1===o.length?(u="corresponding_author",t.get(n).get("author_pos_contrib").set("corresponding_author",t.get(n).get("author_pos_contrib").get("corresponding_author")+1),t.get(n).get("author_pos_cite_contrib").set("corresponding_author",t.get(n).get("author_pos_cite_contrib").get("corresponding_author")+r),t.get(n).get("author_pos_cite_map").get("corresponding_author").push(r)):0===i?(u="first_author",t.get(n).get("author_pos_contrib").set("first_author",t.get(n).get("author_pos_contrib").get("first_author")+1),t.get(n).get("author_pos_cite_contrib").set("first_author",t.get(n).get("author_pos_cite_contrib").get("first_author")+r),t.get(n).get("author_pos_cite_map").get("first_author").push(r)):1===i?(u="second_author",t.get(n).get("author_pos_contrib").set("second_author",t.get(n).get("author_pos_contrib").get("second_author")+1),t.get(n).get("author_pos_cite_contrib").set("second_author",t.get(n).get("author_pos_cite_contrib").get("second_author")+r),t.get(n).get("author_pos_cite_map").get("second_author").push(r)):i>1&&i+1<o.length?(u="co_author",t.get(n).get("author_pos_contrib").set("co_author",t.get(n).get("author_pos_contrib").get("co_author")+1),t.get(n).get("author_pos_cite_contrib").set("co_author",t.get(n).get("author_pos_cite_contrib").get("co_author")+r),t.get(n).get("author_pos_cite_map").get("co_author").push(r)):(console.log("IDX:",c.index,"Adj idx:",adj_idx,"Author:",e,"Position:",u,"Citations:",r,"QScore:",a),console.warn(c.index,c.author_pos)),t.get(n).get("author_pos_cite_qscore").get(u).set(a,t.get(n).get("author_pos_cite_qscore").get(u).get(a)+r),u}self.onmessage=async({data:o})=>{const{task:a,batch:n,authorRegexes:c,authorRegexesEx:i,nameComboList:u,otherNamesList:g,authorNameShort:h,authorName:_,authorNameLong:p}=o,l=[];let d=!1;const m=new Map;function f(o){const s=t(e(o)).toLowerCase(),a=[];return c.forEach((t=>{a.push(t.test(s))})),a.push(s.includes(h.toLowerCase())),a.push(r(o,_)),a.push(g.includes(e(o.trim()))),a.push(u.includes(o.trim())),a.some((t=>!0===t))}try{for(const w of n){const x=w.index,E=w.authors,C=w.citations;let S=E.split(",").map((t=>t.trim()));if("initialScrape"===a){let L=!1,M=S.filter(f);if(((b=M,Array.from(new Set(b))).length>1||0===M.length)&&E.includes("...")){w.authors="Pending",w.considered=!1,L=!0;continue}S.forEach((async(o,a)=>{if(o.includes("..."))return w.authors="Pending",void(L=!0);const n=t(e(o)).toLowerCase();if(n.includes(h.toLowerCase())||n.includes(p.toLowerCase())||r(o,_)||g.includes(e(o.trim()))){const t=[];if(c.forEach((e=>{t.push(e.test(n))})),t.push(g.includes(e(o.trim()))),t.some((t=>!0===t))){d=!0;const t=o.replace(/[\*\^']|_/g,"").replace(/\s+/g," ").trim();l.push(t),w.author_pos=s(m,o,S,C,a,w.journalRanking,w.year,x),w.total_authors=S.length,w.considered=!0}}})),d||(w.authors="Pending",L=!0),self.postMessage({type:"working",task:"initialScrape",authorRegexes:c,authorFound:d,extended_scrape:L,publication:w})}else if("extendedScrape"===a){function y(o){const s=t(e(o)).toLowerCase(),a=[];return i.forEach((t=>{a.push(t.test(s))})),a.push(r(o,_)),a.push(g.includes(e(o.trim()))),a.push(u.includes(o.trim())),a.some((t=>!0===t))}let q=!0,k=E.split(",").map((t=>t.trim())),N=k.filter(y);0===N.length&&(N=k.filter(f),q=!1);const j=q?i:c;if(0===N.length||"Authors not found"===w.authors)d=!1,w.considered=!1;else for(const[I,R]of k.entries()){const A=t(e(R)).toLowerCase();if(A.includes(h.toLowerCase())||A.includes(p.toLowerCase())||r(R,_)||g.includes(e(R.trim()))){const Q=[];if(j.forEach((t=>{Q.push(t.test(A))})),Q.push(g.includes(e(R.trim()))),Q.some((t=>!0===t))){d=!0,processedPubsIdx.add(x);const v=R.replace(/[^\w\s\']|_/g,"").replace(/\s+/g," ").trim();l.push(v),w.author_pos=s(m,R,k,C,I,w.journalRanking,w.year,x),w.total_authors=k.length,w.author_pos_string=author_pos_string,w.adjustedCitationCount=adjustedCitationCount,w.citationWeight=citationWeight,w.considered=!0}}}self.postMessage({type:"working",task:"extendedScrape",authorRegexes:c,authorRegexesEx:i,authorFound:d,extended_check:q,publication:w})}}self.postMessage({type:"done",task:a,yearwiseData:m,authorNamesConsidered:l})}catch(F){self.postMessage({type:"error",task:a,error:F.message})}var b}})(),self.onmessage=async({data:t})=>{const{task:e,batch:o,retractionWatchDB:r}=t;try{if("checkRetraction"===e){for(const t of o){const e=!1,o=t.title.toLowerCase().trim().replace(/[.,\/#!$%\^&\*;:}=\_\'\"\(\)\[\]\{\}\+-`~)]/g,"").replace(/\s+/g,"").replace(/retracted/g,"").replace(/retraction/g,"");r.map((async t=>{if(e)return;const r=t.Title.toLowerCase().trim().replace(/[.,\/#!$%\^&\*;:}=\_\'\"\(\)\[\]\{\}\+-`~)]/g,"").replace(/\s+/g,"").replace(/retracted/g,"").replace(/retraction/g,"");o===r&&(e=!0)})),self.postMessage({type:"working",task:"checkRetraction",publication:t,isPubRetracted:e})}self.postMessage({type:"done",task:e})}}catch(t){self.postMessage({type:"error",task:e,error:t.message})}};