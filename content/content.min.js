const fontPath=chrome.runtime.getURL("fonts/SchibstedGrotesk.ttf"),schibsted_grotesk=new FontFace("schibsted-grotesk",`url(${fontPath})`);let excelData=!1,retractionWatchDB=!1,profileScraped=!1,tsvContent="Index	Title	Authors	Total_Authors	Year	Citations	Adjusted_Citations	Adjusment_Weight	Journal	Q*	ImpactFactor_5years	Publication_Considered	First_Author	Second_Author	Co_Author	Corresponding_Author\n";async function loadScript(t,e,o){var r=document.head,a=document.createElement("script");return a.type="text/javascript",a.src=t,a.id=o,a.onreadystatechange=e,a.onload=e,r.appendChild(a),!0}function enableButton(){let t=document.getElementById("inject-content-button");t.textContent="Run GScholarLENS",t.disabled=!1,t.textContent.color="white",t.style.width="fit-content",t.style.display="flex",t.style.alignItems="center",t.style.gap="5px",t.style.fontSize="16px",t.style.color="white",t.style.marginTop="20px",t.style.marginBottom="10px",t.style.zIndex="1000",t.style.borderRadius="7px",t.style.cursor="pointer",t.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",t.style.fontFamily="schibsted-grotesk, sans-serif",t.style.backgroundColor="rgba(0,0,0,0.8)";let e=document.createElement("img");e.src=chrome.runtime.getURL("icons/icon128.png"),e.alt="GScholarLENS",e.style.height="20px",e.style.width="20px",e.style.objectFit="contain",t.prepend(e)}schibsted_grotesk.load().then(t=>{document.fonts.add(t),document.body.style.fontFamily="schibsted-grotesk, sans-serif"}).catch(t=>{console.error("Font failed to load:",t)}),createButton(),chrome.runtime.sendMessage({type:"wait_for_initialization"},t=>{console.log(t.status),async function(){let t=window.location.href.toString(),e=await fetchWithSessionCache(t,t,refetch=!0);200!=e.status&&chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status),window.location.reload()}),excelData=await getJCRExcel(),retractionWatchDB=await getRetractionWatchDB(),enableButton()}()});const cyrb53=(t,e=0)=>{let o=3735928559^e,r=1103547991^e;for(let a=0,n;a<t.length;a++)o=Math.imul(o^(n=t.charCodeAt(a)),2654435761),r=Math.imul(r^n,1597334677);return o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),4294967296*(2097151&(r^=Math.imul(o^o>>>13,3266489909)))+(o>>>0)};async function fetchWithSessionCache(t,e,o=!1){if(!t||0===t.length)return null;let r=cyrb53(t),a=await sessionStorage.getItem(r);if(a&&!o)return a;try{let n=await fetch(e);return n&&200==n.status&&await sessionStorage.setItem(r,n),n}catch(i){return console.error("Error fetching data:",i),null}return!0}function getRandomArbitrary(t,e){return Math.random()*(e-t)+t}function getRandomInt(t,e){return t=Math.ceil(t),Math.floor(Math.random()*((e=Math.floor(e))-t+1))+t}const replaceSpecialChars=t=>{let e={à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",æ:"ae",ā:"a",ç:"c",ć:"c",ĉ:"c",č:"c",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ē:"e",ė:"e",ę:"e",ì:"i",í:"i",î:"i",ï:"i",ī:"i",į:"i",ı:"i",ñ:"n",ń:"n",ň:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ō:"o",ó:"o",œ:"oe",ù:"u",ú:"u",û:"u",ü:"u",ū:"u",ý:"y",ÿ:"y",ž:"z",ź:"z",ż:"z",À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Æ:"AE",Ā:"A",Ç:"C",Ć:"C",Ĉ:"C",Č:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ē:"E",Ė:"E",Ę:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ī:"I",Į:"I",İ:"I",Ñ:"N",Ń:"N",Ň:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ō:"O",Œ:"OE",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ū:"U",Ý:"Y",Ÿ:"Y",Ž:"Z",Ź:"Z",Ż:"Z",œ:"oe",ř:"r",š:"s",ţ:"t",ū:"u",ý:"y"};return t.split("").map(t=>e[t]||t).join("").replace(/[\u2010-\u2015\u2212\uFE58\u2043]/g,"-")},normalizeString=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),matchStrings=(t,e)=>normalizeString(t)===normalizeString(e);function uniq(t){return Array.from(new Set(t))}async function getJCRExcel(){try{return new Promise(t=>{chrome.storage.local.get("jcrJSON",e=>{t(e.jcrJSON||!1)})})}catch(t){console.error("Error: Could not fetch JCR excel data. "+t),chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})}}async function getRetractionWatchDB(){try{return new Promise(t=>{chrome.storage.local.get("retractionwatchdb",e=>{t(e.retractionwatchdb||!1)})})}catch(t){console.error("Error: Could not RetractionWatchDB blob data. "+t),chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})}}function createButton(){if(document.getElementById("inject-content-button")){let t=document.getElementById("inject-content-button");t.style.display="none";return}let e=document.createElement("button");e.id="inject-content-button",e.textContent="Initializing GScholarLENS...",e.disabled=!0,e.style.width="fit-content",e.style.display="flex",e.style.alignItems="center",e.style.gap="5px",e.style.fontSize="16px",e.style.marginTop="20px",e.style.marginBottom="10px",e.style.zIndex="1000",e.style.borderRadius="7px",e.style.cursor="not-allowed",e.style.boxShadow="3px 3px 5px rgba(0,0,0,0.6)",e.style.fontFamily="schibsted-grotesk, sans-serif";let o=document.createElement("img");o.src=chrome.runtime.getURL("icons/icon128.png"),o.alt="GScholarLENS",o.style.height="20px",o.style.width="20px",o.style.objectFit="contain",e.prepend(o);let r=document.querySelector("#gsc_prf");r.append(e),e.addEventListener("click",()=>{try{startScraping(),e.style.display="none"}catch(t){console.error("Error at startScraping() event: "+t),e.style.display="none",chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})}},{passive:!0})}function startScraping(){try{document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&!0===profileScraped&&tQ()}),window.addEventListener("focus",()=>{!0===profileScraped&&tQ()}),window.addEventListener("onbeforeunload",()=>{chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})}),document.getElementsByTagName("body")[0].style.overflow="hidden";let t=0,e=0,o=!1,r=!1,a=!1,n=0,i=0,s=0,l=0,c=0,g=0,d=0,u=0,h=0,$=0,p=0,b=0,f=0,_=0,y=0,m=0,x=0,C=0,v=[.9,.5,.1,1],w=[0,0,0,0],S=[0,0,0,0],k=new Map,q=/^(.*?)(?=\s+\d|,|\s\()/,A=["rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)","rgba(54, 162, 235, 0.2)"],E=["rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(54, 162, 235, 1)"],P=[["rgba(166, 54, 3, 0.4)","rgba(84, 39, 143, 0.4)","rgba(0, 109, 44, 0.4)","rgba(8, 81, 156, 0.4)"],["rgba(230, 85, 13, 0.4)","rgba(117, 107, 177, 0.4)","rgba(49, 163, 84, 0.4)","rgba(49, 130, 189,0.4)"],["rgba(253, 141, 60, 0.4)","rgba(158, 154, 200, 0.4)","rgba(116, 196, 118, 0.4)","rgba(107, 174, 214, 0.4)"],["rgba(253, 190, 133, 0.4)","rgba(203, 201, 226, 0.4)","rgba(186, 228, 179, 0.4)","rgba(189, 215, 231, 0.4)"],["rgba(254, 237, 222, 0.4)","rgba(242, 240, 247, 0.4)","rgba(237, 248, 233, 0.4)","rgba(239, 243, 255, 0.4)"]],Q=[["rgb(127, 44, 2)","rgb(58, 27, 107)","rgb(0, 75, 28)","rgb(5, 52, 105)"],["rgb(179, 63, 11)","rgb(89, 79, 137)","rgb(38, 122, 62)","rgb(35, 97, 138)"],["rgb(184, 94, 42)","rgb(108, 106, 148)","rgb(78, 139, 82)","rgb(73, 115, 155)"],["rgb(194, 151, 99)","rgb(157, 156, 186)","rgb(145, 161, 135)","rgb(148, 173, 197)"],["rgb(205, 141, 108)","rgb(180, 168, 207)","rgb(157, 208, 150)","rgb(150, 180, 230)"]],z=chrome.runtime.getURL("libs/chart.umd.js"),T=chrome.runtime.getURL("libs/papaparse.min.js"),B=[],I=[],N=new Map,j=[],L=document.createElement("div");L.style.marginTop="50px",L.style.width="100%",L.style.backgroundColor="#ddd",L.style.borderRadius="5px",L.style.overflow="hidden",L.style.position="relative";let R=document.createElement("div");R.style.width="0%",R.style.height="20px",R.style.backgroundColor="#4caf50",R.style.transition="width 0.3s ease";let D=document.createElement("span");async function F(t,e="Progress: ",o=!1,r=20,a=5){(t<=0||t>=100||t%a||o)&&(setTimeout(W,r,t,e),await Promise.resolve())}async function W(t,e="Progress: "){R.style.width=t.toFixed(2)+"%",D.textContent=e+`${t.toFixed(2)}%`}D.style.position="absolute",D.style.width="100%",D.style.textAlign="center",D.style.marginTop="2px",D.style.fontSize="calc(0.3em + 0.55vw)",D.style.color="#000",D.style.whiteSpace="nowrap",D.style.fontFamily="schibsted-grotesk, sans-serif",L.appendChild(D),L.appendChild(R);let M=document.querySelector("#gsc_prf_w");M.appendChild(L);let O=document.createElement("div");function U(o=-1){let r=document.querySelectorAll(".double_range_slider_box input"),a=document.getElementById("double_range_track"),i=document.querySelector(".minvalue"),s=document.querySelector(".maxvalue"),l=o>0?o:parseInt(r[0].value),c=parseInt(r[1].value);c-l<1&&(r[0].value=c-1);let g=parseInt(r[0].value),d=parseInt(r[1].value);a.style.left=(g-t)/(e-t)*100+"%",a.style.right=100-(d-t)/(e-t)*100+"%",i.textContent=g,s.textContent=d,i.style.left=(g-t)/(e-t)*100+"%",s.style.left=(d-t)/(e-t)*100+"%",n=parseInt(r[0].value)}function J(o=-1){let r=document.querySelectorAll(".double_range_slider_box input"),a=document.getElementById("double_range_track"),n=document.querySelector(".minvalue"),s=document.querySelector(".maxvalue"),l=parseInt(r[0].value),c=o>0?o:parseInt(r[1].value);c-l<1&&(r[1].value=l+1);let g=parseInt(r[0].value),d=parseInt(r[1].value);a.style.left=(g-t)/(e-t)*100+"%",a.style.right=100-(d-t)/(e-t)*100+"%",n.textContent=g,s.textContent=d,n.style.left=(g-t)/(e-t)*100+"%",s.style.left=(d-t)/(e-t)*100+"%",i=parseInt(r[1].value)}function G(o=-1){let r=document.getElementById("single_range_track"),a=document.getElementById("single_range"),n=document.querySelector(".singlevalue"),i=o>0?o:parseInt(a.value);r.style.right=100-(i-t)/(e-t)*100+"%",r.style.left="0%",n.textContent=i,n.style.left=(i-t)/(e-t)*100+"%",s=i}function H(){let t=document.getElementById("cumulative_checkbox"),e=document.getElementById("single_range_track"),n=document.getElementById("peryear_checkbox");t.checked?(e.style.display="flex",a=!0):(e.style.display="none",a=!1),o=n.checked,r=t.checked}function Z(){let t=document.getElementById("cumulative_checkbox"),e=document.querySelector('label[for="cumulative_checkbox"]'),n=document.getElementById("peryear_checkbox"),i=document.getElementById("double_range_slider"),s=document.getElementById("single_range_slider");n.checked?(i.style.display="none",s.style.display="flex",t.style.display="inline-block",e.style.display="inline-block",a?(t.checked=!0,H()):t.checked=!1):(i.style.display="flex",s.style.display="none",t.style.display="none",e.style.display="none"),o=n.checked,r=t.checked}O.setAttribute("id","chart-viz"),O.style.display="none",M.appendChild(O),!function o(){let r=document.createElement("style");r.textContent=`
            .range_slider_wrapper {
    display: flex;
    justify-content: center;  /* Center the content */
    align-items: center;
    width: 100%;
    padding: 20px;
    box-sizing: border-box;
    background-color: #f5f5f5;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);  /* Shadow effect */
    border-radius: 15px;  /* Rounded border */
}

.range_slider_container {
    width: 400px; /* Decrease the overall width of the container */
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
}

.toggle_container {
    margin-bottom: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
    transform: translate(0, 20%);
}

#peryear_checkbox {
    display: inline-block;
    width: 15px; /* Adjust size as needed */
    height: 15px;
    position: relative;
    margin: 15px 0 0 0;
    padding: 0;
    pointer-events: auto;
    cursor: pointer;
    background-color: white; /* Default background */
    border: 2px solid black;
    border-radius: 4px; /* For rounded corners */
}

#peryear_checkbox:checked {
    background-color: black;
    border-color: black;
}

#peryear_checkbox:checked::after {
    content: '✓';
    color: white;
    font-size: 16px; /* Adjust size as needed */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

#cumulative_checkbox {
    display: inline-block;
    width: 15px; /* Adjust size as needed */
    height: 15px;
    position: relative;
    margin: 15px 15px 0 0;
    padding: 0;
    pointer-events: auto;
    cursor: pointer;
    background-color: white; /* Default background */
    border: 2px solid black;
    border-radius: 4px; /* For rounded corners */
}

#cumulative_checkbox:checked {
    background-color: black;
    border-color: black;
}

#cumulative_checkbox:checked::after {
    content: '✓';
    color: white;
    font-size: 16px; /* Adjust size as needed */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.double_range_slider_box, .single_range_slider_box {
    position: relative;
    width: 100%; /* Adjust width */
    max-width: 250px; /* Decrease max-width */
    height: 80px; /* Decrease height */
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 20px;
    overflow: visible;
}

.range_slider {
    width: 100%;
    height: 8px; /* Decrease slider height */
    position: relative;
    background-color: #dddddd;
    border-radius: 20px;
}

.range_track {
    height: 100%;
    position: absolute;
    border-radius: 20px;
    background-color: #000000; /* Light grey */
    z-index: 1;
    transition: width 0.3s ease-in-out;  /* Smooth transition */
    left: 0;  /* Ensure it starts from the left */
    top: 0;
}

.minvalue, .maxvalue, .singlevalue {
    position: absolute;
    padding: 3px 8px; /* Decrease padding */
    background: #0e5f59;
    border-radius: 1rem;
    color: white;
    font-size: 0.8rem; /* Reduce font size */
    z-index: 10;
    white-space: nowrap;
    max-width: fit-content;
}

/* Position adjustments */
.minvalue {
    left: 0;
    width: fit-content;
    transform: translate(-50%, 80%);
    transition: left 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.maxvalue {
    right: 0;
    width: fit-content;
    transform: translate(-50%, -120%);
    transition: right 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.singlevalue {
    width: fit-content;
    transform: translate(-50%, -120%);
    transition: right 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
}

/* General range slider input settings */
input {
    position: absolute;
    width: 100%;
    height: 5px;
    background: none;
    pointer-events: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    top: 50%;
    transform: translate(-0.75%,-75%);
    z-index: 3;
}

/* Thumb style for Webkit (Chrome, Safari) */
input::-webkit-slider-thumb {
    height: 20px; /* Decrease thumb size */
    width: 20px;
    border-radius: 50%;
    border: 3px solid #696969; /* Light grey for border */
    background-color: #d3d3d3; /* Dark grey for thumb */
    pointer-events: auto;
    -webkit-appearance: none;
    cursor: pointer;
    margin-bottom: 0;
    z-index: 4;
}

/* Thumb style for Mozilla (Firefox) */
input::-moz-range-thumb {
    height: 20px; /* Decrease thumb size */
    width: 20px;
    border-radius: 50%;
    border: 3px solid #696969; /* Light grey for border */
    background-color: #d3d3d3; /* Dark grey for thumb */
    pointer-events: auto;
    -moz-appearance: none;
    cursor: pointer;
    margin-top: 0;
    z-index: 4;
}
/* CSS styles for sharma_index_container and sh_table */
.sharma_index_container {
    font-size: 1.0rem;
    font-weight: 500;
    margin-bottom: 10px;
    justify-content: center;
    display: inline-block;
}

/* .sh_table_container {
    width: 80%;
    border: black;
    border-style: solid;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
    border-bottom-left-radius: 10px;
    display: block;
    margin: 0 auto;
}

.sh_table_container table td, 
.sh_table_container table th {
  border: 1px solid black;
} */

  .sh_table_container-outer {
  border: 2px solid #2c3e50;
  border-radius: 12px;
  overflow: hidden;
  width: 100%;
  max-width: 600px;
  margin: 1rem 0;
  margin-left: auto;
  margin-right: auto;
}

.sh_table_container-inner {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

.sh_table_container-inner th,
.sh_table_container-inner td {
  padding: 14px;
  text-align: left;
  border-bottom: 1px solid #ecf0f1;
  border-right: 1px solid #ecf0f1;
}

.sh_table_container-inner th {
  background-color: #34495e;
  color: white;
  border-right: 1px solid #2c3e50;
}

.sh_table_container-inner tr:last-child td {
  border-bottom: none;
}

.sh_table_container-inner td:last-child,
.sh_table_container-inner th:last-child {
  border-right: none;
}

/* Thanks DeepSeek R1 */
.journalTableStyle {
  border: 2px solid #333;
  border-radius: 10px;
  overflow: hidden;
  border-collapse: separate;
  border-spacing: 0px;
  /*border-collapse: collapse;*/
  width: 100%;
  max-width: 600px;
  margin: 1rem 0;
}

.journalTableStyle th,
.journalTableStyle td {
  padding: 12px;
  text-align: left;
  border: none;
}

.journalTableStyle thead {
  background-color: #f8f8f8;
}

.plotmetrics_table {
    table-layout: fixed;
    width: auto;
}

.plotmetrics_table_container {
    display: flex;
    justify-content: center;
}

.yearplot_table_container {
  width: 70%;
  height: 100%;
  position: relative;
}

#tenyearPubCountChart {
  width: 80% !important; /*ONLY CHANGE THIS to modify width of decade plot*/
  height: 100% !important;
} 

.position-circles {
    transition: all 0.2s ease-in-out;
    position: relative;
}

.circles-container {
    transition: all 0.2s ease-in-out;
    position: relative;
}

.position-circles:hover .circles-container{
    transform: scale(1.10);
    z-index: 1000;
    opacity: 1;
}

.position-circles:hover .q-badge {
    opacity: 1;
    transform: scale(1.10) ;/*translateX(50%);  Combine transforms */;
    z-index: 1000;
}

.position-circles:hover .if-badge {
    opacity: 1;
    transform: scale(1.10) ;/*translateX(55%);  Combine transforms */;
    z-index: 1000;
}

/* Optional: Add tooltip for circle meanings */
.position-circles span {
    position: relative;
    /*cursor: help;*/
}

.position-circles span[data-role]:hover::after {
    content: attr(data-role);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%); 
    background: #333;
    color: white;
    padding: 4px 8px;
    margin-bottom: 5px;
    z-index: 10;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    transform: translateX(-50%) scale(1/1.15); /* Counteract parent scale */
}
            `,document.head.appendChild(r);let a=document.querySelector("#chart-viz");a.style.marginTop="50px",a.innerHTML=DOMPurify.sanitize(`
                    <div id="GScholarLENS">
                        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
                        <div style="font-family = 'schibsted-grotesk, sans-serif'; padding: 20px; marginTop: 10px; margin: 35px; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.05); background-color: #fff;">
                            <div style="text-align: center;">
                                <div class="sharma_index_container">
                                    <h2 id="sh_index">Sh-Index : ${b}</h2>
                                </div>
                            </div>
                            <br>
                            <div class="sh_table_container-outer">
                                <table class="sh_table_container-inner" /*style="width: 100%;"*/>
                                    <tr>
                                        <th style="text-align: center; padding: 8px 0;">H<sub>First</sub> - First Author</th>
                                        
                                        <th style="text-align: center; padding: 8px 0;">H<sub>Second</sub>- Second Author</th>
                                        
                                        <th style="text-align: center;">H<sub>Other</sub> - Co Author</th>
                                        
                                        <th style="text-align: center; padding: 8px 0;">H<sub>Co</sub> - Corresponding Author</th>
                                        
                                    </tr>
                                    <tr>
                                        <td id="h_first" style="text-align: center;">${u}</td>
                                        <td id="h_second" style="text-align: center;">${h}</td>
                                        <td id="h_other" style="text-align: center;">${$}</td>
                                        <td id="h_co" style="text-align: center;">${p}</td>
                                    </tr>
                                </table>
                            </div>
                            <br>
                            <div class="plotmetrics_table_container">
                                <table class="plotmetrics_table" >
                                    <tbody class="plotmetrics_table_container">
                                    <tr>
                                        <td id="table_metrics" style="border-right: 1px solid black; padding-right: 15px; text-align: center; padding-left: 15px;">
                                        <div class="metrics_table_container">
                                        <table >
                                            <tr>
                                                <th style="text-align: left;"><b>Total Publications:</b></th>
                                                <td id="total_pubs" style="text-align: center;">${c}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Publications Considered:</b></th>
                                                <td id="considered_pubs" style="text-align: center;">${c-g}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Publications Not Counted:</b></th>
                                                <td id="ignored_pubs" style="text-align: center;">${g}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Median - Raw Citations:</b></th>
                                                <td id="medianCitationsRaw" style="text-align: center;">${_}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Median - Adjusted Citations:</b></th>
                                                <td id="medianCitationsAdj" style="text-align: center;">${y}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Zero Citations:</b></th>
                                                <td id="zeroCitationPubs" style="text-align: center;">${m}</td>
                                            </tr>
                                            <tr>
                                                <th class="blink_text" style="color: red; text-align: left;"><b>Total Retractions:</b></th>
                                                <td id="retractedPubsCount" style="text-align: center;">${x}</td>
                                            </tr>
                                            <tr>
                                                <th style="text-align: left;"><b>Total Preprints:</b></th>
                                                <td id="preprintCount" style="text-align: center;">${C}</td>
                                            </tr>
                                        </table>
                                        </div>
                                        </td>
                                        <td id="year_plot" style="width: 100%;">
                                            <div class="plotmetrics_table_container"><canvas id="tenyearPubCountChart" class="yearplot_table_container"></canvas></div>
                                        </td>                                        
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <center><span id="pubmachine_banner" style="color: blue; font-weight: bold;"></span></center>
                            <br>
                            <div class="range_slider_container">
                                <div class="toggle_container">
                                    <label for="peryear_checkbox" style="transform: translateY(-3px);">Per-Year</label>
                                    <input type="checkbox" id="peryear_checkbox"/>
                                    <label for="cumulative_checkbox" style="transform: translateY(-3px);">Cumulative</label>
                                    <input type="checkbox" id="cumulative_checkbox"/>
                                </div>

                                <!-- Double Range Slider -->
                                <div class="double_range_slider_box" id="double_range_slider">
                                    <div class="range_slider">
                                        <span class="range_track" id="double_range_track"></span>
                                        <input class="double_range" type="range" class="min" min="${t}" max="${e}" value="${n}" step="1" />
                                        <input class="double_range" type="range" class="max" min="${t}" max="${e}" value="${i}" step="1" />
                                        <div class="minvalue"></div>
                                        <div class="maxvalue"></div>
                                    </div>
                                </div>

                                <!-- Single Range Slider -->
                                <div class="single_range_slider_box" id="single_range_slider">
                                    <div class="range_slider">
                                        <span class="range_track" id="single_range_track"></span>
                                        <input id="single_range" type="range" class="single" min="${t}" max="${e}" value="${i}" step="1" />
                                        <div class="singlevalue"></div>
                                    </div>
                                </div>
                            </div>
                            <canvas id="qScorePosStackedChart"></canvas>
                            <canvas id="authorCitationsChart"></canvas>
                            <canvas id="authorCitationsDistChart"></canvas>                            
                            <div id="authorStackedChartDiv" style="width: 100%; height: 10%;">
                                <canvas id="authorStackedChart"></canvas>
                            </div>
                            <div id="citationsStackedChartDiv" style="width: 100%; height: 10%;">
                                <canvas id="citationsStackedChart"></canvas>
                            </div>

                                <br>
                                <b>Author Names Considered: </b><span id="using_author_names">${I.toString()}</span>
                                <br>
                            <b>Top 3 Journals: </b>
                            <div id="journalTable" style="display: flex; justify-content: center;"></div>
                        </div>
                    </div>
                    `);let s=document.getElementById("cumulative_checkbox"),l=document.getElementById("peryear_checkbox");l.addEventListener("change",Z),s.addEventListener("change",H);let d=document.querySelectorAll(".double_range_slider_box input"),f=document.getElementById("single_range");d[0].addEventListener("input",U),d[1].addEventListener("input",J),f.addEventListener("input",G),l.addEventListener("change",tQ),s.addEventListener("change",tQ),f.addEventListener("change",tQ),d.forEach(t=>{t.addEventListener("change",tQ)})}();let Y=document.createElement("button");Y.id="helpButton",Y.style.fontFamily="schibsted-grotesk, sans-serif",Y.style.marginTop="10px",Y.style.marginRight="10px",Y.textContent="GScholarLENS Help",Y.addEventListener("click",function(){window.open("https://project.iith.ac.in/sharmaglab/gscholarlens/","_blank")}),M.appendChild(Y);let X=document.createElement("button");X.id="downloadDetailsButton",X.disabled=!0,X.style.fontFamily="schibsted-grotesk, sans-serif",X.style.marginTop="10px",X.style.marginRight="10px",X.textContent="Download Details",M.appendChild(X),X.addEventListener("click",function(){let t=new Blob([tsvContent],{type:"text/tab-separated-values"}),e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download=`${tt.replace(/\s+/g,"_")}_publications.tsv`,o.click()});let V=document.createElement("button");V.id="downloadPlotsButton",V.disabled=!0,V.style.fontFamily="schibsted-grotesk, sans-serif",V.style.marginTop="10px",V.style.marginRight="10px",V.textContent="Download Plots",M.appendChild(V),V.addEventListener("click",function(){let t=chrome.runtime.getURL("libs/dom-to-image-more.min.js");loadScript(t,function t(){var e=document.getElementById("GScholarLENS");domtoimage.toJpeg(e).then(function(t){var e=document.createElement("a");e.download=`${tt.replace(/\s+/g,"_")}_plots.jpeg`,e.href=t,e.click()}).catch(function(t){console.error("Error: Could not capture the plots!",t)})},"dom2image_script")});let K=document.querySelector("#gsc_prf_in"),tt=K?K.textContent.trim():"Not found";function te(t){let e=/\b(dr|mr|mrs|ms|miss|prof|phd|ph\.?d|md|m\.?d|jr|sr)\b/gi,o=t.replace(e,"");return o=(o=(o=o.replace(/[.,\/#!$%\^&\*;:}=\_`~)]/g,"")).replace(/\s+/g," ").trim()).split(/[,\.\(\;\:\[\{\*)]/)[0].trim()}function to(t){return t.replace("/[.*+?^${}()|[]\\]/g","\\$&")}let tr=document.querySelector("#gsc_prf_in").textContent.trim(),ta=document.querySelector("#gs_prf_ion_txt"),tn="";void 0!=ta&&(tn=ta.textContent.trim());let ti=[],ts=[];if(tn.length>0){let tl=tn.split(/;|,|:/).map(t=>t.trim()).filter(Boolean),tc=0;for(;tc<tl.length;)tc+1<tl.length&&1===tl[tc].split(" ").length?(tl[tc]=`${tl[tc]}, ${tl[tc+1]}`,tl.splice(tc+1,1)):tc++;ts=(ts=(ts=tl.filter(t=>2===t.split(" ").length)).map(t=>{let e=t.replace(/[^\w\s-]|_/g,"").replace(/\s+/g," ").trim();return e=e.replace(/[–—]/g,"-"),te(replaceSpecialChars(normalizeString(e)))})).filter(t=>""!==t.trim());let tg=ts.map(t=>{let e=t.split(" ").map(t=>t.trim());return e.reverse().join(" ")});ts=(ts=[...ts,...tg]).map(t=>t.replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").trim()),ts=Array.from(new Set(ts))}let td=te(replaceSpecialChars(normalizeString(tr))),tu=function t(e){let o=e.split(" "),r=o[o.length-1];return r}(td),th=function t(e){let o=e.split(" ");if(1===o.length)return[e];{let r=o[0].charAt(0),a=o[o.length-1],n=`${r} ${a}`,i=`${o[0]} ${o[1].charAt(0)}`,s=`${a} ${o[0]}`,l=`${a} ${r}`,c=`${a.charAt(0)} ${o[0]}`;return[n,i,s,l,c]}}(td);ti.push(td),ti=[...ti=[...ti,...th],...ts],ti=Array.from(new Set(ti));let t$=[],tp=[];function t8(t,e){return N.get(e).size<=0||!N.get(e).has("author_pos_cite_qscore")?[0,0,0,0]:[N.get(e).get("author_pos_cite_qscore").get("first_author").get(t),N.get(e).get("author_pos_cite_qscore").get("second_author").get(t),N.get(e).get("author_pos_cite_qscore").get("co_author").get(t),N.get(e).get("author_pos_cite_qscore").get("corresponding_author").get(t)]}function tb(t,e){return N.get(e).size<=0||!N.get(e).has("author_pos_cite_qscore")?[0,0,0,0,0]:[N.get(e).get("author_pos_cite_qscore").get(t).get("Q1"),N.get(e).get("author_pos_cite_qscore").get(t).get("Q2"),N.get(e).get("author_pos_cite_qscore").get(t).get("Q3"),N.get(e).get("author_pos_cite_qscore").get(t).get("Q4"),N.get(e).get("author_pos_cite_qscore").get(t).get("NA"),]}function tf(t,e){return N.get(e).size<=0||!N.get(e).has("author_pos_cite_qscore")?0:N.get(e).get("author_pos_cite_qscore").get(t).get("Q1")+N.get(e).get("author_pos_cite_qscore").get(t).get("Q2")+N.get(e).get("author_pos_cite_qscore").get(t).get("Q3")+N.get(e).get("author_pos_cite_qscore").get(t).get("Q4")+N.get(e).get("author_pos_cite_qscore").get(t).get("NA")}function t_(t,e){return N.get(e).size<=0||!N.get(e).has("qPosCount")?[0,0,0,0]:[N.get(e).get("qPosCount").get("first_author").get(t),N.get(e).get("qPosCount").get("second_author").get(t),N.get(e).get("qPosCount").get("co_author").get(t),N.get(e).get("qPosCount").get("corresponding_author").get(t)]}function ty(t,e){return N.get(e).size<=0||!N.get(e).has("qPosCount")?[0,0,0,0]:[N.get(e).get("qPosCount").get("first_author").get(t)/tm("first_author",e).reduce((t,e)=>t+e,0)*100,N.get(e).get("qPosCount").get("second_author").get(t)/tm("second_author",e).reduce((t,e)=>t+e,0)*100,N.get(e).get("qPosCount").get("co_author").get(t)/tm("co_author",e).reduce((t,e)=>t+e,0)*100,N.get(e).get("qPosCount").get("corresponding_author").get(t)/tm("corresponding_author",e).reduce((t,e)=>t+e,0)*100]}function tm(t,e){return N.get(e).size<=0||!N.get(e).has("qPosCount")?[0,0,0,0,0]:[N.get(e).get("qPosCount").get(t).get("Q1"),N.get(e).get("qPosCount").get(t).get("Q2"),N.get(e).get("qPosCount").get(t).get("Q3"),N.get(e).get("qPosCount").get(t).get("Q4"),N.get(e).get("qPosCount").get(t).get("NA")]}function tx(t,e){return N.get(e).size<=0||!N.get(e).has("qPosCount")?0:N.get(e).get("qPosCount").get(t).get("Q1")+N.get(e).get("qPosCount").get(t).get("Q2")+N.get(e).get("qPosCount").get(t).get("Q3")+N.get(e).get("qPosCount").get(t).get("Q4")+N.get(e).get("qPosCount").get(t).get("NA")}function tC(t,e){return N.get(e).size<=0||!N.get(e).has("qPosCount")?[0,0,0,0,0]:[N.get(e).get("qPosCount").get(t).get("Q1")/N.get(e).get("qTotal").get("Q1")*100,N.get(e).get("qPosCount").get(t).get("Q2")/N.get(e).get("qTotal").get("Q2")*100,N.get(e).get("qPosCount").get(t).get("Q3")/N.get(e).get("qTotal").get("Q3")*100,N.get(e).get("qPosCount").get(t).get("Q4")/N.get(e).get("qTotal").get("Q4")*100,N.get(e).get("qPosCount").get(t).get("NA")/N.get(e).get("qTotal").get("NA")*100]}function tv(t){return N.get(t).size<=0||!N.get(t).has("total_publications")?0:N.get(t).get("total_publications")}function t0(t){return N.get(t).size<=0||!N.get(t).has("author_pos_contrib")?[0,0,0,0]:[N.get(t).get("author_pos_contrib").get("first_author"),N.get(t).get("author_pos_contrib").get("second_author"),N.get(t).get("author_pos_contrib").get("co_author"),N.get(t).get("author_pos_contrib").get("corresponding_author")]}function tw(t){return N.get(t).size<=0||!N.get(t).has("author_pos_cite_contrib")?[0,0,0,0]:[N.get(t).get("author_pos_cite_contrib").get("first_author"),N.get(t).get("author_pos_cite_contrib").get("second_author"),N.get(t).get("author_pos_cite_contrib").get("co_author"),N.get(t).get("author_pos_cite_contrib").get("corresponding_author")]}function tS(t){return N.get(t).size<=0||!N.get(t).has("author_pos_cite_map")?[0,0,0,0]:[N.get(t).get("author_pos_cite_map").get("first_author"),N.get(t).get("author_pos_cite_map").get("second_author"),N.get(t).get("author_pos_cite_map").get("co_author"),N.get(t).get("author_pos_cite_map").get("corresponding_author")]}function tk(t,e,o){let r=[0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=t8(t,a.toString());for(let i=0;i<4;i++)r[i]+=n[i]}return r}function t3(t,e,o){let r=[0,0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=tb(t,a.toString());for(let i=0;i<5;i++)r[i]+=n[i]}return r}function tq(t,e,o){let r=0;for(let a=e;a<=o;a++)j.includes(a.toString())&&(r+=tf(t,a.toString()));return r}function tA(t,e,o){let r=[0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=t_(t,a.toString());for(let i=0;i<4;i++)r[i]+=n[i]}return r}function t1(t,e,o){let r=[0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=ty(t,a.toString());for(let i=0;i<4;i++)r[i]+=n[i]}let s=Math.abs(o-e);for(let l=0;l<4;l++)r[l]=r[l]/s*100;return r}function tE(t,e,o){let r=[0,0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=tm(t,a.toString());for(let i=0;i<5;i++)r[i]+=n[i]}return r}function t2(t,e,o){let r=0;for(let a=e;a<=o;a++)j.includes(a.toString())&&(r+=tx(t,a.toString()));return r}function t9(t,e,o){let r=[0,0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=tC(t,a.toString());for(let i=0;i<5;i++)r[i]+=n[i]}let s=Math.abs(o-e);for(let l=0;l<5;l++)r[l]=r[l]/s*100;return r}function tP(t,e){let o=0;for(let r=t;r<=e;r++)j.includes(r.toString())&&(o+=tv(r.toString()));return o}function tQ(){let e=o?r?t:s:n,a=o?s:i,l=[tq("first_author",e,a),tq("second_author",e,a),tq("co_author",e,a),tq("corresponding_author",e,a)],d=[tk("Q1",e,a),tk("Q2",e,a),tk("Q3",e,a),tk("Q4",e,a),tk("NA",e,a)],u={labels:["First Author Citations\nTotal:"+l[0],"Second Author Citations\nTotal:"+l[1],"Co-Author Citations\nTotal:"+l[2],"Corresponding Author Citations\nTotal:"+l[3]],datasets:[{label:"Q1 Citations",data:d[0],backgroundColor:P[0],borderColor:Q[0],borderWidth:1},{label:"Q2 Citations",data:d[1],backgroundColor:P[1],borderColor:Q[1],borderWidth:1},{label:"Q3 Citations",data:d[2],backgroundColor:P[2],borderColor:Q[2],borderWidth:1},{label:"Q4 Citations",data:d[3],backgroundColor:P[3],borderColor:Q[3],borderWidth:1},{label:"NA Citations",data:d[4],backgroundColor:P[4],borderColor:Q[4],borderWidth:1}]},h=Chart.getChart("authorCitationsChart");if(void 0!=h)h.data=u,h.update();else{let $=document.getElementById("authorCitationsChart").getContext("2d");new Chart($,{type:"bar",data:u,options:{responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Count based on Authorship with Journal Rank Categorization"}},scales:{x:{stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let p=function t(e,o){let r=[[],[],[],[]];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=tS(a.toString());for(let i=0;i<4;i++)r[i].push(n[i]),r[i]=r[i].toString().split(",").filter(t=>""!==t).map(Number)}return r}(e,a),b={labels:["First Author Citations","Second Author Citations","Co-Author Citations","Corresponding Author Citations"],datasets:[{label:"Citation Distribution",data:[p[0],p[1],p[2],p[3]],backgroundColor:A,borderColor:E,borderWidth:1}]};if(void 0!=(h=Chart.getChart("authorCitationsDistChart")))h.data=b,h.update();else{let f=document.getElementById("authorCitationsDistChart").getContext("2d");new Chart(f,{type:"violin",data:b,options:{responsive:!0,whiskersMode:"exact",coef:0,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Distribution based on Authorship (Log Scale)"}},scales:{x:{grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{type:"logarithmic",beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let _=function t(e,o){let r=[0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=t0(a.toString());for(let i=0;i<4;i++)r[i]+=n[i]}return r}(e,a),y=_[0]+_[1]+_[2]+_[3],m=(_[0]/y*100).toFixed(2),x=(_[1]/y*100).toFixed(2),C=(_[3]/y*100).toFixed(2),v=(_[2]/y*100).toFixed(2),w={labels:[""],datasets:[{label:"First Author Contribution %",data:[m],backgroundColor:A[0],borderColor:E[0],borderWidth:1},{label:"Second Author Contribution %",data:[x],backgroundColor:A[1],borderColor:E[1],borderWidth:1},{label:"Co-Author Contribution %",data:[v],backgroundColor:A[2],borderColor:E[2],borderWidth:1},{label:"Corresponding Author Contribution %",data:[C],backgroundColor:A[3],borderColor:E[3],borderWidth:1}]};if(void 0!=(h=Chart.getChart("authorStackedChart"))){let S=document.getElementById("authorStackedChartDiv");S.style.height="150px",h.data=w,h.update()}else{let k=document.getElementById("authorStackedChartDiv");k.style.height="150px";let q=document.getElementById("authorStackedChart").getContext("2d");new Chart(q,{type:"bar",data:w,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Author Contribution in % based on Authorship"}},scales:{x:{stacked:!0,beginAtZero:!0,max:100,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let z=function t(e,o){let r=[0,0,0,0];for(let a=e;a<=o;a++){if(!j.includes(a.toString()))continue;let n=tw(a.toString());for(let i=0;i<4;i++)r[i]+=n[i]}return r}(e,a),T=z[0]+z[1]+z[2]+z[3],B=(z[0]/T*100).toFixed(2),N=(z[1]/T*100).toFixed(2),L=(z[3]/T*100).toFixed(2),R=(z[2]/T*100).toFixed(2),D={labels:[""],datasets:[{label:"First Author Citations %",data:[B],backgroundColor:A[0],borderColor:E[0],borderWidth:1},{label:"Second Author Citations %",data:[N],backgroundColor:A[1],borderColor:E[1],borderWidth:1},{label:"Co-Author Citations %",data:[R],backgroundColor:A[2],borderColor:E[2],borderWidth:1},{label:"Corresponding Author Citations %",data:[L],backgroundColor:A[3],borderColor:E[3],borderWidth:1}]};if(void 0!=(h=Chart.getChart("citationsStackedChart"))){let F=document.getElementById("citationsStackedChartDiv");F.style.height="150px",h.data=D,h.update()}else{let W=document.getElementById("citationsStackedChartDiv");W.style.height="150px";let M=document.getElementById("citationsStackedChart").getContext("2d");new Chart(M,{type:"bar",data:D,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Citation Contribution in % based on Authorship"}},scales:{x:{stacked:!0,beginAtZero:!0,max:100,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let Y=[t2("first_author",e,a),t2("second_author",e,a),t2("co_author",e,a),t2("corresponding_author",e,a)],K=[tA("Q1",e,a),tA("Q2",e,a),tA("Q3",e,a),tA("Q4",e,a),tA("NA",e,a)],tt={labels:["First Author Q*\nTotal:"+Y[0],"Second Author Q*\nTotal:"+Y[1],"Co-Author Q*\nTotal:"+Y[2],"Corresponding Author Q*\nTotal:"+Y[3]],datasets:[{label:"Q1",data:K[0],backgroundColor:P[0],borderColor:Q[0],borderWidth:1},{label:"Q2",data:K[1],backgroundColor:P[1],borderColor:Q[1],borderWidth:1},{label:"Q3",data:K[2],backgroundColor:P[2],borderColor:Q[2],borderWidth:1},{label:"Q4",data:K[3],backgroundColor:P[3],borderColor:Q[3],borderWidth:1},{label:"NA",data:K[4],backgroundColor:P[4],borderColor:Q[4],borderWidth:1}]};if(void 0!=(h=Chart.getChart("qScorePosStackedChart")))h.data=tt,h.update();else{let te=document.getElementById("qScorePosStackedChart").getContext("2d");new Chart(te,{type:"bar",data:tt,options:{indexAxis:"x",plugins:{legend:{display:!1},title:{display:!0,text:"Publication Count based on Authorship with Journal Rank Categorization"}},scales:{x:{stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{beginAtZero:!0,stacked:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}let to=document.querySelectorAll(".double_range_slider_box input"),tr=document.getElementById("single_range");tr.value=s.toString(),to[0].value=n.toString(),to[1].value=i.toString(),G(s),U(n),J(i),Z(),H(),n=parseInt(to[0].value),i=parseInt(to[1].value),s=parseInt(tr.value);let ta=document.getElementById("total_pubs"),tn=document.getElementById("ignored_pubs"),ti=document.getElementById("considered_pubs"),ts=document.getElementById("using_author_names");ta.textContent=DOMPurify.sanitize(`${c.toString()}`),ti.textContent=DOMPurify.sanitize(`${c-g}`),tn.textContent=DOMPurify.sanitize(`${g}`),ts.textContent=DOMPurify.sanitize(`${I.toString()}`),X.disabled=!1,V.disabled=!1,O.style.display="block"}function tz(){let t=[],o=[],r=[],a=!1,n=e-10;for(;n<=e;){if(o.push(n),N.has(n.toString())){let i=N.get(n.toString()).get("total_publications");t.push(i),i>48&&(a=!0,r.push(n))}else t.push(0);n+=1}a&&(document.getElementById("pubmachine_banner").textContent=`>48 Papers/Year (${r.join(", ")})`);let s={labels:o,datasets:[{label:["Publication Count"],data:t,backgroundColor:P[0][0],borderColor:Q[0][0],borderWidth:1}]};Chart.register({id:"dropOffLine",afterDraw(t,e,o){let{ctx:r,scales:a}=t,n=a.y,i=a.x,s=o.value,l=n.getPixelForValue(s);r.save(),r.beginPath(),r.strokeStyle=o.borderColor,r.lineWidth=o.borderWidth,r.moveTo(i.left,l),r.lineTo(i.right,l),r.stroke(),o.label&&o.label.enabled&&(r.fillStyle=o.label.color||o.borderColor,r.textAlign="start"===o.label.position?"left":"center",r.textBaseline="bottom",r.fillText(o.label.content,(i.left+i.right)/2,l-4)),r.restore()}});let l=Chart.getChart("tenyearPubCountChart");if(void 0!=l)l.data=s,l.update();else{let c=document.getElementById("tenyearPubCountChart").getContext("2d");new Chart(c,{type:"bar",data:s,options:{responsive:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Publication Counts of last 10 years"},dropOffLine:{value:48,borderColor:"rgba(6, 40, 233, 0.7)",borderWidth:2,z:-1,label:{enabled:!0,content:"Publication Machine",position:"start",color:"rgba(6, 40, 233, 0.7)",z:-2}}},scales:{x:{stacked:!1,grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{stacked:!1,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}}ti.forEach(t=>{t$.push(function t(e){let o=e.trim().split(/\s+/),r=to(o[o.length-1]),a=to(o[0].charAt(0));return o[0].length>1&&r.length>1?RegExp(`^${a}.*\\s${r}[\\*^]?$`,"i"):RegExp(`^${o[0]}.*\\s${r}[\\*^]?$`,"i")}(t)),tp.push(function t(e){let o=e.trim().split(/\s+/),r=to(o[0]),a=to(o[o.length-1]);return RegExp(`^${r}.*\\s${a}[\\*^]?$`,"i")}(t))});let t6=async()=>{let o=document.querySelectorAll(".gsc_a_tr"),r=new Map;o.forEach(async(o,a)=>{let l=o.querySelector(".gsc_a_t a"),c=l?l.textContent.trim():"No title",g=l?l.href:null,d=o.querySelector(".gsc_a_c a");d=d?d.textContent.trim():"0";let u=parseInt(d);isNaN(u)&&(u=0);let h=o.querySelectorAll(".gsc_a_t .gs_gray"),$=o.querySelector(".gs_oph"),p=$&&$.previousSibling?$.previousSibling.textContent.trim():"Unknown Journal";if(null!=p.toLowerCase().match(/rxiv/))C++;else{let b=p.match(q),f=b?b[1].trim():p;k.has(f)||k.set(f,0),k.set(f,k.get(f)+1)}let _=o.querySelector(".gsc_a_y span"),y=_?_.textContent.trim():"No year",m=o.querySelector(".gs_ibl");m&&m.hasAttribute("href")&&m.getAttribute("href"),(parseInt(y)<t||0===t)&&(n=t=parseInt(y)),parseInt(y)>e&&(i=e=parseInt(y),s=e),"No year"==y||void 0==y||(N.has(y)||N.set(y,new Map),j.includes(y)||j.push(y));let x=h[0],v=x?x.textContent.trim():"No authors",w=function t(e,o,a=[5,7]){let n=e.toLowerCase().split(/,\s*(.+)/)[0].replace(/\d+/g,"").replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").trim();if(r.has(n))return r.get(n);for(let i of o)if(i.Name&&n.includes(i.Name.toLowerCase())&&i.Name.toLowerCase().includes(n)){let s=Array.from(Object.values(i));if(!(s.length>=Math.max(...a)))return r.set(n,["NA","NA"]),["NA","NA"];{let l=[i.JIF5Years,i.Qscore];return r.set(n,l),l}}return r.set(n,["NA","NA"]),["NA","NA"]}(p,excelData,[5,7]);B.push({title:c,citations:u,year:y,authors:v,total_authors:0,author_pos:"NA",journalRanking:w[1],journalTitle:p,impact_factor:w[0],index:a,publicationURL:g})});let a=[...k.entries()].sort((t,e)=>e[1]-t[1]).slice(0,3),A=`
            <table class="journalTableStyle">
                <thead>
                <tr>
                    <th>Journal Name</th>
                    <th>Count</th>
                </tr>
                </thead>
                <tbody>
                ${a.map(([t,e])=>`
                    <tr>
                    <td>${t}</td>
                    <td>${e}</td>
                    </tr>
                `).join("")}
                </tbody>
            </table>
            `;document.getElementById("journalTable").innerHTML=DOMPurify.sanitize(A);let E=document.querySelectorAll(".double_range_slider_box input"),P=document.getElementById("single_range");async function Q(t,e,o=5,r=0){let a=[];try{let n=0;e.length>=100&&(r=r>1e4?r:1e4);let i=async()=>{if(n>=e.length)return;let s=e.slice(n,n+o);n+=o,await new Promise(t=>setTimeout(t,r));let l=s.map(async(e,o)=>{try{let r,a=new DOMParser;try{r=await fetchWithSessionCache(t[o],e);let n=0;for(;!r||200!=r.status;)if(r=await fetchWithSessionCache(t[o],e,refetch=!0),++n>5)throw Error("Request limit exceeded. Refresh the page and rerun GScholarLENS.");let i=await r.text(),s=a.parseFromString(DOMPurify.sanitize(i),"text/html"),l=s.querySelector(".gsc_oci_value");return l?l.textContent.trim():"Authors not found"}catch(c){console.error("Error fetching authors:",c),chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status),window.location.reload()}),window.location.reload(),window.alert("Large Profile : Rate limit reached. Please re-run GScholarLENS.")}return"Authors not found"}catch(g){return console.error("Error fetching authors (batch.map):",g),"Error loading authors"}});a.push(...await Promise.all(l)),F(n/e.length*100,"Fetching URLs("+n+"): "),await i()};await i()}catch(s){console.log("Error Fetching Authors:",s),chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)}),window.location.reload()}return a}function R(t,e,o,r,a,n,i){let s=function t(e,o){let r=o;for(;r>0&&(e[r].includes("^")||e[r].includes("*"));)r--;return r}(e,r),l="NA";return N.get(n).has("author_pos_contrib")||(N.get(n).set("author_pos_contrib",new Map),N.get(n).get("author_pos_contrib").set("first_author",0),N.get(n).get("author_pos_contrib").set("second_author",0),N.get(n).get("author_pos_contrib").set("co_author",0),N.get(n).get("author_pos_contrib").set("corresponding_author",0)),N.get(n).has("author_pos_cite_contrib")||(N.get(n).set("author_pos_cite_contrib",new Map),N.get(n).get("author_pos_cite_contrib").set("first_author",0),N.get(n).get("author_pos_cite_contrib").set("second_author",0),N.get(n).get("author_pos_cite_contrib").set("co_author",0),N.get(n).get("author_pos_cite_contrib").set("corresponding_author",0)),N.get(n).has("author_pos_cite_map")||(N.get(n).set("author_pos_cite_map",new Map),N.get(n).get("author_pos_cite_map").set("first_author",[]),N.get(n).get("author_pos_cite_map").set("second_author",[]),N.get(n).get("author_pos_cite_map").set("co_author",[]),N.get(n).get("author_pos_cite_map").set("corresponding_author",[])),N.get(n).has("author_pos_cite_qscore")||(N.get(n).set("author_pos_cite_qscore",new Map),N.get(n).get("author_pos_cite_qscore").set("first_author",new Map),N.get(n).get("author_pos_cite_qscore").set("second_author",new Map),N.get(n).get("author_pos_cite_qscore").set("co_author",new Map),N.get(n).get("author_pos_cite_qscore").set("corresponding_author",new Map),N.get(n).get("author_pos_cite_qscore").get("first_author").set("Q1",0),N.get(n).get("author_pos_cite_qscore").get("first_author").set("Q2",0),N.get(n).get("author_pos_cite_qscore").get("first_author").set("Q3",0),N.get(n).get("author_pos_cite_qscore").get("first_author").set("Q4",0),N.get(n).get("author_pos_cite_qscore").get("first_author").set("NA",0),N.get(n).get("author_pos_cite_qscore").get("second_author").set("Q1",0),N.get(n).get("author_pos_cite_qscore").get("second_author").set("Q2",0),N.get(n).get("author_pos_cite_qscore").get("second_author").set("Q3",0),N.get(n).get("author_pos_cite_qscore").get("second_author").set("Q4",0),N.get(n).get("author_pos_cite_qscore").get("second_author").set("NA",0),N.get(n).get("author_pos_cite_qscore").get("co_author").set("Q1",0),N.get(n).get("author_pos_cite_qscore").get("co_author").set("Q2",0),N.get(n).get("author_pos_cite_qscore").get("co_author").set("Q3",0),N.get(n).get("author_pos_cite_qscore").get("co_author").set("Q4",0),N.get(n).get("author_pos_cite_qscore").get("co_author").set("NA",0),N.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q1",0),N.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q2",0),N.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q3",0),N.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("Q4",0),N.get(n).get("author_pos_cite_qscore").get("corresponding_author").set("NA",0)),t.includes("*")||s+1===e.length?(l="corresponding_author",N.get(n).get("author_pos_contrib").set("corresponding_author",N.get(n).get("author_pos_contrib").get("corresponding_author")+1),N.get(n).get("author_pos_cite_contrib").set("corresponding_author",N.get(n).get("author_pos_cite_contrib").get("corresponding_author")+o),N.get(n).get("author_pos_cite_map").get("corresponding_author").push(o)):0===s?(l="first_author",N.get(n).get("author_pos_contrib").set("first_author",N.get(n).get("author_pos_contrib").get("first_author")+1),N.get(n).get("author_pos_cite_contrib").set("first_author",N.get(n).get("author_pos_cite_contrib").get("first_author")+o),N.get(n).get("author_pos_cite_map").get("first_author").push(o)):1===s?(l="second_author",N.get(n).get("author_pos_contrib").set("second_author",N.get(n).get("author_pos_contrib").get("second_author")+1),N.get(n).get("author_pos_cite_contrib").set("second_author",N.get(n).get("author_pos_cite_contrib").get("second_author")+o),N.get(n).get("author_pos_cite_map").get("second_author").push(o)):s>1&&s+1<e.length?(l="co_author",N.get(n).get("author_pos_contrib").set("co_author",N.get(n).get("author_pos_contrib").get("co_author")+1),N.get(n).get("author_pos_cite_contrib").set("co_author",N.get(n).get("author_pos_cite_contrib").get("co_author")+o),N.get(n).get("author_pos_cite_map").get("co_author").push(o)):(console.log("IDX:",i,"Adj idx:",adj_idx,"Author:",t,"Position:",l,"Citations:",o,"QScore:",a),console.warn(i,B[i].author_pos)),N.get(n).get("author_pos_cite_qscore").get(l).set(a,N.get(n).get("author_pos_cite_qscore").get(l).get(a)+o),l}P.min=t,P.max=e,P.value=s.toString(),E[0].min=t,E[0].max=e,E[0].value=n.toString(),E[1].min=t,E[1].max=e,E[1].value=i.toString(),U(n),J(i),G(s);let D=t=>replaceSpecialChars(t).normalize("NFC").replace(/\s+/g," ").trim().toLowerCase(),W=(t,e)=>0===D(t).localeCompare(D(e),void 0,{sensitivity:"base"});function M(t){let e=replaceSpecialChars(normalizeString(t)).toLowerCase(),o=[];return t$.forEach(t=>{o.push(t.test(e))}),o.push(e.includes(tu.toLowerCase())),o.push(W(t,tt)),o.push(ts.includes(normalizeString(t.trim()))),o.push(th.includes(t.trim())),o.some(t=>!0===t)}function O(t){let e=replaceSpecialChars(normalizeString(t)).toLowerCase(),o=[];return tp.forEach(t=>{o.push(t.test(e))}),o.push(W(t,tt)),o.push(ts.includes(normalizeString(t.trim()))),o.push(th.includes(t.trim())),o.some(t=>!0===t)}let H=[],Z=0;async function Y(){let t=!1,e=new Set;for(let[o,r]of B.entries()){if(o>Z&&await new Promise(t=>setTimeout(t,100)),H.includes(o))continue;let a=r.authors,n=r.citations,i=a.split(",").map(t=>t.trim()),s=i.filter(M);if((uniq(s).length>1||0===s.length)&&a.includes("...")){B[o].authors="Pending",t=!0;continue}let u=!1;l+=1,F(l/c*100,"Processing Publications ("+l+"): "),i.forEach((a,s)=>{if(a.includes("...")){B[o].authors="Pending",t=!0;return}let l=replaceSpecialChars(normalizeString(a)).toLowerCase();if(l.includes(tu.toLowerCase())||l.includes(td.toLowerCase())||W(a,tt)||ts.includes(normalizeString(a.trim()))){let c=[];if(t$.forEach(t=>{c.push(t.test(l))}),c.push(ts.includes(normalizeString(a.trim()))),c.some(t=>!0===t)){u=!0;let g=a.replace(/[\*\^']|_/g,"").replace(/\s+/g," ").trim();I.includes(g)||I.push(g),B[o].author_pos=R(a,i,n,s,r.journalRanking,r.year,o),e.add(o),B[o].total_authors=i.length;let d=0,h=0,$="0	0	0	0";switch(B[o].author_pos){case"first_author":$="1	0	0	0",d=n*v[0],h=v[0];break;case"second_author":$="0	1	0	0",d=n*v[1],h=v[1];break;case"co_author":$="0	0	1	0",r.total_authors>6?(d=.1*n,h=.1):(d=.25*n,h=.25);break;case"corresponding_author":$="0	0	0	1",d=n*v[3],h=v[3];break;default:console.warn(o,B[o].author_pos)}tsvContent+=`${r.index}	${r.title}	${r.authors}	${r.authors.includes("...")?`${r.total_authors-1}+`:r.total_authors}	${r.year}	${r.citations}	${d}	${h}	${r.journalTitle}	${r.journalRanking}	${r.impact_factor}	1	${$}
`}}}),0===r.year.toString().trim().length&&(d+=1),N.get(r.year).has("total_publications")||N.get(r.year).set("total_publications",0),N.get(r.year).set("total_publications",N.get(r.year).get("total_publications")+1),u||(B[o].authors="Pending",t=!0)}if(t){let h=B.filter(t=>"Pending"===t.authors).map(t=>t.publicationURL),$=B.filter(t=>"Pending"===t.authors).map(t=>t.title),p=await Q($,h,h.length,0);(h=[]).length=0,($=[]).length=0;let b=0;for(let[f,_]of B.entries()){if(f>Z&&await new Promise(t=>setTimeout(t,100)),H.includes(f)||"Pending"!==_.authors)continue;if(_.authors=p[b]||"Authors not found",b++,e.has(f))continue;let y=_.authors,m=_.citations,x=!0,C=y.split(",").map(t=>t.trim()),w=C.filter(O);0===w.length&&(w=C.filter(M),x=!1);let S=x?tp:t$;if(0===w.length||"Authors not found"===_.authors)tsvContent+=`${_.index}	${_.title}	${_.authors}	${w.length}	${_.year}	${_.citations}	0	0	${_.journalTitle}	${_.journalRanking}	${_.impact_factor}	0	0	0	0	0
`;else{l+=1,F(l/c*100,"Processing Publications ("+l+"): ");let k=!1;C.forEach((t,o)=>{let r=replaceSpecialChars(normalizeString(t)).toLowerCase();if(r.includes(tu.toLowerCase())||r.includes(td.toLowerCase())||W(t,tt)||ts.includes(normalizeString(t.trim()))){let a=[];if(S.forEach(t=>{a.push(t.test(r))}),a.push(ts.includes(normalizeString(t.trim()))),a.some(t=>!0===t)){k=!0,e.add(f);let n=t.replace(/[^\w\s\']|_/g,"").replace(/\s+/g," ").trim();I.includes(n)||I.push(n),B[f].author_pos=R(t,C,m,o,_.journalRanking,_.year,f),B[f].total_authors=C.length;let i=0,s=0,l="0	0	0	0";switch(B[f].author_pos){case"first_author":l="1	0	0	0",i=m*v[0],s=v[0];break;case"second_author":l="0	1	0	0",i=m*v[1],s=v[1];break;case"co_author":l="0	0	1	0",_.total_authors>6?(i=.1*m,s=.1):(i=.25*m,s=.25);break;case"corresponding_author":l="0	0	0	1",i=m*v[3],s=v[3]}tsvContent+=`${_.index}	${_.title}	${_.authors}	${_.authors.includes("...")?`${_.total_authors-1}+`:_.total_authors}	${_.year}	${_.citations}	${i}	${s}	${_.journalTitle}	${_.journalRanking}	${_.impact_factor}	1	${l}
`}}}),0===_.year.toString().trim().length&&(d+=1),N.get(_.year).has("total_publications")||N.get(_.year).set("total_publications",0),N.get(_.year).set("total_publications",N.get(_.year).get("total_publications")+1),k||(g+=1)}}}return I=[...I,...ti],I=Array(...new Set(I)),l=0,B.forEach(async(t,e)=>{(function t(e,o,r){if("NA"!==e){if(N.get(o).has("qPosCount")||(N.get(o).set("qPosCount",new Map),N.get(o).get("qPosCount").set("first_author",new Map),N.get(o).get("qPosCount").get("first_author").set("Q1",0),N.get(o).get("qPosCount").get("first_author").set("Q2",0),N.get(o).get("qPosCount").get("first_author").set("Q3",0),N.get(o).get("qPosCount").get("first_author").set("Q4",0),N.get(o).get("qPosCount").get("first_author").set("NA",0),N.get(o).get("qPosCount").set("second_author",new Map),N.get(o).get("qPosCount").get("second_author").set("Q1",0),N.get(o).get("qPosCount").get("second_author").set("Q2",0),N.get(o).get("qPosCount").get("second_author").set("Q3",0),N.get(o).get("qPosCount").get("second_author").set("Q4",0),N.get(o).get("qPosCount").get("second_author").set("NA",0),N.get(o).get("qPosCount").set("co_author",new Map),N.get(o).get("qPosCount").get("co_author").set("Q1",0),N.get(o).get("qPosCount").get("co_author").set("Q2",0),N.get(o).get("qPosCount").get("co_author").set("Q3",0),N.get(o).get("qPosCount").get("co_author").set("Q4",0),N.get(o).get("qPosCount").get("co_author").set("NA",0),N.get(o).get("qPosCount").set("corresponding_author",new Map),N.get(o).get("qPosCount").get("corresponding_author").set("Q1",0),N.get(o).get("qPosCount").get("corresponding_author").set("Q2",0),N.get(o).get("qPosCount").get("corresponding_author").set("Q3",0),N.get(o).get("qPosCount").get("corresponding_author").set("Q4",0),N.get(o).get("qPosCount").get("corresponding_author").set("NA",0)),N.get(o).has("qTotal")||(N.get(o).set("qTotal",new Map),N.get(o).get("qTotal").set("Q1",0),N.get(o).get("qTotal").set("Q2",0),N.get(o).get("qTotal").set("Q3",0),N.get(o).get("qTotal").set("Q4",0),N.get(o).get("qTotal").set("NA",0)),"Q"===r.charAt(0))switch(r.charAt(1)){case"1":let a=N.get(o).get("qPosCount").get(e).get("Q1")+1;N.get(o).get("qPosCount").get(e).set("Q1",a);let n=N.get(o).get("qTotal").get("Q1")+1;N.get(o).get("qTotal").set("Q1",n);break;case"2":let i=N.get(o).get("qPosCount").get(e).get("Q2")+1;N.get(o).get("qPosCount").get(e).set("Q2",i);let s=N.get(o).get("qTotal").get("Q2")+1;N.get(o).get("qTotal").set("Q2",s);break;case"3":let l=N.get(o).get("qPosCount").get(e).get("Q3")+1;N.get(o).get("qPosCount").get(e).set("Q3",l);let c=N.get(o).get("qTotal").get("Q3")+1;N.get(o).get("qTotal").set("Q3",c);break;case"4":let g=N.get(o).get("qPosCount").get(e).get("Q4")+1;N.get(o).get("qPosCount").get(e).set("Q4",g);let d=N.get(o).get("qTotal").get("Q4")+1;N.get(o).get("qTotal").set("Q4",d)}else{let u=N.get(o).get("qPosCount").get(e).get("NA")+1;N.get(o).get("qPosCount").get(e).set("NA",u);let h=N.get(o).get("qTotal").get("NA")+1;N.get(o).get("qTotal").set("NA",h)}}})(B[e].author_pos,B[e].year,B[e].journalRanking),l+=1,F(l/c*100,"Processing Journal Rankings ("+l+"): ")}),!0}async function X(t){return F(t/c*100,"Processing Retractions... ",!0),retractionWatchDB=await getRetractionWatchDB(),B.forEach(async(t,e)=>{var o=!1;let r=B[e].title,a=r.toLowerCase().trim().replace(/[.,\/#!$%\^&\*;:}=\_\'\"\(\)\[\]\{\}\+-`~)]/g,"").replace(/\s+/g,"").replace(/retracted/g,"").replace(/retraction/g,"");Z+=1,retractionWatchDB.map(async t=>{if(o)return;let r=t.Title.toLowerCase().trim().replace(/[.,\/#!$%\^&\*;:}=\_\'\"\(\)\[\]\{\}\+-`~)]/g,"").replace(/\s+/g,"").replace(/retracted/g,"").replace(/retraction/g,"");a===r&&(H.push(e),x++,o=!0)}),F(Z/c*100,"Processing Retractions ("+Z+"): ")}),!0}let[V,K]=await Promise.all([Y(),X(l)]);function te(t,e){for(let[o,r]of e.entries())if(r instanceof Map)t.has(o)||t.set(o,new Map),te(t.get(o),r);else if(Array.isArray(r)){let a=t.get(o)||[];t.set(o,[...a,...r])}else"number"==typeof r?t.set(o,(t.get(o)||0)+r):t.set(o,r)}B.sort((t,e)=>t.index-e.index),o.forEach(async(t,e)=>{let o=B[e].author_pos,r=t.querySelector(".gs_gray");if(r){var a,n;let i=DOMPurify.sanitize(`
                        <div class="position-circles" style="display: flex; gap: 5px; margin-top: 2px; margin-left: 2px; align-items: center; position: relative;">
                            <div class="circles-container" style="display: flex; gap: 5px; margin-right: 0.30%; margin-left: 0.15%;">
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"first_author"===o?"#3b8888":"#ddd"};"
            ${"first_author"===o?'data-role="First Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"second_author"===o?"#5d33b8":"#ddd"};"
            ${"second_author"===o?'data-role="Second Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"co_author"===o?"#e68a41":"#ddd"};"
            ${"co_author"===o?'data-role="Co-Author"':""}
        ></span>
        <span 
            style="width: 10px; height: 10px; border-radius: 50%; background-color: ${"corresponding_author"===o?"#3a83b2":"#ddd"};"
            ${"corresponding_author"===o?'data-role="Corresponding Author"':""}
        ></span>
                            </div>
                            <div class="q-badge" style="
                                /*opacity: 0;*/
                                transition: all 0.2s ease-in-out;
                                background: ${{Q1:"#2e7d32",Q2:"#689f38",Q3:"#f9a825",Q4:"#ef6c00"}[a=B[e].journalRanking]||"#607d8b"};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.8em;
                                margin-right: 0.25%;
                                margin-left: 0.25%;
                                /*position: absolute;
                                left: 100%;*/
                                white-space: nowrap;
                                pointer-events: none;
                            ">
                                ${B[e].journalRanking}
                            </div>
                            <div class="if-badge" style="
                                /*opacity: 0;*/
                                transition: all 0.2s ease-in-out;
                                background: ${{Q1:"#2e7d32",Q2:"#689f38",Q3:"#f9a825",Q4:"#ef6c00"}[n=B[e].impact_factor]||"#607d8b"};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.8em;
                                margin-right: 0.25%;
                                margin-left: 0.25%;
                                /*position: absolute;
                                left: 100%;*/
                                white-space: nowrap;
                                pointer-events: none;
                            ">
                                IF5: ${B[e].impact_factor}
                            </div>
                        </div>
                    `),s=t.querySelector(".position-circles");s?s.outerHTML=i:r.insertAdjacentHTML("afterend",i)}}),F(99,"Processing Retractions... ",!0),o.forEach(async(t,e)=>{if(!H.includes(e))return;let o=t.querySelector(".gs_gray"),r=DOMPurify.sanitize(`
                <div class="blink_text"><div class="retraction-notice" style="margin-top: 5px; color: #ff0000; font-weight: bold;">
                RETRACTED</div></div>
            `);o.insertAdjacentHTML("afterend",r)});N.get("")&&N.delete("");let to;async function tr(){to=Papa.parse(tsvContent,{delimiter:"	",header:!0}),ta()}async function ta(){let t=[],e=[],o=["First_Author","Second_Author","Co_Author","Corresponding_Author"];f=to.data.length-1;let r=new Map;o.forEach(t=>{var e,o;r.set(t,(e=to.data,o=t,e.filter(t=>1===parseInt(t[o]))))}),r.forEach((r,a)=>{r.sort((t,e)=>parseInt(e.Adjusted_Citations)-parseInt(t.Adjusted_Citations)),r.forEach((r,a)=>{if(H.includes(parseInt(r.Index)))return;let n=o.map((t,e)=>1===parseInt(r[t])?e:-1).filter(t=>-1!==t);if(n&&n>=0){S[n]++;let i=parseInt(r.Adjusted_Citations);t.push(i),e.push(parseInt(r.Citations)),i>=S[n]&&w[n]++}})}),u=w[0],h=w[1],$=w[2],p=w[3],t.sort((t,e)=>e-t),e.sort((t,e)=>e-t),t.forEach((t,e)=>{t>=e+1&&(b=e+1)}),e.forEach((t,e)=>{t<=0&&m++}),y=t[Math.floor(t.length/2)],_=e[Math.floor(e.length/2)],document.getElementById("sh_index").textContent=DOMPurify.sanitize(`Sh-Index : ${b.toFixed(0)}`),document.getElementById("h_first").textContent=DOMPurify.sanitize(`${u.toString()}`),document.getElementById("h_second").textContent=DOMPurify.sanitize(`${h.toString()}`),document.getElementById("h_other").textContent=DOMPurify.sanitize(`${$.toString()}`),document.getElementById("h_co").textContent=DOMPurify.sanitize(`${p.toString()}`),document.getElementById("medianCitationsAdj").textContent=DOMPurify.sanitize(`${y.toString()}`),document.getElementById("medianCitationsRaw").textContent=DOMPurify.sanitize(`${_.toString()}`),document.getElementById("zeroCitationPubs").textContent=DOMPurify.sanitize(`${m.toString()}`),document.getElementById("retractedPubsCount").textContent=DOMPurify.sanitize(`${x.toString()}`),document.getElementById("preprintCount").textContent=DOMPurify.sanitize(`${C.toString()}`)}loadScript(T,tr,"papaparse_script"),loadScript(z,tz,"chartjs_script_decade"),loadScript(z,tQ,"chartjs_script_author"),L.style.display="none",x>0&&function t(e,o=500){let r=document.querySelectorAll(`.${e}`);r.forEach(async t=>{let e=!0;setInterval(()=>{t.style.visibility=e?"hidden":"visible",e=!e},o)})}("blink_text",1250),document.getElementsByTagName("body")[0].style.overflow="visible",profileScraped=!0,chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})},tT=async()=>{let t=document.querySelector("#gsc_bpf_more");if(!t)return await new Promise(t=>setTimeout(t,1500)),tT();if(!t.hasAttribute("disabled"))return t.click(),await new Promise(t=>setTimeout(t,1500)),tT();{c=document.querySelectorAll(".gsc_a_at").length;let e=parseInt(document.querySelector("#gsc_a_nn").textContent.split(/[-–]/)[1].trim());if(c>e)return await new Promise(t=>setTimeout(t,2e3)),tT();t6()}};D.textContent="Waiting for other GScholarLENS processes to complete...",chrome.runtime.sendMessage({type:"get_semaphore"},t=>{try{console.log(t.status),F(0,"Expanding Publications List: ",!0);let e=window.location.href.toString();fetch(e).then(t=>{200!=t.status&&chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status),window.location.reload()})}),async function(){excelData=await getJCRExcel(),retractionWatchDB=await getRetractionWatchDB()}(),tT()}catch(o){console.error("Error scraping profile:",o),document.getElementsByTagName("body")[0].style.overflow="visible",chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})}})}catch(tB){console.error("Error scraping:",tB),document.getElementsByTagName("body")[0].style.overflow="visible",chrome.runtime.sendMessage({type:"release_semaphore"},t=>{console.log(t.status)})}finally{}return!0}